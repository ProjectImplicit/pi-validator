/**
 * @preserve minno-dashboard v1.0.6
 * @license Apache-2.0 (2019)
 */
!function(){"use strict";function e(t){var n=this.constructor;return this.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){return n.reject(e)})})}"function"!=typeof Object.assign&&(Object.assign=function(e,t){var n=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),o=1;o<arguments.length;o++){var a=n[o];if(null!=a)for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(r[i]=a[i])}return r}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,o=arguments[1],a=0;a<r;a++)if(t=n[a],e.call(o,t,a,n))return t}}),Array.prototype.includes||(Array.prototype.includes=function(e){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");var t=Object(this),n=parseInt(t.length,10)||0;if(0===n)return!1;var r,o,a=parseInt(arguments[1],10)||0;for(0<=a?r=a:(r=n+a)<0&&(r=0);r<n;){if(e===(o=t[r])||e!=e&&o!=o)return!0;r++}return!1}),String.prototype.includes||(String.prototype.includes=function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)});var t=setTimeout;function r(){}function a(e){if(!(this instanceof a))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function o(n,r){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,a._immediateFn(function(){var e=1===n._state?r.onFulfilled:r.onRejected;if(null!==e){var t;try{t=e(n._value)}catch(e){return void s(r.promise,e)}i(r.promise,t)}else(1===n._state?i:s)(r.promise,n._value)})):n._deferreds.push(r)}function i(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof a)return t._state=3,t._value=e,void u(t);if("function"==typeof n)return void c((r=n,o=e,function(){r.apply(o,arguments)}),t)}t._state=1,t._value=e,u(t)}catch(e){s(t,e)}var r,o}function s(e,t){e._state=2,e._value=t,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&a._immediateFn(function(){e._handled||a._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)o(e,e._deferreds[t]);e._deferreds=null}function l(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function c(e,t){var n=!1;try{e(function(e){n||(n=!0,i(t,e))},function(e){n||(n=!0,s(t,e))})}catch(e){if(n)return;n=!0,s(t,e)}}a.prototype.catch=function(e){return this.then(null,e)},a.prototype.then=function(e,t){var n=new this.constructor(r);return o(this,new l(e,t,n)),n},a.prototype.finally=e,a.all=function(t){return new a(function(r,o){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var a=Array.prototype.slice.call(t);if(0===a.length)return r([]);var i=a.length;function s(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void n.call(e,function(e){s(t,e)},o)}a[t]=e,0==--i&&r(a)}catch(e){o(e)}}for(var e=0;e<a.length;e++)s(e,a[e])})},a.resolve=function(t){return t&&"object"==typeof t&&t.constructor===a?t:new a(function(e){e(t)})},a.reject=function(n){return new a(function(e,t){t(n)})},a.race=function(o){return new a(function(e,t){for(var n=0,r=o.length;n<r;n++)o[n].then(e,t)})},a._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},a._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();"Promise"in n?n.Promise.prototype.finally||(n.Promise.prototype.finally=e):n.Promise=a;var d="URLSearchParams"in self,f="Symbol"in self&&"iterator"in Symbol,p="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),h="FormData"in self,y="ArrayBuffer"in self;if(y)var g=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],v=ArrayBuffer.isView||function(e){return e&&-1<g.indexOf(Object.prototype.toString.call(e))};function b(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function w(e){return"string"!=typeof e&&(e=String(e)),e}function _(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return f&&(e[Symbol.iterator]=function(){return e}),e}function k(t){this.map={},t instanceof k?t.forEach(function(e,t){this.append(t,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function x(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function D(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function S(e){var t=new FileReader,n=D(t);return t.readAsArrayBuffer(e),n}function A(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function T(){return this.bodyUsed=!1,this._initBody=function(e){var t;(this._bodyInit=e)?"string"==typeof e?this._bodyText=e:p&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:h&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:d&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():y&&p&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=A(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):y&&(ArrayBuffer.prototype.isPrototypeOf(e)||v(e))?this._bodyArrayBuffer=A(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):d&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},p&&(this.blob=function(){var e=x(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?x(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(S)}),this.text=function(){var e,t,n,r=x(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=D(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},h&&(this.formData=function(){return this.text().then(R)}),this.json=function(){return this.text().then(JSON.parse)},this}k.prototype.append=function(e,t){e=b(e),t=w(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},k.prototype.delete=function(e){delete this.map[b(e)]},k.prototype.get=function(e){return e=b(e),this.has(e)?this.map[e]:null},k.prototype.has=function(e){return this.map.hasOwnProperty(b(e))},k.prototype.set=function(e,t){this.map[b(e)]=w(t)},k.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},k.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),_(n)},k.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),_(t)},k.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),_(n)},f&&(k.prototype[Symbol.iterator]=k.prototype.entries);var C=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function E(e,t){var n,r,o=(t=t||{}).body;if(e instanceof E){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new k(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new k(t.headers)),this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),-1<C.indexOf(r)?r:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function R(e){var o=new FormData;return e.trim().split("&").forEach(function(e){if(e){var t=e.split("="),n=t.shift().replace(/\+/g," "),r=t.join("=").replace(/\+/g," ");o.append(decodeURIComponent(n),decodeURIComponent(r))}}),o}function M(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new k(t.headers),this.url=t.url||"",this._initBody(e)}E.prototype.clone=function(){return new E(this,{body:this._bodyInit})},T.call(E.prototype),T.call(M.prototype),M.prototype.clone=function(){return new M(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new k(this.headers),url:this.url})},M.error=function(){var e=new M(null,{status:0,statusText:""});return e.type="error",e};var O=[301,302,303,307,308];M.redirect=function(e,t){if(-1===O.indexOf(t))throw new RangeError("Invalid status code");return new M(null,{status:t,headers:{location:e}})};var I=self.DOMException;try{new I}catch(e){(I=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack}).prototype=Object.create(Error.prototype),I.prototype.constructor=I}function P(o,i){return new Promise(function(r,e){var t=new E(o,i);if(t.signal&&t.signal.aborted)return e(new I("Aborted","AbortError"));var a=new XMLHttpRequest;function n(){a.abort()}a.onload=function(){var e,o,t={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",o=new k,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var t=e.split(":"),n=t.shift().trim();if(n){var r=t.join(":").trim();o.append(n,r)}}),o)};t.url="responseURL"in a?a.responseURL:t.headers.get("X-Request-URL");var n="response"in a?a.response:a.responseText;r(new M(n,t))},a.onerror=function(){e(new TypeError("Network request failed"))},a.ontimeout=function(){e(new TypeError("Network request failed"))},a.onabort=function(){e(new I("Aborted","AbortError"))},a.open(t.method,t.url,!0),"include"===t.credentials?a.withCredentials=!0:"omit"===t.credentials&&(a.withCredentials=!1),"responseType"in a&&p&&(a.responseType="blob"),t.headers.forEach(function(e,t){a.setRequestHeader(t,e)}),t.signal&&(t.signal.addEventListener("abort",n),a.onreadystatechange=function(){4===a.readyState&&t.signal.removeEventListener("abort",n)}),a.send(void 0===t._bodyInit?null:t._bodyInit)})}P.polyfill=!0,self.fetch||(self.fetch=P,self.Headers=k,self.Request=E,self.Response=M);var U="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function zn(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function Y(e,t){return e(t={exports:{}},t.exports),t.exports}var L=Y(function(Gn,e){Gn.exports=function(){var e,o;function y(){return e.apply(null,arguments)}function s(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function u(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function a(e){return void 0===e}function c(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function i(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function l(e,t){var n,r=[];for(n=0;n<e.length;++n)r.push(t(e[n],n));return r}function g(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function d(e,t){for(var n in t)g(t,n)&&(e[n]=t[n]);return g(t,"toString")&&(e.toString=t.toString),g(t,"valueOf")&&(e.valueOf=t.valueOf),e}function m(e,t,n,r){return Et(e,t,n,r,!0).utc()}function v(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function f(e){if(null==e._isValid){var t=v(e),n=o.call(t.parsedDateParts,function(e){return null!=e}),r=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n);if(e._strict&&(r=r&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return r;e._isValid=r}return e._isValid}function p(e){var t=m(NaN);return null!=e?d(v(t),e):v(t).userInvalidated=!0,t}o=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),n=t.length>>>0,r=0;r<n;r++)if(r in t&&e.call(this,t[r],r,t))return!0;return!1};var h=y.momentProperties=[];function b(e,t){var n,r,o;if(a(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),a(t._i)||(e._i=t._i),a(t._f)||(e._f=t._f),a(t._l)||(e._l=t._l),a(t._strict)||(e._strict=t._strict),a(t._tzm)||(e._tzm=t._tzm),a(t._isUTC)||(e._isUTC=t._isUTC),a(t._offset)||(e._offset=t._offset),a(t._pf)||(e._pf=v(t)),a(t._locale)||(e._locale=t._locale),0<h.length)for(n=0;n<h.length;n++)r=h[n],a(o=t[r])||(e[r]=o);return e}var t=!1;function w(e){b(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===t&&(t=!0,y.updateOffset(this),t=!1)}function _(e){return e instanceof w||null!=e&&null!=e._isAMomentObject}function k(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function x(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=k(t)),n}function D(e,t,n){var r,o=Math.min(e.length,t.length),a=Math.abs(e.length-t.length),i=0;for(r=0;r<o;r++)(n&&e[r]!==t[r]||!n&&x(e[r])!==x(t[r]))&&i++;return i+a}function S(e){!1===y.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function n(a,i){var s=!0;return d(function(){var e=arguments;if(null!=y.deprecationHandler&&y.deprecationHandler(null,a),s){for(var t,n=[],r=0;r<arguments.length;r++){if(t="","object"==typeof e[r]){for(var o in t+="\n["+r+"] ",arguments[0])t+=o+": "+e[0][o]+", ";t=t.slice(0,-2)}else t=e[r];n.push(t)}S(a+"\nArguments: "+Array.prototype.slice.call(n).join("")+"\n"+(new Error).stack),s=!1}return i.apply(this,arguments)},i)}var r,A={};function T(e,t){null!=y.deprecationHandler&&y.deprecationHandler(e,t),A[e]||(S(t),A[e]=!0)}function C(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function E(e,t){var n,r=d({},e);for(n in t)g(t,n)&&(u(e[n])&&u(t[n])?(r[n]={},d(r[n],e[n]),d(r[n],t[n])):null!=t[n]?r[n]=t[n]:delete r[n]);for(n in e)g(e,n)&&!g(t,n)&&u(e[n])&&(r[n]=d({},r[n]));return r}function R(e){null!=e&&this.set(e)}y.suppressDeprecationWarnings=!1,y.deprecationHandler=null,r=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)g(e,t)&&n.push(t);return n};var M={};function O(e,t){var n=e.toLowerCase();M[n]=M[n+"s"]=M[t]=e}function I(e){return"string"==typeof e?M[e]||M[e.toLowerCase()]:void 0}function P(e){var t,n,r={};for(n in e)g(e,n)&&(t=I(n))&&(r[t]=e[n]);return r}var U={};function Y(e,t){U[e]=t}function L(e){var t=[];for(var n in e)t.push({unit:n,priority:U[n]});return t.sort(function(e,t){return e.priority-t.priority}),t}function j(e,t,n){var r=""+Math.abs(e),o=t-r.length,a=0<=e;return(a?n?"+":"":"-")+Math.pow(10,Math.max(0,o)).toString().substr(1)+r}var N=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,F=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,q={},H={};function W(e,t,n,r){var o=r;"string"==typeof r&&(o=function(){return this[r]()}),e&&(H[e]=o),t&&(H[t[0]]=function(){return j(o.apply(this,arguments),t[1],t[2])}),n&&(H[n]=function(){return this.localeData().ordinal(o.apply(this,arguments),e)})}function B(e,t){return e.isValid()?(t=V(t,e.localeData()),q[t]=q[t]||function(r){var e,o,t,a=r.match(N);for(e=0,o=a.length;e<o;e++)H[a[e]]?a[e]=H[a[e]]:a[e]=(t=a[e]).match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"");return function(e){var t,n="";for(t=0;t<o;t++)n+=C(a[t])?a[t].call(e,r):a[t];return n}}(t),q[t](e)):e.localeData().invalidDate()}function V(e,t){var n=5;function r(e){return t.longDateFormat(e)||e}for(F.lastIndex=0;0<=n&&F.test(e);)e=e.replace(F,r),F.lastIndex=0,n-=1;return e}var G=/\d/,z=/\d\d/,$=/\d{3}/,Z=/\d{4}/,J=/[+-]?\d{6}/,K=/\d\d?/,Q=/\d\d\d\d?/,X=/\d\d\d\d\d\d?/,ee=/\d{1,3}/,te=/\d{1,4}/,ne=/[+-]?\d{1,6}/,re=/\d+/,oe=/[+-]?\d+/,ae=/Z|[+-]\d\d:?\d\d/gi,ie=/Z|[+-]\d\d(?::?\d\d)?/gi,se=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,ue={};function le(e,n,r){ue[e]=C(n)?n:function(e,t){return e&&r?r:n}}function ce(e,t){return g(ue,e)?ue[e](t._strict,t._locale):new RegExp(de(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,r,o){return t||n||r||o})))}function de(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var me={};function fe(e,n){var t,r=n;for("string"==typeof e&&(e=[e]),c(n)&&(r=function(e,t){t[n]=x(e)}),t=0;t<e.length;t++)me[e[t]]=r}function pe(e,o){fe(e,function(e,t,n,r){n._w=n._w||{},o(e,n._w,n,r)})}var he=0,ye=1,ge=2,ve=3,be=4,we=5,_e=6,ke=7,xe=8;function De(e){return Se(e)?366:365}function Se(e){return e%4==0&&e%100!=0||e%400==0}W("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),W(0,["YY",2],0,function(){return this.year()%100}),W(0,["YYYY",4],0,"year"),W(0,["YYYYY",5],0,"year"),W(0,["YYYYYY",6,!0],0,"year"),O("year","y"),Y("year",1),le("Y",oe),le("YY",K,z),le("YYYY",te,Z),le("YYYYY",ne,J),le("YYYYYY",ne,J),fe(["YYYYY","YYYYYY"],he),fe("YYYY",function(e,t){t[he]=2===e.length?y.parseTwoDigitYear(e):x(e)}),fe("YY",function(e,t){t[he]=y.parseTwoDigitYear(e)}),fe("Y",function(e,t){t[he]=parseInt(e,10)}),y.parseTwoDigitYear=function(e){return x(e)+(68<x(e)?1900:2e3)};var Ae,Te=Ce("FullYear",!0);function Ce(t,n){return function(e){return null!=e?(Re(this,t,e),y.updateOffset(this,n),this):Ee(this,t)}}function Ee(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function Re(e,t,n){e.isValid()&&!isNaN(n)&&("FullYear"===t&&Se(e.year())&&1===e.month()&&29===e.date()?e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),Me(n,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](n))}function Me(e,t){if(isNaN(e)||isNaN(t))return NaN;var n,r=(t%(n=12)+n)%n;return e+=(t-r)/12,1===r?Se(e)?29:28:31-r%7%2}Ae=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},W("M",["MM",2],"Mo",function(){return this.month()+1}),W("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),W("MMMM",0,0,function(e){return this.localeData().months(this,e)}),O("month","M"),Y("month",8),le("M",K),le("MM",K,z),le("MMM",function(e,t){return t.monthsShortRegex(e)}),le("MMMM",function(e,t){return t.monthsRegex(e)}),fe(["M","MM"],function(e,t){t[ye]=x(e)-1}),fe(["MMM","MMMM"],function(e,t,n,r){var o=n._locale.monthsParse(e,r,n._strict);null!=o?t[ye]=o:v(n).invalidMonth=e});var Oe=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Ie="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Pe="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function Ue(e,t,n){var r,o,a,i=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],r=0;r<12;++r)a=m([2e3,r]),this._shortMonthsParse[r]=this.monthsShort(a,"").toLocaleLowerCase(),this._longMonthsParse[r]=this.months(a,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(o=Ae.call(this._shortMonthsParse,i))?o:null:-1!==(o=Ae.call(this._longMonthsParse,i))?o:null:"MMM"===t?-1!==(o=Ae.call(this._shortMonthsParse,i))?o:-1!==(o=Ae.call(this._longMonthsParse,i))?o:null:-1!==(o=Ae.call(this._longMonthsParse,i))?o:-1!==(o=Ae.call(this._shortMonthsParse,i))?o:null}function Ye(e,t){var n;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=x(t);else if(!c(t=e.localeData().monthsParse(t)))return e;return n=Math.min(e.date(),Me(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e}function Le(e){return null!=e?(Ye(this,e),y.updateOffset(this,!0),this):Ee(this,"Month")}var je=se,Ne=se;function Fe(){function e(e,t){return t.length-e.length}var t,n,r=[],o=[],a=[];for(t=0;t<12;t++)n=m([2e3,t]),r.push(this.monthsShort(n,"")),o.push(this.months(n,"")),a.push(this.months(n,"")),a.push(this.monthsShort(n,""));for(r.sort(e),o.sort(e),a.sort(e),t=0;t<12;t++)r[t]=de(r[t]),o[t]=de(o[t]);for(t=0;t<24;t++)a[t]=de(a[t]);this._monthsRegex=new RegExp("^("+a.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+o.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+r.join("|")+")","i")}function qe(e){var t=new Date(Date.UTC.apply(null,arguments));return e<100&&0<=e&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e),t}function He(e,t,n){var r=7+t-n,o=(7+qe(e,0,r).getUTCDay()-t)%7;return-o+r-1}function We(e,t,n,r,o){var a,i,s=(7+n-r)%7,u=He(e,r,o),l=1+7*(t-1)+s+u;return i=l<=0?De(a=e-1)+l:l>De(e)?(a=e+1,l-De(e)):(a=e,l),{year:a,dayOfYear:i}}function Be(e,t,n){var r,o,a=He(e.year(),t,n),i=Math.floor((e.dayOfYear()-a-1)/7)+1;return i<1?(o=e.year()-1,r=i+Ve(o,t,n)):i>Ve(e.year(),t,n)?(r=i-Ve(e.year(),t,n),o=e.year()+1):(o=e.year(),r=i),{week:r,year:o}}function Ve(e,t,n){var r=He(e,t,n),o=He(e+1,t,n);return(De(e)-r+o)/7}W("w",["ww",2],"wo","week"),W("W",["WW",2],"Wo","isoWeek"),O("week","w"),O("isoWeek","W"),Y("week",5),Y("isoWeek",5),le("w",K),le("ww",K,z),le("W",K),le("WW",K,z),pe(["w","ww","W","WW"],function(e,t,n,r){t[r.substr(0,1)]=x(e)}),W("d",0,"do","day"),W("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),W("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),W("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),W("e",0,0,"weekday"),W("E",0,0,"isoWeekday"),O("day","d"),O("weekday","e"),O("isoWeekday","E"),Y("day",11),Y("weekday",11),Y("isoWeekday",11),le("d",K),le("e",K),le("E",K),le("dd",function(e,t){return t.weekdaysMinRegex(e)}),le("ddd",function(e,t){return t.weekdaysShortRegex(e)}),le("dddd",function(e,t){return t.weekdaysRegex(e)}),pe(["dd","ddd","dddd"],function(e,t,n,r){var o=n._locale.weekdaysParse(e,r,n._strict);null!=o?t.d=o:v(n).invalidWeekday=e}),pe(["d","e","E"],function(e,t,n,r){t[r]=x(e)});var Ge="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),ze="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),$e="Su_Mo_Tu_We_Th_Fr_Sa".split("_");function Ze(e,t,n){var r,o,a,i=this,s=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],r=0;r<7;++r)a=m([2e3,1]).day(r),i._minWeekdaysParse[r]=i.weekdaysMin(a,"").toLocaleLowerCase(),i._shortWeekdaysParse[r]=i.weekdaysShort(a,"").toLocaleLowerCase(),i._weekdaysParse[r]=i.weekdays(a,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(o=Ae.call(this._weekdaysParse,s))?o:null:"ddd"===t?-1!==(o=Ae.call(this._shortWeekdaysParse,s))?o:null:-1!==(o=Ae.call(this._minWeekdaysParse,s))?o:null:"dddd"===t?-1!==(o=Ae.call(this._weekdaysParse,s))?o:-1!==(o=Ae.call(this._shortWeekdaysParse,s))?o:-1!==(o=Ae.call(this._minWeekdaysParse,s))?o:null:"ddd"===t?-1!==(o=Ae.call(this._shortWeekdaysParse,s))?o:-1!==(o=Ae.call(this._weekdaysParse,s))?o:-1!==(o=Ae.call(this._minWeekdaysParse,s))?o:null:-1!==(o=Ae.call(this._minWeekdaysParse,s))?o:-1!==(o=Ae.call(this._weekdaysParse,s))?o:-1!==(o=Ae.call(this._shortWeekdaysParse,s))?o:null}var Je=se,Ke=se,Qe=se;function Xe(){function e(e,t){return t.length-e.length}var t,n,r,o,a,i=[],s=[],u=[],l=[];for(t=0;t<7;t++)n=m([2e3,1]).day(t),r=this.weekdaysMin(n,""),o=this.weekdaysShort(n,""),a=this.weekdays(n,""),i.push(r),s.push(o),u.push(a),l.push(r),l.push(o),l.push(a);for(i.sort(e),s.sort(e),u.sort(e),l.sort(e),t=0;t<7;t++)s[t]=de(s[t]),u[t]=de(u[t]),l[t]=de(l[t]);this._weekdaysRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+s.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+i.join("|")+")","i")}function et(){return this.hours()%12||12}function tt(e,t){W(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function nt(e,t){return t._meridiemParse}W("H",["HH",2],0,"hour"),W("h",["hh",2],0,et),W("k",["kk",2],0,function(){return this.hours()||24}),W("hmm",0,0,function(){return""+et.apply(this)+j(this.minutes(),2)}),W("hmmss",0,0,function(){return""+et.apply(this)+j(this.minutes(),2)+j(this.seconds(),2)}),W("Hmm",0,0,function(){return""+this.hours()+j(this.minutes(),2)}),W("Hmmss",0,0,function(){return""+this.hours()+j(this.minutes(),2)+j(this.seconds(),2)}),tt("a",!0),tt("A",!1),O("hour","h"),Y("hour",13),le("a",nt),le("A",nt),le("H",K),le("h",K),le("k",K),le("HH",K,z),le("hh",K,z),le("kk",K,z),le("hmm",Q),le("hmmss",X),le("Hmm",Q),le("Hmmss",X),fe(["H","HH"],ve),fe(["k","kk"],function(e,t,n){var r=x(e);t[ve]=24===r?0:r}),fe(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),fe(["h","hh"],function(e,t,n){t[ve]=x(e),v(n).bigHour=!0}),fe("hmm",function(e,t,n){var r=e.length-2;t[ve]=x(e.substr(0,r)),t[be]=x(e.substr(r)),v(n).bigHour=!0}),fe("hmmss",function(e,t,n){var r=e.length-4,o=e.length-2;t[ve]=x(e.substr(0,r)),t[be]=x(e.substr(r,2)),t[we]=x(e.substr(o)),v(n).bigHour=!0}),fe("Hmm",function(e,t,n){var r=e.length-2;t[ve]=x(e.substr(0,r)),t[be]=x(e.substr(r))}),fe("Hmmss",function(e,t,n){var r=e.length-4,o=e.length-2;t[ve]=x(e.substr(0,r)),t[be]=x(e.substr(r,2)),t[we]=x(e.substr(o))});var rt,ot=Ce("Hours",!0),at={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:Ie,monthsShort:Pe,week:{dow:0,doy:6},weekdays:Ge,weekdaysMin:$e,weekdaysShort:ze,meridiemParse:/[ap]\.?m?\.?/i},it={},st={};function ut(e){return e?e.toLowerCase().replace("_","-"):e}function lt(e){var t=null;if(!it[e]&&Gn&&Gn.exports)try{t=rt._abbr;var n=zn;n("./locale/"+e),ct(t)}catch(e){}return it[e]}function ct(e,t){var n;return e&&((n=a(t)?mt(e):dt(e,t))?rt=n:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),rt._abbr}function dt(e,t){if(null===t)return delete it[e],null;var n,r=at;if(t.abbr=e,null!=it[e])T("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),r=it[e]._config;else if(null!=t.parentLocale)if(null!=it[t.parentLocale])r=it[t.parentLocale]._config;else{if(null==(n=lt(t.parentLocale)))return st[t.parentLocale]||(st[t.parentLocale]=[]),st[t.parentLocale].push({name:e,config:t}),null;r=n._config}return it[e]=new R(E(r,t)),st[e]&&st[e].forEach(function(e){dt(e.name,e.config)}),ct(e),it[e]}function mt(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return rt;if(!s(e)){if(t=lt(e))return t;e=[e]}return function(e){for(var t,n,r,o,a=0;a<e.length;){for(o=ut(e[a]).split("-"),t=o.length,n=(n=ut(e[a+1]))?n.split("-"):null;0<t;){if(r=lt(o.slice(0,t).join("-")))return r;if(n&&n.length>=t&&D(o,n,!0)>=t-1)break;t--}a++}return rt}(e)}function ft(e){var t,n=e._a;return n&&-2===v(e).overflow&&(t=n[ye]<0||11<n[ye]?ye:n[ge]<1||n[ge]>Me(n[he],n[ye])?ge:n[ve]<0||24<n[ve]||24===n[ve]&&(0!==n[be]||0!==n[we]||0!==n[_e])?ve:n[be]<0||59<n[be]?be:n[we]<0||59<n[we]?we:n[_e]<0||999<n[_e]?_e:-1,v(e)._overflowDayOfYear&&(t<he||ge<t)&&(t=ge),v(e)._overflowWeeks&&-1===t&&(t=ke),v(e)._overflowWeekday&&-1===t&&(t=xe),v(e).overflow=t),e}function pt(e,t,n){return null!=e?e:null!=t?t:n}function ht(e){var t,n,r,o,a,i,s,u=[];if(!e._d){for(i=e,s=void 0,s=new Date(y.now()),r=i._useUTC?[s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()]:[s.getFullYear(),s.getMonth(),s.getDate()],e._w&&null==e._a[ge]&&null==e._a[ye]&&function(e){var t,n,r,o,a,i,s,u;if(null!=(t=e._w).GG||null!=t.W||null!=t.E)a=1,i=4,n=pt(t.GG,e._a[he],Be(Rt(),1,4).year),r=pt(t.W,1),((o=pt(t.E,1))<1||7<o)&&(u=!0);else{a=e._locale._week.dow,i=e._locale._week.doy;var l=Be(Rt(),a,i);n=pt(t.gg,e._a[he],l.year),r=pt(t.w,l.week),null!=t.d?((o=t.d)<0||6<o)&&(u=!0):null!=t.e?(o=t.e+a,(t.e<0||6<t.e)&&(u=!0)):o=a}r<1||r>Ve(n,a,i)?v(e)._overflowWeeks=!0:null!=u?v(e)._overflowWeekday=!0:(s=We(n,r,o,a,i),e._a[he]=s.year,e._dayOfYear=s.dayOfYear)}(e),null!=e._dayOfYear&&(a=pt(e._a[he],r[he]),(e._dayOfYear>De(a)||0===e._dayOfYear)&&(v(e)._overflowDayOfYear=!0),n=qe(a,0,e._dayOfYear),e._a[ye]=n.getUTCMonth(),e._a[ge]=n.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=u[t]=r[t];for(;t<7;t++)e._a[t]=u[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[ve]&&0===e._a[be]&&0===e._a[we]&&0===e._a[_e]&&(e._nextDay=!0,e._a[ve]=0),e._d=(e._useUTC?qe:function(e,t,n,r,o,a,i){var s=new Date(e,t,n,r,o,a,i);return e<100&&0<=e&&isFinite(s.getFullYear())&&s.setFullYear(e),s}).apply(null,u),o=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[ve]=24),e._w&&void 0!==e._w.d&&e._w.d!==o&&(v(e).weekdayMismatch=!0)}}var yt=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,gt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,vt=/Z|[+-]\d\d(?::?\d\d)?/,bt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],wt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],_t=/^\/?Date\((\-?\d+)/i;function kt(e){var t,n,r,o,a,i,s=e._i,u=yt.exec(s)||gt.exec(s);if(u){for(v(e).iso=!0,t=0,n=bt.length;t<n;t++)if(bt[t][1].exec(u[1])){o=bt[t][0],r=!1!==bt[t][2];break}if(null==o)return void(e._isValid=!1);if(u[3]){for(t=0,n=wt.length;t<n;t++)if(wt[t][1].exec(u[3])){a=(u[2]||" ")+wt[t][0];break}if(null==a)return void(e._isValid=!1)}if(!r&&null!=a)return void(e._isValid=!1);if(u[4]){if(!vt.exec(u[4]))return void(e._isValid=!1);i="Z"}e._f=o+(a||"")+(i||""),Tt(e)}else e._isValid=!1}var xt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function Dt(e,t,n,r,o,a){var i,s,u=[(i=e,s=parseInt(i,10),s<=49?2e3+s:s<=999?1900+s:s),Pe.indexOf(t),parseInt(n,10),parseInt(r,10),parseInt(o,10)];return a&&u.push(parseInt(a,10)),u}var St={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function At(e){var t=xt.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(t){var n=Dt(t[4],t[3],t[2],t[5],t[6],t[7]);if(!function(e,t,n){if(e){var r=ze.indexOf(e),o=new Date(t[0],t[1],t[2]).getDay();if(r!==o)return v(n).weekdayMismatch=!0,n._isValid=!1}return!0}(t[1],n,e))return;e._a=n,e._tzm=function(e,t,n){if(e)return St[e];if(t)return 0;var r=parseInt(n,10),o=r%100,a=(r-o)/100;return 60*a+o}(t[8],t[9],t[10]),e._d=qe.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),v(e).rfc2822=!0}else e._isValid=!1}function Tt(e){if(e._f!==y.ISO_8601)if(e._f!==y.RFC_2822){e._a=[],v(e).empty=!0;var t,n,r,o,a,i=""+e._i,s=i.length,u=0;for(r=V(e._f,e._locale).match(N)||[],t=0;t<r.length;t++)o=r[t],(n=(i.match(ce(o,e))||[])[0])&&(0<(a=i.substr(0,i.indexOf(n))).length&&v(e).unusedInput.push(a),i=i.slice(i.indexOf(n)+n.length),u+=n.length),H[o]?(n?v(e).empty=!1:v(e).unusedTokens.push(o),f=o,h=e,null!=(p=n)&&g(me,f)&&me[f](p,h._a,h,f)):e._strict&&!n&&v(e).unusedTokens.push(o);v(e).charsLeftOver=s-u,0<i.length&&v(e).unusedInput.push(i),e._a[ve]<=12&&!0===v(e).bigHour&&0<e._a[ve]&&(v(e).bigHour=void 0),v(e).parsedDateParts=e._a.slice(0),v(e).meridiem=e._meridiem,e._a[ve]=(l=e._locale,c=e._a[ve],null==(d=e._meridiem)?c:null!=l.meridiemHour?l.meridiemHour(c,d):(null!=l.isPM&&((m=l.isPM(d))&&c<12&&(c+=12),m||12!==c||(c=0)),c)),ht(e),ft(e)}else At(e);else kt(e);var l,c,d,m,f,p,h}function Ct(e){var t,n,r=e._i,o=e._f;return e._locale=e._locale||mt(e._l),null===r||void 0===o&&""===r?p({nullInput:!0}):("string"==typeof r&&(e._i=r=e._locale.preparse(r)),_(r)?new w(ft(r)):(i(r)?e._d=r:s(o)?function(e){var t,n,r,o,a;if(0===e._f.length)return v(e).invalidFormat=!0,e._d=new Date(NaN);for(o=0;o<e._f.length;o++)a=0,t=b({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[o],Tt(t),f(t)&&(a+=v(t).charsLeftOver,a+=10*v(t).unusedTokens.length,v(t).score=a,(null==r||a<r)&&(r=a,n=t));d(e,n||t)}(e):o?Tt(e):a(n=(t=e)._i)?t._d=new Date(y.now()):i(n)?t._d=new Date(n.valueOf()):"string"==typeof n?function(e){var t=_t.exec(e._i);if(null!==t)return e._d=new Date(+t[1]);kt(e),!1===e._isValid&&(delete e._isValid,At(e),!1===e._isValid&&(delete e._isValid,y.createFromInputFallback(e)))}(t):s(n)?(t._a=l(n.slice(0),function(e){return parseInt(e,10)}),ht(t)):u(n)?function(e){if(!e._d){var t=P(e._i);e._a=l([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),ht(e)}}(t):c(n)?t._d=new Date(n):y.createFromInputFallback(t),f(e)||(e._d=null),e))}function Et(e,t,n,r,o){var a,i={};return!0!==n&&!1!==n||(r=n,n=void 0),(u(e)&&function(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}(e)||s(e)&&0===e.length)&&(e=void 0),i._isAMomentObject=!0,i._useUTC=i._isUTC=o,i._l=n,i._i=e,i._f=t,i._strict=r,(a=new w(ft(Ct(i))))._nextDay&&(a.add(1,"d"),a._nextDay=void 0),a}function Rt(e,t,n,r){return Et(e,t,n,r,!1)}y.createFromInputFallback=n("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),y.ISO_8601=function(){},y.RFC_2822=function(){};var Mt=n("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Rt.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:p()}),Ot=n("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=Rt.apply(null,arguments);return this.isValid()&&e.isValid()?this<e?this:e:p()});function It(e,t){var n,r;if(1===t.length&&s(t[0])&&(t=t[0]),!t.length)return Rt();for(n=t[0],r=1;r<t.length;++r)t[r].isValid()&&!t[r][e](n)||(n=t[r]);return n}var Pt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ut(e){var t=P(e),n=t.year||0,r=t.quarter||0,o=t.month||0,a=t.week||t.isoWeek||0,i=t.day||0,s=t.hour||0,u=t.minute||0,l=t.second||0,c=t.millisecond||0;this._isValid=function(e){for(var t in e)if(-1===Ae.call(Pt,t)||null!=e[t]&&isNaN(e[t]))return!1;for(var n=!1,r=0;r<Pt.length;++r)if(e[Pt[r]]){if(n)return!1;parseFloat(e[Pt[r]])!==x(e[Pt[r]])&&(n=!0)}return!0}(t),this._milliseconds=+c+1e3*l+6e4*u+1e3*s*60*60,this._days=+i+7*a,this._months=+o+3*r+12*n,this._data={},this._locale=mt(),this._bubble()}function Yt(e){return e instanceof Ut}function Lt(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function jt(e,n){W(e,0,0,function(){var e=this.utcOffset(),t="+";return e<0&&(e=-e,t="-"),t+j(~~(e/60),2)+n+j(~~e%60,2)})}jt("Z",":"),jt("ZZ",""),le("Z",ie),le("ZZ",ie),fe(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=Ft(ie,e)});var Nt=/([\+\-]|\d\d)/gi;function Ft(e,t){var n=(t||"").match(e);if(null===n)return null;var r=n[n.length-1]||[],o=(r+"").match(Nt)||["-",0,0],a=60*o[1]+x(o[2]);return 0===a?0:"+"===o[0]?a:-a}function qt(e,t){var n,r;return t._isUTC?(n=t.clone(),r=(_(e)||i(e)?e.valueOf():Rt(e).valueOf())-n.valueOf(),n._d.setTime(n._d.valueOf()+r),y.updateOffset(n,!1),n):Rt(e).local()}function Ht(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function Wt(){return!!this.isValid()&&this._isUTC&&0===this._offset}y.updateOffset=function(){};var Bt=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,Vt=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Gt(e,t){var n,r,o,a,i,s,u=e,l=null;return Yt(e)?u={ms:e._milliseconds,d:e._days,M:e._months}:c(e)?(u={},t?u[t]=e:u.milliseconds=e):(l=Bt.exec(e))?(n="-"===l[1]?-1:1,u={y:0,d:x(l[ge])*n,h:x(l[ve])*n,m:x(l[be])*n,s:x(l[we])*n,ms:x(Lt(1e3*l[_e]))*n}):(l=Vt.exec(e))?(n="-"===l[1]?-1:1,u={y:zt(l[2],n),M:zt(l[3],n),w:zt(l[4],n),d:zt(l[5],n),h:zt(l[6],n),m:zt(l[7],n),s:zt(l[8],n)}):null==u?u={}:"object"==typeof u&&("from"in u||"to"in u)&&(a=Rt(u.from),i=Rt(u.to),o=a.isValid()&&i.isValid()?(i=qt(i,a),a.isBefore(i)?s=$t(a,i):((s=$t(i,a)).milliseconds=-s.milliseconds,s.months=-s.months),s):{milliseconds:0,months:0},(u={}).ms=o.milliseconds,u.M=o.months),r=new Ut(u),Yt(e)&&g(e,"_locale")&&(r._locale=e._locale),r}function zt(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function $t(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function Zt(r,o){return function(e,t){var n;return null===t||isNaN(+t)||(T(o,"moment()."+o+"(period, number) is deprecated. Please use moment()."+o+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),n=e,e=t,t=n),Jt(this,Gt(e="string"==typeof e?+e:e,t),r),this}}function Jt(e,t,n,r){var o=t._milliseconds,a=Lt(t._days),i=Lt(t._months);e.isValid()&&(r=null==r||r,i&&Ye(e,Ee(e,"Month")+i*n),a&&Re(e,"Date",Ee(e,"Date")+a*n),o&&e._d.setTime(e._d.valueOf()+o*n),r&&y.updateOffset(e,a||i))}Gt.fn=Ut.prototype,Gt.invalid=function(){return Gt(NaN)};var Kt=Zt(1,"add"),Qt=Zt(-1,"subtract");function Xt(e,t){var n,r,o=12*(t.year()-e.year())+(t.month()-e.month()),a=e.clone().add(o,"months");return r=t-a<0?(n=e.clone().add(o-1,"months"),(t-a)/(a-n)):(n=e.clone().add(o+1,"months"),(t-a)/(n-a)),-(o+r)||0}function en(e){var t;return void 0===e?this._locale._abbr:(null!=(t=mt(e))&&(this._locale=t),this)}y.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",y.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var tn=n("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function nn(){return this._locale}function rn(e,t){W(0,[e,e.length],0,t)}function on(e,t,n,r,o){var a;return null==e?Be(this,r,o).year:((a=Ve(e,r,o))<t&&(t=a),function(e,t,n,r,o){var a=We(e,t,n,r,o),i=qe(a.year,0,a.dayOfYear);return this.year(i.getUTCFullYear()),this.month(i.getUTCMonth()),this.date(i.getUTCDate()),this}.call(this,e,t,n,r,o))}W(0,["gg",2],0,function(){return this.weekYear()%100}),W(0,["GG",2],0,function(){return this.isoWeekYear()%100}),rn("gggg","weekYear"),rn("ggggg","weekYear"),rn("GGGG","isoWeekYear"),rn("GGGGG","isoWeekYear"),O("weekYear","gg"),O("isoWeekYear","GG"),Y("weekYear",1),Y("isoWeekYear",1),le("G",oe),le("g",oe),le("GG",K,z),le("gg",K,z),le("GGGG",te,Z),le("gggg",te,Z),le("GGGGG",ne,J),le("ggggg",ne,J),pe(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,r){t[r.substr(0,2)]=x(e)}),pe(["gg","GG"],function(e,t,n,r){t[r]=y.parseTwoDigitYear(e)}),W("Q",0,"Qo","quarter"),O("quarter","Q"),Y("quarter",7),le("Q",G),fe("Q",function(e,t){t[ye]=3*(x(e)-1)}),W("D",["DD",2],"Do","date"),O("date","D"),Y("date",9),le("D",K),le("DD",K,z),le("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),fe(["D","DD"],ge),fe("Do",function(e,t){t[ge]=x(e.match(K)[0])});var an=Ce("Date",!0);W("DDD",["DDDD",3],"DDDo","dayOfYear"),O("dayOfYear","DDD"),Y("dayOfYear",4),le("DDD",ee),le("DDDD",$),fe(["DDD","DDDD"],function(e,t,n){n._dayOfYear=x(e)}),W("m",["mm",2],0,"minute"),O("minute","m"),Y("minute",14),le("m",K),le("mm",K,z),fe(["m","mm"],be);var sn=Ce("Minutes",!1);W("s",["ss",2],0,"second"),O("second","s"),Y("second",15),le("s",K),le("ss",K,z),fe(["s","ss"],we);var un,ln=Ce("Seconds",!1);for(W("S",0,0,function(){return~~(this.millisecond()/100)}),W(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),W(0,["SSS",3],0,"millisecond"),W(0,["SSSS",4],0,function(){return 10*this.millisecond()}),W(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),W(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),W(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),W(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),W(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),O("millisecond","ms"),Y("millisecond",16),le("S",ee,G),le("SS",ee,z),le("SSS",ee,$),un="SSSS";un.length<=9;un+="S")le(un,re);function cn(e,t){t[_e]=x(1e3*("0."+e))}for(un="S";un.length<=9;un+="S")fe(un,cn);var dn=Ce("Milliseconds",!1);W("z",0,0,"zoneAbbr"),W("zz",0,0,"zoneName");var mn=w.prototype;function fn(e){return e}mn.add=Kt,mn.calendar=function(e,t){var n=e||Rt(),r=qt(n,this).startOf("day"),o=y.calendarFormat(this,r)||"sameElse",a=t&&(C(t[o])?t[o].call(this,n):t[o]);return this.format(a||this.localeData().calendar(o,this,Rt(n)))},mn.clone=function(){return new w(this)},mn.diff=function(e,t,n){var r,o,a;if(!this.isValid())return NaN;if(!(r=qt(e,this)).isValid())return NaN;switch(o=6e4*(r.utcOffset()-this.utcOffset()),t=I(t)){case"year":a=Xt(this,r)/12;break;case"month":a=Xt(this,r);break;case"quarter":a=Xt(this,r)/3;break;case"second":a=(this-r)/1e3;break;case"minute":a=(this-r)/6e4;break;case"hour":a=(this-r)/36e5;break;case"day":a=(this-r-o)/864e5;break;case"week":a=(this-r-o)/6048e5;break;default:a=this-r}return n?a:k(a)},mn.endOf=function(e){return void 0===(e=I(e))||"millisecond"===e?this:("date"===e&&(e="day"),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms"))},mn.format=function(e){e||(e=this.isUtc()?y.defaultFormatUtc:y.defaultFormat);var t=B(this,e);return this.localeData().postformat(t)},mn.from=function(e,t){return this.isValid()&&(_(e)&&e.isValid()||Rt(e).isValid())?Gt({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},mn.fromNow=function(e){return this.from(Rt(),e)},mn.to=function(e,t){return this.isValid()&&(_(e)&&e.isValid()||Rt(e).isValid())?Gt({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},mn.toNow=function(e){return this.to(Rt(),e)},mn.get=function(e){return C(this[e=I(e)])?this[e]():this},mn.invalidAt=function(){return v(this).overflow},mn.isAfter=function(e,t){var n=_(e)?e:Rt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=I(t)||"millisecond")?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())},mn.isBefore=function(e,t){var n=_(e)?e:Rt(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=I(t)||"millisecond")?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())},mn.isBetween=function(e,t,n,r){var o=_(e)?e:Rt(e),a=_(t)?t:Rt(t);return!!(this.isValid()&&o.isValid()&&a.isValid())&&("("===(r=r||"()")[0]?this.isAfter(o,n):!this.isBefore(o,n))&&(")"===r[1]?this.isBefore(a,n):!this.isAfter(a,n))},mn.isSame=function(e,t){var n,r=_(e)?e:Rt(e);return!(!this.isValid()||!r.isValid())&&("millisecond"===(t=I(t)||"millisecond")?this.valueOf()===r.valueOf():(n=r.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))},mn.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},mn.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},mn.isValid=function(){return f(this)},mn.lang=tn,mn.locale=en,mn.localeData=nn,mn.max=Ot,mn.min=Mt,mn.parsingFlags=function(){return d({},v(this))},mn.set=function(e,t){if("object"==typeof e)for(var n=L(e=P(e)),r=0;r<n.length;r++)this[n[r].unit](e[n[r].unit]);else if(C(this[e=I(e)]))return this[e](t);return this},mn.startOf=function(e){switch(e=I(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},mn.subtract=Qt,mn.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},mn.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},mn.toDate=function(){return new Date(this.valueOf())},mn.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,n=t?this.clone().utc():this;return n.year()<0||9999<n.year()?B(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):C(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",B(n,"Z")):B(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},mn.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var n="["+e+'("]',r=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",o=t+'[")]';return this.format(n+r+"-MM-DD[T]HH:mm:ss.SSS"+o)},mn.toJSON=function(){return this.isValid()?this.toISOString():null},mn.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},mn.unix=function(){return Math.floor(this.valueOf()/1e3)},mn.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},mn.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},mn.year=Te,mn.isLeapYear=function(){return Se(this.year())},mn.weekYear=function(e){return on.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},mn.isoWeekYear=function(e){return on.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},mn.quarter=mn.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},mn.month=Le,mn.daysInMonth=function(){return Me(this.year(),this.month())},mn.week=mn.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},mn.isoWeek=mn.isoWeeks=function(e){var t=Be(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},mn.weeksInYear=function(){var e=this.localeData()._week;return Ve(this.year(),e.dow,e.doy)},mn.isoWeeksInYear=function(){return Ve(this.year(),1,4)},mn.date=an,mn.day=mn.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t,n,r=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(t=e,n=this.localeData(),e="string"==typeof t?isNaN(t)?"number"!=typeof(t=n.weekdaysParse(t))?null:t:parseInt(t,10):t,this.add(e-r,"d")):r},mn.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},mn.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null==e)return this.day()||7;var t,n,r=(t=e,n=this.localeData(),"string"!=typeof t?isNaN(t)?null:t:n.weekdaysParse(t)%7||7);return this.day(this.day()%7?r:r-7)},mn.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},mn.hour=mn.hours=ot,mn.minute=mn.minutes=sn,mn.second=mn.seconds=ln,mn.millisecond=mn.milliseconds=dn,mn.utcOffset=function(e,t,n){var r,o=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null==e)return this._isUTC?o:Ht(this);if("string"==typeof e){if(null===(e=Ft(ie,e)))return this}else Math.abs(e)<16&&!n&&(e*=60);return!this._isUTC&&t&&(r=Ht(this)),this._offset=e,this._isUTC=!0,null!=r&&this.add(r,"m"),o!==e&&(!t||this._changeInProgress?Jt(this,Gt(e-o,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,y.updateOffset(this,!0),this._changeInProgress=null)),this},mn.utc=function(e){return this.utcOffset(0,e)},mn.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Ht(this),"m")),this},mn.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=Ft(ae,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},mn.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?Rt(e).utcOffset():0,(this.utcOffset()-e)%60==0)},mn.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},mn.isLocal=function(){return!!this.isValid()&&!this._isUTC},mn.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},mn.isUtc=Wt,mn.isUTC=Wt,mn.zoneAbbr=function(){return this._isUTC?"UTC":""},mn.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},mn.dates=n("dates accessor is deprecated. Use date instead.",an),mn.months=n("months accessor is deprecated. Use month instead",Le),mn.years=n("years accessor is deprecated. Use year instead",Te),mn.zone=n("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),mn.isDSTShifted=n("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!a(this._isDSTShifted))return this._isDSTShifted;var e={};if(b(e,this),(e=Ct(e))._a){var t=e._isUTC?m(e._a):Rt(e._a);this._isDSTShifted=this.isValid()&&0<D(e._a,t.toArray())}else this._isDSTShifted=!1;return this._isDSTShifted});var pn=R.prototype;function hn(e,t,n,r){var o=mt(),a=m().set(r,t);return o[n](a,e)}function yn(e,t,n){if(c(e)&&(t=e,e=void 0),e=e||"",null!=t)return hn(e,t,n,"month");var r,o=[];for(r=0;r<12;r++)o[r]=hn(e,r,n,"month");return o}function gn(e,t,n,r){"boolean"==typeof e?c(t)&&(n=t,t=void 0):(t=e,e=!1,c(n=t)&&(n=t,t=void 0)),t=t||"";var o,a=mt(),i=e?a._week.dow:0;if(null!=n)return hn(t,(n+i)%7,r,"day");var s=[];for(o=0;o<7;o++)s[o]=hn(t,(o+i)%7,r,"day");return s}pn.calendar=function(e,t,n){var r=this._calendar[e]||this._calendar.sameElse;return C(r)?r.call(t,n):r},pn.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return!t&&n?(this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]):t},pn.invalidDate=function(){return this._invalidDate},pn.ordinal=function(e){return this._ordinal.replace("%d",e)},pn.preparse=fn,pn.postformat=fn,pn.relativeTime=function(e,t,n,r){var o=this._relativeTime[n];return C(o)?o(e,t,n,r):o.replace(/%d/i,e)},pn.pastFuture=function(e,t){var n=this._relativeTime[0<e?"future":"past"];return C(n)?n(t):n.replace(/%s/i,t)},pn.set=function(e){var t,n;for(n in e)C(t=e[n])?this[n]=t:this["_"+n]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},pn.months=function(e,t){return e?s(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||Oe).test(t)?"format":"standalone"][e.month()]:s(this._months)?this._months:this._months.standalone},pn.monthsShort=function(e,t){return e?s(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[Oe.test(t)?"format":"standalone"][e.month()]:s(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},pn.monthsParse=function(e,t,n){var r,o,a,i=this;if(this._monthsParseExact)return Ue.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;r<12;r++){if(o=m([2e3,r]),n&&!i._longMonthsParse[r]&&(i._longMonthsParse[r]=new RegExp("^"+i.months(o,"").replace(".","")+"$","i"),i._shortMonthsParse[r]=new RegExp("^"+i.monthsShort(o,"").replace(".","")+"$","i")),n||i._monthsParse[r]||(a="^"+i.months(o,"")+"|^"+i.monthsShort(o,""),i._monthsParse[r]=new RegExp(a.replace(".",""),"i")),n&&"MMMM"===t&&i._longMonthsParse[r].test(e))return r;if(n&&"MMM"===t&&i._shortMonthsParse[r].test(e))return r;if(!n&&i._monthsParse[r].test(e))return r}},pn.monthsRegex=function(e){return this._monthsParseExact?(g(this,"_monthsRegex")||Fe.call(this),e?this._monthsStrictRegex:this._monthsRegex):(g(this,"_monthsRegex")||(this._monthsRegex=Ne),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},pn.monthsShortRegex=function(e){return this._monthsParseExact?(g(this,"_monthsRegex")||Fe.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(g(this,"_monthsShortRegex")||(this._monthsShortRegex=je),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},pn.week=function(e){return Be(e,this._week.dow,this._week.doy).week},pn.firstDayOfYear=function(){return this._week.doy},pn.firstDayOfWeek=function(){return this._week.dow},pn.weekdays=function(e,t){return e?s(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(t)?"format":"standalone"][e.day()]:s(this._weekdays)?this._weekdays:this._weekdays.standalone},pn.weekdaysMin=function(e){return e?this._weekdaysMin[e.day()]:this._weekdaysMin},pn.weekdaysShort=function(e){return e?this._weekdaysShort[e.day()]:this._weekdaysShort},pn.weekdaysParse=function(e,t,n){var r,o,a,i=this;if(this._weekdaysParseExact)return Ze.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),r=0;r<7;r++){if(o=m([2e3,1]).day(r),n&&!i._fullWeekdaysParse[r]&&(i._fullWeekdaysParse[r]=new RegExp("^"+i.weekdays(o,"").replace(".","\\.?")+"$","i"),i._shortWeekdaysParse[r]=new RegExp("^"+i.weekdaysShort(o,"").replace(".","\\.?")+"$","i"),i._minWeekdaysParse[r]=new RegExp("^"+i.weekdaysMin(o,"").replace(".","\\.?")+"$","i")),i._weekdaysParse[r]||(a="^"+i.weekdays(o,"")+"|^"+i.weekdaysShort(o,"")+"|^"+i.weekdaysMin(o,""),i._weekdaysParse[r]=new RegExp(a.replace(".",""),"i")),n&&"dddd"===t&&i._fullWeekdaysParse[r].test(e))return r;if(n&&"ddd"===t&&i._shortWeekdaysParse[r].test(e))return r;if(n&&"dd"===t&&i._minWeekdaysParse[r].test(e))return r;if(!n&&i._weekdaysParse[r].test(e))return r}},pn.weekdaysRegex=function(e){return this._weekdaysParseExact?(g(this,"_weekdaysRegex")||Xe.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(g(this,"_weekdaysRegex")||(this._weekdaysRegex=Je),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},pn.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(g(this,"_weekdaysRegex")||Xe.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(g(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Ke),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},pn.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(g(this,"_weekdaysRegex")||Xe.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(g(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Qe),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},pn.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},pn.meridiem=function(e,t,n){return 11<e?n?"pm":"PM":n?"am":"AM"},ct("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=1===x(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),y.lang=n("moment.lang is deprecated. Use moment.locale instead.",ct),y.langData=n("moment.langData is deprecated. Use moment.localeData instead.",mt);var vn=Math.abs;function bn(e,t,n,r){var o=Gt(t,n);return e._milliseconds+=r*o._milliseconds,e._days+=r*o._days,e._months+=r*o._months,e._bubble()}function wn(e){return e<0?Math.floor(e):Math.ceil(e)}function _n(e){return 4800*e/146097}function kn(e){return 146097*e/4800}function xn(e){return function(){return this.as(e)}}var Dn=xn("ms"),Sn=xn("s"),An=xn("m"),Tn=xn("h"),Cn=xn("d"),En=xn("w"),Rn=xn("M"),Mn=xn("y");function On(e){return function(){return this.isValid()?this._data[e]:NaN}}var In=On("milliseconds"),Pn=On("seconds"),Un=On("minutes"),Yn=On("hours"),Ln=On("days"),jn=On("months"),Nn=On("years"),Fn=Math.round,qn={ss:44,s:45,m:45,h:22,d:26,M:11},Hn=Math.abs;function Wn(e){return(0<e)-(e<0)||+e}function Bn(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n=Hn(this._milliseconds)/1e3,r=Hn(this._days),o=Hn(this._months);e=k(n/60),t=k(e/60),n%=60,e%=60;var a=k(o/12),i=o%=12,s=r,u=t,l=e,c=n?n.toFixed(3).replace(/\.?0+$/,""):"",d=this.asSeconds();if(!d)return"P0D";var m=d<0?"-":"",f=Wn(this._months)!==Wn(d)?"-":"",p=Wn(this._days)!==Wn(d)?"-":"",h=Wn(this._milliseconds)!==Wn(d)?"-":"";return m+"P"+(a?f+a+"Y":"")+(i?f+i+"M":"")+(s?p+s+"D":"")+(u||l||c?"T":"")+(u?h+u+"H":"")+(l?h+l+"M":"")+(c?h+c+"S":"")}var Vn=Ut.prototype;return Vn.isValid=function(){return this._isValid},Vn.abs=function(){var e=this._data;return this._milliseconds=vn(this._milliseconds),this._days=vn(this._days),this._months=vn(this._months),e.milliseconds=vn(e.milliseconds),e.seconds=vn(e.seconds),e.minutes=vn(e.minutes),e.hours=vn(e.hours),e.months=vn(e.months),e.years=vn(e.years),this},Vn.add=function(e,t){return bn(this,e,t,1)},Vn.subtract=function(e,t){return bn(this,e,t,-1)},Vn.as=function(e){if(!this.isValid())return NaN;var t,n,r=this._milliseconds;if("month"===(e=I(e))||"year"===e)return t=this._days+r/864e5,n=this._months+_n(t),"month"===e?n:n/12;switch(t=this._days+Math.round(kn(this._months)),e){case"week":return t/7+r/6048e5;case"day":return t+r/864e5;case"hour":return 24*t+r/36e5;case"minute":return 1440*t+r/6e4;case"second":return 86400*t+r/1e3;case"millisecond":return Math.floor(864e5*t)+r;default:throw new Error("Unknown unit "+e)}},Vn.asMilliseconds=Dn,Vn.asSeconds=Sn,Vn.asMinutes=An,Vn.asHours=Tn,Vn.asDays=Cn,Vn.asWeeks=En,Vn.asMonths=Rn,Vn.asYears=Mn,Vn.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*x(this._months/12):NaN},Vn._bubble=function(){var e,t,n,r,o,a=this._milliseconds,i=this._days,s=this._months,u=this._data;return 0<=a&&0<=i&&0<=s||a<=0&&i<=0&&s<=0||(a+=864e5*wn(kn(s)+i),s=i=0),u.milliseconds=a%1e3,e=k(a/1e3),u.seconds=e%60,t=k(e/60),u.minutes=t%60,n=k(t/60),u.hours=n%24,i+=k(n/24),o=k(_n(i)),s+=o,i-=wn(kn(o)),r=k(s/12),s%=12,u.days=i,u.months=s,u.years=r,this},Vn.clone=function(){return Gt(this)},Vn.get=function(e){return e=I(e),this.isValid()?this[e+"s"]():NaN},Vn.milliseconds=In,Vn.seconds=Pn,Vn.minutes=Un,Vn.hours=Yn,Vn.days=Ln,Vn.weeks=function(){return k(this.days()/7)},Vn.months=jn,Vn.years=Nn,Vn.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t,n,r,o,a,i,s,u,l,c,d,m=this.localeData(),f=(n=!e,r=m,o=Gt(t=this).abs(),a=Fn(o.as("s")),i=Fn(o.as("m")),s=Fn(o.as("h")),u=Fn(o.as("d")),l=Fn(o.as("M")),c=Fn(o.as("y")),(d=a<=qn.ss&&["s",a]||a<qn.s&&["ss",a]||i<=1&&["m"]||i<qn.m&&["mm",i]||s<=1&&["h"]||s<qn.h&&["hh",s]||u<=1&&["d"]||u<qn.d&&["dd",u]||l<=1&&["M"]||l<qn.M&&["MM",l]||c<=1&&["y"]||["yy",c])[2]=n,d[3]=0<+t,d[4]=r,function(e,t,n,r,o){return o.relativeTime(t||1,!!n,e,r)}.apply(null,d));return e&&(f=m.pastFuture(+this,f)),m.postformat(f)},Vn.toISOString=Bn,Vn.toString=Bn,Vn.toJSON=Bn,Vn.locale=en,Vn.localeData=nn,Vn.toIsoString=n("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Bn),Vn.lang=tn,W("X",0,0,"unix"),W("x",0,0,"valueOf"),le("x",oe),le("X",/[+-]?\d+(\.\d{1,3})?/),fe("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e,10))}),fe("x",function(e,t,n){n._d=new Date(x(e))}),y.version="2.23.0",e=Rt,y.fn=mn,y.min=function(){return It("isBefore",[].slice.call(arguments,0))},y.max=function(){return It("isAfter",[].slice.call(arguments,0))},y.now=function(){return Date.now?Date.now():+new Date},y.utc=m,y.unix=function(e){return Rt(1e3*e)},y.months=function(e,t){return yn(e,t,"months")},y.isDate=i,y.locale=ct,y.invalid=p,y.duration=Gt,y.isMoment=_,y.weekdays=function(e,t,n){return gn(e,t,n,"weekdays")},y.parseZone=function(){return Rt.apply(null,arguments).parseZone()},y.localeData=mt,y.isDuration=Yt,y.monthsShort=function(e,t){return yn(e,t,"monthsShort")},y.weekdaysMin=function(e,t,n){return gn(e,t,n,"weekdaysMin")},y.defineLocale=dt,y.updateLocale=function(e,t){if(null!=t){var n,r,o=at;null!=(r=lt(e))&&(o=r._config),t=E(o,t),(n=new R(t)).parentLocale=it[e],it[e]=n,ct(e)}else null!=it[e]&&(null!=it[e].parentLocale?it[e]=it[e].parentLocale:null!=it[e]&&delete it[e]);return it[e]},y.locales=function(){return r(it)},y.weekdaysShort=function(e,t,n){return gn(e,t,n,"weekdaysShort")},y.normalizeUnits=I,y.relativeTimeRounding=function(e){return void 0!==e?"function"==typeof e&&(Fn=e,!0):Fn},y.relativeTimeThreshold=function(e,t){return void 0!==qn[e]&&(void 0===t?qn[e]:(qn[e]=t,"s"===e&&(qn.ss=t-1),!0))},y.calendarFormat=function(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"},y.prototype=mn,y.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},y}()}),j=Y(function(v,e){!function(e,t){var n,a,i,s,c,d,u,r,o,l,y,C,E,R,m,f,p,M,O,h,g;try{n=L}catch(e){}v.exports=(i="function"==typeof(a=n),s=!!window.addEventListener,c=window.document,d=window.setTimeout,u=function(e,t,n,r){s?e.addEventListener(t,n,!!r):e.attachEvent("on"+t,n)},r=function(e,t,n,r){s?e.removeEventListener(t,n,!!r):e.detachEvent("on"+t,n)},o=function(e,t,n){var r;c.createEvent?((r=c.createEvent("HTMLEvents")).initEvent(t,!0,!1),r=m(r,n),e.dispatchEvent(r)):c.createEventObject&&(r=c.createEventObject(),r=m(r,n),e.fireEvent("on"+t,r))},l=function(e,t){return-1!==(" "+e.className+" ").indexOf(" "+t+" ")},y=function(e){return/Array/.test(Object.prototype.toString.call(e))},C=function(e){return/Date/.test(Object.prototype.toString.call(e))&&!isNaN(e.getTime())},p={field:null,bound:void 0,position:"bottom left",reposition:!0,format:"YYYY-MM-DD",defaultDate:null,setDefaultDate:!(f=function(e){return e.month<0&&(e.year-=Math.ceil(Math.abs(e.month)/12),e.month+=12),11<e.month&&(e.year+=Math.floor(Math.abs(e.month)/12),e.month-=12),e}),firstDay:0,minDate:null,maxDate:null,yearRange:10,showWeekNumber:!(m=function(e,t,n){var r,o;for(r in t)(o=void 0!==e[r])&&"object"==typeof t[r]&&null!==t[r]&&void 0===t[r].nodeName?C(t[r])?n&&(e[r]=new Date(t[r].getTime())):y(t[r])?n&&(e[r]=t[r].slice(0)):e[r]=m({},t[r],n):!n&&o||(e[r]=t[r]);return e}),minYear:0,maxYear:9999,minMonth:void 0,maxMonth:void 0,startRange:null,endRange:null,isRTL:!(R=function(e,t){return e.getTime()===t.getTime()}),yearSuffix:"",showMonthAfterYear:!(E=function(e){C(e)&&e.setHours(0,0,0,0)}),numberOfMonths:1,mainCalendar:"left",container:void 0,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},theme:null,onSelect:null,onOpen:null,onClose:null,onDraw:null},M=function(e,t,n){for(t+=e.firstDay;7<=t;)t-=7;return n?e.i18n.weekdaysShort[t]:e.i18n.weekdays[t]},O=function(e){if(e.isEmpty)return'<td class="is-empty"></td>';var t=[];return e.isDisabled&&t.push("is-disabled"),e.isToday&&t.push("is-today"),e.isSelected&&t.push("is-selected"),e.isInRange&&t.push("is-inrange"),e.isStartRange&&t.push("is-startrange"),e.isEndRange&&t.push("is-endrange"),'<td data-day="'+e.day+'" class="'+t.join(" ")+'"><button class="pika-button pika-day" type="button" data-pika-year="'+e.year+'" data-pika-month="'+e.month+'" data-pika-day="'+e.day+'">'+e.day+"</button></td>"},h=function(e,t,n,r,o){var a,i,s,u,l,c=e._o,d=n===c.minYear,m=n===c.maxYear,f='<div class="pika-title">',p=!0,h=!0;for(s=[],a=0;a<12;a++)s.push('<option value="'+(n===o?a-t:12+a-t)+'"'+(a===r?" selected":"")+(d&&a<c.minMonth||m&&a>c.maxMonth?"disabled":"")+">"+c.i18n.months[a]+"</option>");for(u='<div class="pika-label">'+c.i18n.months[r]+'<select class="pika-select pika-select-month" tabindex="-1">'+s.join("")+"</select></div>",i=y(c.yearRange)?(a=c.yearRange[0],c.yearRange[1]+1):(a=n-c.yearRange,1+n+c.yearRange),s=[];a<i&&a<=c.maxYear;a++)a>=c.minYear&&s.push('<option value="'+a+'"'+(a===n?" selected":"")+">"+a+"</option>");return l='<div class="pika-label">'+n+c.yearSuffix+'<select class="pika-select pika-select-year" tabindex="-1">'+s.join("")+"</select></div>",c.showMonthAfterYear?f+=l+u:f+=u+l,d&&(0===r||c.minMonth>=r)&&(p=!1),m&&(11===r||c.maxMonth<=r)&&(h=!1),0===t&&(f+='<button class="pika-prev'+(p?"":" is-disabled")+'" type="button">'+c.i18n.previousMonth+"</button>"),t===e._o.numberOfMonths-1&&(f+='<button class="pika-next'+(h?"":" is-disabled")+'" type="button">'+c.i18n.nextMonth+"</button>"),f+="</div>"},(g=function(e){var r=this,o=r.config(e);r._onMouseDown=function(e){if(r._v){var t=(e=e||window.event).target||e.srcElement;if(t)if(l(t,"is-disabled")||(l(t,"pika-button")&&!l(t,"is-empty")?(r.setDate(new Date(t.getAttribute("data-pika-year"),t.getAttribute("data-pika-month"),t.getAttribute("data-pika-day"))),o.bound&&d(function(){r.hide(),o.field&&o.field.blur()},100)):l(t,"pika-prev")?r.prevMonth():l(t,"pika-next")&&r.nextMonth()),l(t,"pika-select"))r._c=!0;else{if(!e.preventDefault)return e.returnValue=!1;e.preventDefault()}}},r._onChange=function(e){var t=(e=e||window.event).target||e.srcElement;t&&(l(t,"pika-select-month")?r.gotoMonth(t.value):l(t,"pika-select-year")&&r.gotoYear(t.value))},r._onInputChange=function(e){var t;e.firedBy!==r&&(t=i?(t=a(o.field.value,o.format))&&t.isValid()?t.toDate():null:new Date(Date.parse(o.field.value)),C(t)&&r.setDate(t),r._v||r.show())},r._onInputFocus=function(){r.show()},r._onInputClick=function(){r.show()},r._onInputBlur=function(){var e=c.activeElement;do{if(l(e,"pika-single"))return}while(e=e.parentNode);r._c||(r._b=d(function(){r.hide()},50)),r._c=!1},r._onClick=function(e){var t=(e=e||window.event).target||e.srcElement,n=t;if(t){!s&&l(t,"pika-select")&&(t.onchange||(t.setAttribute("onchange","return;"),u(t,"change",r._onChange)));do{if(l(n,"pika-single")||n===o.trigger)return}while(n=n.parentNode);r._v&&t!==o.trigger&&n!==o.trigger&&r.hide()}},r.el=c.createElement("div"),r.el.className="pika-single"+(o.isRTL?" is-rtl":"")+(o.theme?" "+o.theme:""),u(r.el,"mousedown",r._onMouseDown,!0),u(r.el,"touchend",r._onMouseDown,!0),u(r.el,"change",r._onChange),o.field&&(o.container?o.container.appendChild(r.el):o.bound?c.body.appendChild(r.el):o.field.parentNode.insertBefore(r.el,o.field.nextSibling),u(o.field,"change",r._onInputChange),o.defaultDate||(i&&o.field.value?o.defaultDate=a(o.field.value,o.format).toDate():o.defaultDate=new Date(Date.parse(o.field.value)),o.setDefaultDate=!0));var t=o.defaultDate;C(t)?o.setDefaultDate?r.setDate(t,!0):r.gotoDate(t):r.gotoDate(new Date),o.bound?(this.hide(),r.el.className+=" is-bound",u(o.trigger,"click",r._onInputClick),u(o.trigger,"focus",r._onInputFocus),u(o.trigger,"blur",r._onInputBlur)):this.show()}).prototype={config:function(e){this._o||(this._o=m({},p,!0));var t=m(this._o,e,!0);t.isRTL=!!t.isRTL,t.field=t.field&&t.field.nodeName?t.field:null,t.theme="string"==typeof t.theme&&t.theme?t.theme:null,t.bound=!!(void 0!==t.bound?t.field&&t.bound:t.field),t.trigger=t.trigger&&t.trigger.nodeName?t.trigger:t.field,t.disableWeekends=!!t.disableWeekends,t.disableDayFn="function"==typeof t.disableDayFn?t.disableDayFn:null;var n=parseInt(t.numberOfMonths,10)||1;if(t.numberOfMonths=4<n?4:n,C(t.minDate)||(t.minDate=!1),C(t.maxDate)||(t.maxDate=!1),t.minDate&&t.maxDate&&t.maxDate<t.minDate&&(t.maxDate=t.minDate=!1),t.minDate&&this.setMinDate(t.minDate),t.maxDate&&this.setMaxDate(t.maxDate),y(t.yearRange)){var r=(new Date).getFullYear()-10;t.yearRange[0]=parseInt(t.yearRange[0],10)||r,t.yearRange[1]=parseInt(t.yearRange[1],10)||r}else t.yearRange=Math.abs(parseInt(t.yearRange,10))||p.yearRange,100<t.yearRange&&(t.yearRange=100);return t},toString:function(e){return C(this._d)?i?a(this._d).format(e||this._o.format):this._d.toDateString():""},getMoment:function(){return i?a(this._d):null},setMoment:function(e,t){i&&a.isMoment(e)&&this.setDate(e.toDate(),t)},getDate:function(){return C(this._d)?new Date(this._d.getTime()):null},setDate:function(e,t){if(!e)return this._d=null,this._o.field&&(this._o.field.value="",o(this._o.field,"change",{firedBy:this})),this.draw();if("string"==typeof e&&(e=new Date(Date.parse(e))),C(e)){var n=this._o.minDate,r=this._o.maxDate;C(n)&&e<n?e=n:C(r)&&r<e&&(e=r),this._d=new Date(e.getTime()),E(this._d),this.gotoDate(this._d),this._o.field&&(this._o.field.value=this.toString(),o(this._o.field,"change",{firedBy:this})),t||"function"!=typeof this._o.onSelect||this._o.onSelect.call(this,this.getDate())}},gotoDate:function(e){var t=!0;if(C(e)){if(this.calendars){var n=new Date(this.calendars[0].year,this.calendars[0].month,1),r=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),o=e.getTime();r.setMonth(r.getMonth()+1),r.setDate(r.getDate()-1),t=o<n.getTime()||r.getTime()<o}t&&(this.calendars=[{month:e.getMonth(),year:e.getFullYear()}],"right"===this._o.mainCalendar&&(this.calendars[0].month+=1-this._o.numberOfMonths)),this.adjustCalendars()}},adjustCalendars:function(){this.calendars[0]=f(this.calendars[0]);for(var e=1;e<this._o.numberOfMonths;e++)this.calendars[e]=f({month:this.calendars[0].month+e,year:this.calendars[0].year});this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(e){isNaN(e)||(this.calendars[0].month=parseInt(e,10),this.adjustCalendars())},nextMonth:function(){this.calendars[0].month++,this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--,this.adjustCalendars()},gotoYear:function(e){isNaN(e)||(this.calendars[0].year=parseInt(e,10),this.adjustCalendars())},setMinDate:function(e){E(e),this._o.minDate=e,this._o.minYear=e.getFullYear(),this._o.minMonth=e.getMonth(),this.draw()},setMaxDate:function(e){E(e),this._o.maxDate=e,this._o.maxYear=e.getFullYear(),this._o.maxMonth=e.getMonth(),this.draw()},setStartRange:function(e){this._o.startRange=e},setEndRange:function(e){this._o.endRange=e},draw:function(e){var t=this;if(this._v||e){var n=this._o,r=n.minYear,o=n.maxYear,a=n.minMonth,i=n.maxMonth,s="";this._y<=r&&(this._y=r,!isNaN(a)&&this._m<a&&(this._m=a)),this._y>=o&&(this._y=o,!isNaN(i)&&this._m>i&&(this._m=i));for(var u=0;u<n.numberOfMonths;u++)s+='<div class="pika-lendar">'+h(t,u,t.calendars[u].year,t.calendars[u].month,t.calendars[0].year)+t.render(t.calendars[u].year,t.calendars[u].month)+"</div>";if(this.el.innerHTML=s,n.bound&&"hidden"!==n.field.type&&d(function(){n.trigger.focus()},1),"function"==typeof this._o.onDraw){var l=this;d(function(){l._o.onDraw.call(l)},0)}}},adjustPosition:function(){var e,t,n,r,o,a,i,s,u,l;if(!this._o.container){if(this.el.style.position="absolute",t=e=this._o.trigger,n=this.el.offsetWidth,r=this.el.offsetHeight,o=window.innerWidth||c.documentElement.clientWidth,a=window.innerHeight||c.documentElement.clientHeight,i=window.pageYOffset||c.body.scrollTop||c.documentElement.scrollTop,"function"==typeof e.getBoundingClientRect)s=(l=e.getBoundingClientRect()).left+window.pageXOffset,u=l.bottom+window.pageYOffset;else for(s=t.offsetLeft,u=t.offsetTop+t.offsetHeight;t=t.offsetParent;)s+=t.offsetLeft,u+=t.offsetTop;(this._o.reposition&&o<s+n||-1<this._o.position.indexOf("right")&&0<s-n+e.offsetWidth)&&(s=s-n+e.offsetWidth),(this._o.reposition&&a+i<u+r||-1<this._o.position.indexOf("top")&&0<u-r-e.offsetHeight)&&(u=u-r-e.offsetHeight),this.el.style.left=s+"px",this.el.style.top=u+"px"}},render:function(e,t){var n,r=this._o,o=new Date,a=[31,(n=e,n%4==0&&n%100!=0||n%400==0?29:28),31,30,31,30,31,31,30,31,30,31][t],i=new Date(e,t,1).getDay(),s=[],u=[];E(o),0<r.firstDay&&(i-=r.firstDay)<0&&(i+=7);for(var l,c,d,m,f,p,h,y=a+i,g=y;7<g;)g-=7;y+=7-g;for(var v=0,b=0;v<y;v++){var w=new Date(e,t,v-i+1),_=!!C(this._d)&&R(w,this._d),k=R(w,o),x=v<i||a+i<=v,D=r.startRange&&R(r.startRange,w),S=r.endRange&&R(r.endRange,w),A=r.startRange&&r.endRange&&r.startRange<w&&w<r.endRange,T={day:v-i+1,month:t,year:e,isSelected:_,isToday:k,isDisabled:r.minDate&&w<r.minDate||r.maxDate&&w>r.maxDate||r.disableWeekends&&(0===(p=w.getDay())||6===p)||r.disableDayFn&&r.disableDayFn(w),isEmpty:x,isStartRange:D,isEndRange:S,isInRange:A};u.push(O(T)),7==++b&&(r.showWeekNumber&&u.unshift((c=v-i,d=t,m=e,f=void 0,f=new Date(m,0,1),'<td class="pika-week">'+Math.ceil(((new Date(m,d,c)-f)/864e5+f.getDay()+1)/7)+"</td>")),s.push((l=u,"<tr>"+(r.isRTL?l.reverse():l).join("")+"</tr>")),u=[],b=0)}return h=s,'<table cellpadding="0" cellspacing="0" class="pika-table">'+function(e){var t,n=[];for(e.showWeekNumber&&n.push("<th></th>"),t=0;t<7;t++)n.push('<th scope="col"><abbr title="'+M(e,t)+'">'+M(e,t,!0)+"</abbr></th>");return"<thead>"+(e.isRTL?n.reverse():n).join("")+"</thead>"}(r)+"<tbody>"+h.join("")+"</tbody></table>"},isVisible:function(){return this._v},show:function(){var e,t,n;this._v||(e=this.el,t="is-hidden",e.className=(n=(" "+e.className+" ").replace(" "+t+" "," ")).trim?n.trim():n.replace(/^\s+|\s+$/g,""),this._v=!0,this.draw(),this._o.bound&&(u(c,"click",this._onClick),this.adjustPosition()),"function"==typeof this._o.onOpen&&this._o.onOpen.call(this))},hide:function(){var e,t,n=this._v;!1!==n&&(this._o.bound&&r(c,"click",this._onClick),this.el.style.position="static",this.el.style.left="auto",this.el.style.top="auto",e=this.el,l(e,t="is-hidden")||(e.className=""===e.className?t:e.className+" "+t),this._v=!1,void 0!==n&&"function"==typeof this._o.onClose&&this._o.onClose.call(this))},destroy:function(){this.hide(),r(this.el,"mousedown",this._onMouseDown,!0),r(this.el,"touchend",this._onMouseDown,!0),r(this.el,"change",this._onChange),this._o.field&&(r(this._o.field,"change",this._onInputChange),this._o.bound&&(r(this._o.trigger,"click",this._onInputClick),r(this._o.trigger,"focus",this._onInputFocus),r(this._o.trigger,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},g)}()}),N=Y(function(e){var t,n;t="undefined"!=typeof window?window:U,n=function e(p,E){g.version=function(){return"v0.2.8"};var h={}.hasOwnProperty,d={}.toString;function R(e){return"function"==typeof e}function m(e){return"[object Object]"===d.call(e)}function M(e){return"[object String]"===d.call(e)}var b=Array.isArray||function(e){return"[object Array]"===d.call(e)};function i(){}var O,y,n,r,s={AREA:1,BASE:1,BR:1,COL:1,COMMAND:1,EMBED:1,HR:1,IMG:1,INPUT:1,KEYGEN:1,LINK:1,META:1,PARAM:1,SOURCE:1,TRACK:1,WBR:1};function g(e,t){for(var n=arguments,r=[],o=1,a=arguments.length;o<a;o++)r[o-1]=n[o];if(e&&R(e.view))return ie(e,r);if(!M(e))throw new Error("selector in m(selector, attrs, children) should be a string");var i,s,u,l=null!=t&&m(t)&&!("tag"in t||"view"in t||"subtree"in t),c=l?t:{},d={tag:"div",attrs:{},children:(i=r,s=l,u=s?i.slice(1):i,1===u.length&&b(u[0])?u[0]:u)};return function(e,t,n){var r="class"in t?"class":"className";for(var o in t)h.call(t,o)&&(o===r&&null!=t[o]&&""!==t[o]?(n.push(t[o]),e[o]=""):e[o]=t[o]);n.length&&(e[r]=n.join(" "))}(d.attrs,c,function(e,t){var n,r=[],o=/(?:(^|#|\.)([^#\.\[\]]+))|(\[(.+?)(?:\s*=\s*("|'|)((?:\\["'\]]|.)*?)\5)?\])/g;for(;n=o.exec(t);)if(""===n[1]&&n[2])e.tag=n[2];else if("#"===n[1])e.attrs.id=n[2];else if("."===n[1])r.push(n[2]);else if("["===n[3].charAt(0)){var a=n[6];a&&(a=a.replace(/\\(["'])/g,"$1")),"class"===n[4]?r.push(a):e.attrs[n[4]]=a||!0}return r}(d,e)),d}function w(e,t){for(var n=0;n<e.length&&!t(e[n],n++););}function _(e,n){w(e,function(e,t){return(e=e&&e.attrs)&&null!=e.key&&n(e,t)})}function I(e,t,n){e.insertBefore(t,e.childNodes[n]||null)}(g.deps=function(e){var t;return t=p=e||window,O=t.document,y=t.location,r=t.cancelAnimationFrame||t.clearTimeout,n=t.requestAnimationFrame||t.setTimeout,p}).factory=g.factory=e,g.deps(p);var k=1,l=2,c=3;function x(e,r,t,n){var o=e.length!==r.length;return o||_(e,function(e,t){var n=r[t];return o=n&&n.attrs&&n.attrs.key!==e.key}),o?function(a,n,i,s){_(a,function(e,t){n[e=e.key]=n[e]?{action:c,index:t,from:n[e].index,element:i.nodes[n[e].index]||O.createElement("div")}:{action:l,index:t}});var e=[];for(var t in n)h.call(n,t)&&e.push(n[t]);var r=e.sort(j),u=new Array(i.length);return u.nodes=i.nodes.slice(),w(r,function(e){var t=e.index;if(e.action===k&&(W(i[t].nodes,i[t]),u.splice(t,1)),e.action===l){var n=O.createElement("div");n.key=a[t].attrs.key,I(s,n,t),u.splice(t,0,{attrs:{key:a[t].attrs.key},nodes:[n]}),u.nodes[t]=n}if(e.action===c){var r=e.element,o=s.childNodes[t];o!==r&&null!==r&&s.insertBefore(r,o||null),u[t]=i[e.from],u.nodes[t]=r}}),u}(e,t,r,n):r}function P(e,t,n){var r,o,a;o=t,a=n,((r=e).tag!==o.tag||a.sort().join()!==Object.keys(o.attrs).sort().join()||r.attrs.id!==o.attrs.id||r.attrs.key!==o.attrs.key||("all"!==g.redraw.strategy()?"diff"===g.redraw.strategy()&&o.configContext&&!1===o.configContext.retain:!o.configContext||!0!==o.configContext.retain))&&(t.nodes.length&&W(t.nodes),t.configContext&&R(t.configContext.onunload)&&t.configContext.onunload(),t.controllers&&w(t.controllers,function(e){e.onunload&&e.onunload({preventDefault:i})}))}var f=0;function u(e,t,n,r,o,a){var i=t.nodes;return r&&r===O.activeElement&&e===t||(e.$trusted?(W(i,t),i=V(n,o,e)):"textarea"===a?n.value=e:r?(r.innerHTML=e,i=[].slice.call(r.childNodes)):((1===i[0].nodeType||1<i.length||i[0].nodeValue.trim&&!i[0].nodeValue.trim())&&(W(t.nodes,t),i=[O.createTextNode(e)]),function(e,t,n,r){try{I(e,t,n),t.nodeValue=r}catch(e){}}(n,i[0],o,e))),(t=new e.constructor(e)).nodes=i,t.$trusted=e.$trusted,t}function v(e,t,n,r,o,a,i){return e.nodes.length?e.valueOf()!==t.valueOf()||o?u(t,e,r,a,n,i):(e.nodes.intact=!0,e):function(e,t,n){var r,o;e.$trusted?r=V(t,n,e):(r=[O.createTextNode(e)],t.nodeName in s||I(t,r[0],n));o="string"==typeof e||"number"==typeof e||"boolean"==typeof e?new e.constructor(e):e;return o.nodes=r,o}(t,r,n)}function D(e){return e.$trusted?e.nodes.length:b(e)?e.length:1}function S(e,n,t,r,o,a,i,s,u){e=function(e){for(var t=0;t<e.length;t++)b(e[t])&&(e=e.concat.apply([],e),t--);return e}(e);var l,c,d=n.length===e.length,m=0,f={},p=!1;_(n,function(e,t){p=!0,f[n[t].attrs.key]={action:k,index:t}}),c=0,_(l=e,function(){return w(l,function(e){(e=e&&e.attrs)&&null==e.key&&(e.key="__mithril__"+c++)}),1}),p&&(n=x(e,n,f,t));for(var h=0,y=0,g=e.length;y<g;y++){var v=L(t,o,n,r,e[y],n[h],a,r+m||m,i,s,u);v!==E&&(d=d&&v.nodes.intact,m+=D(v),n[h++]=v)}return d||function(e,n,r){w(e,function(e,t){null!=n[t]&&r.push.apply(r,n[t].nodes)}),w(n.nodes,function(e,t){null!=e.parentNode&&r.indexOf(e)<0&&W([e],[n[t]])}),e.length<n.length&&(n.length=e.length);n.nodes=r}(e,n,[]),n}function U(e,t,n,r,o,a,i){var s,u,l,c={tag:e.tag,attrs:t,children:n,nodes:[r]};return s=c,u=a,(l=i).length&&(s.views=u,w(s.controllers=l,function(e){if(e.onunload&&e.onunload.$old&&(e.onunload=e.onunload.$old),f&&e.onunload){var t=e.onunload;e.onunload=function(){},e.onunload.$old=t}})),c.children&&!c.children.nodes&&(c.children.nodes=[]),c}g.startComputation=function(){f++},g.endComputation=function(){1<f?f--:(f=0,g.redraw())};var A=[];var T=!1;function Y(e,t,n,r,o,a){var i=function(e,t,n,r){var o;o="diff"===g.redraw.strategy()&&e?e.indexOf(t):-1;return-1<o?n[o]:R(r)?new r:{}}(n.views,t,r,e.controller),s=e&&e.attrs&&e.attrs.key;return"retain"===(e=0===f||T||r&&-1<r.indexOf(i)?e.view(i):{tag:"placeholder"}).subtree||(e.attrs=e.attrs||{},e.attrs.key=s,function(e,t,n,r){null!=r.onunload&&A.map(function(e){return e.handler}).indexOf(r.onunload)<0&&A.push({controller:r,handler:r.onunload});e.push(n),t.push(r)}(a,o,t,i)),e}function C(e,t,n,r,o,a,i,s){var u=[],l=[];if("retain"===(e=function(e,t,n,r){var o=t&&t.controllers;for(;null!=e.view;)e=Y(e,e.view.$original||e.view,t,o,r,n);return e}(e,t,u,l)).subtree)return t;if(!e.tag&&l.length)throw new Error("Component template must return a virtual element, not an array, string, etc.");e.attrs=e.attrs||{},t.attrs=t.attrs||{};var c=Object.keys(e.attrs),d=c.length>("key"in e.attrs?1:0);if(P(e,t,c),M(e.tag)){var m,f,p,h,y,g,v,b,w,_,k,x,D,S,A=0===t.nodes.length;if(f=i,i=(m=e).attrs.xmlns?m.attrs.xmlns:"svg"===m.tag?"http://www.w3.org/2000/svg":"math"===m.tag?"http://www.w3.org/1998/Math/MathML":f,A){S=i,p=(D=e).attrs.is?null==S?O.createElement(D.tag,D.attrs.is):O.createElementNS(S,D.tag,D.attrs.is):null==S?O.createElement(D.tag):O.createElementNS(S,D.tag);var T=(_=e,k=p,x=i,d?H(k,_.tag,_.attrs,{},x):_.attrs);I(r,p,o);var C=(y=p,g=t,v=n,b=i,w=s,null!=(h=e).children&&0<h.children.length?L(y,h.tag,E,E,h.children,g.children,!0,0,h.attrs.contenteditable?y:v,b,w):h.children);t=U(e,T,C,p,i,u,l)}else p=function(e,t,n,r,o,a,i,s){var u=e.nodes[0];r&&H(u,t.tag,t.attrs,e.attrs,o);e.children=L(u,t.tag,E,E,t.children,e.children,!1,0,t.attrs.contenteditable?u:n,o,i),e.nodes.intact=!0,s.length&&(e.views=a,e.controllers=s);return u}(t,e,n,d,i,u,s,l);return"select"===e.tag&&"value"in e.attrs&&H(p,e.tag,{value:e.attrs.value},{},i),A||!0!==a||null==p||I(r,p,o),function(e,t,n,r,o){if(R(t.attrs.config)){var a=o.configContext=o.configContext||{};e.push(function(){return t.attrs.config.call(t,n,!r,a,o)})}}(s,e,p,A,t),t}}function L(e,t,n,r,o,a,i,s,u,l,c){return"retain"===(o=function(e){try{if("boolean"!=typeof e&&null!=e&&null!=e.toString())return e}catch(e){}return""}(o)).subtree?a:(a=function(e,t,n,r,o){if(null!=t){if(d.call(t)===d.call(e))return t;if(o&&o.nodes){var a=n-r,i=a+(b(e)?e:t.nodes).length;W(o.nodes.slice(a,i),o.slice(a,i))}else t.nodes&&W(t.nodes,t)}(t=new e.constructor).tag&&(t={});return t.nodes=[],t}(o,a,s,r,n),b(o)?S(o,a,e,s,t,i,u,l,c):null!=o&&m(o)?C(o,a,u,e,s,i,l,c):R(o)?a:v(a,o,s,e,i,u,t))}function j(e,t){return e.action-t.action||e.index-t.index}var t,N={list:1,style:1,form:1,type:1,width:1,height:1};function F(t,n,r,e,o,a){if("config"===n||"key"===n)return!0;if(R(r)&&"on"===n.slice(0,2))t[n]=(i=r,s=t,function(e){e=e||event,g.redraw.strategy("diff"),g.startComputation();try{return i.call(s,e)}finally{ce()}});else if("style"===n&&null!=r&&m(r))!function(e,t,n){n===t&&(e.style="",n={});for(var r in t)h.call(t,r)&&(null!=n&&n[r]===t[r]||(e.style[r]=t[r]));for(r in n)h.call(n,r)&&(h.call(t,r)||(e.style[r]=""))}(t,r,e);else if(null!=a)"href"===n?t.setAttributeNS("http://www.w3.org/1999/xlink","href",r):t.setAttribute("className"===n?"class":n,r);else if(n in t&&!N[n])try{("input"!==o&&!t.isContentEditable||t[n]!=r)&&(t[n]=r)}catch(e){t.setAttribute(n,r)}else try{t.setAttribute(n,r)}catch(e){}var i,s}function q(e,t,n,r,o,a,i){if(t in o&&r===n&&"object"!=typeof n&&O.activeElement!==e)"value"===t&&"input"===a&&e.value!=n&&(e.value=n);else{o[t]=n;try{return F(e,t,n,r,a,i)}catch(e){if(e.message.indexOf("Invalid argument")<0)throw e}}}function H(e,t,n,r,o){for(var a in n)!h.call(n,a)||q(e,a,n[a],r[a],r,t,o);return r}function W(e,t){for(var n=e.length-1;-1<n;n--)if(e[n]&&e[n].parentNode){try{e[n].parentNode.removeChild(e[n])}catch(e){}(t=[].concat(t))[n]&&o(t[n])}e.length&&(e.length=0)}function o(e){e.configContext&&R(e.configContext.onunload)&&(e.configContext.onunload(),e.configContext.onunload=null),e.controllers&&w(e.controllers,function(e){R(e.onunload)&&e.onunload({preventDefault:i})}),e.children&&(b(e.children)?w(e.children,o):e.children.tag&&o(e.children))}function B(t,n){try{t.appendChild(O.createRange().createContextualFragment(n))}catch(e){t.insertAdjacentHTML("beforeend",n),function e(t){if("SCRIPT"===t.tagName)t.parentNode.replaceChild(a(t),t);else{var n=t.childNodes;if(n&&n.length)for(var r=0;r<n.length;r++)e(n[r])}return t}(t)}}function a(e){for(var t=document.createElement("script"),n=e.attributes,r=0;r<n.length;r++)t.setAttribute(n[r].name,n[r].value);return t.text=e.innerHTML,t}function V(e,t,n){var r=e.childNodes[t];if(r){var o=1!==r.nodeType,a=O.createElement("span");o?(e.insertBefore(a,r||null),a.insertAdjacentHTML("beforebegin",n),e.removeChild(a)):r.insertAdjacentHTML("beforebegin",n)}else B(e,n);for(var i=[];e.childNodes[t]!==r;)i.push(e.childNodes[t]),t++;return i}var G={appendChild:function(e){t===E&&(t=O.createElement("html")),O.documentElement&&O.documentElement!==e?O.replaceChild(e,O.documentElement):O.appendChild(e),this.childNodes=O.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},z=[],$={};function Z(e){var t=z.indexOf(e);return t<0?z.push(e)-1:t}g.render=function(e,t,n){if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var r,o=[],a=Z(e),i=e===O;r=i||e===O.documentElement?G:e,i&&"html"!==t.tag&&(t={tag:"html",attrs:{},children:t}),$[a]===E&&W(r.childNodes),!0===n&&we(e),$[a]=L(r,null,E,E,t,$[a],!1,0,null,E,o),w(o,function(e){e()})},g.trust=function(e){return(e=new String(e)).$trusted=!0,e},g.prop=function(e){return(null!=e&&(m(e)||R(e))||"undefined"!=typeof Promise&&e instanceof Promise)&&R(e.then)?_e(e):function(e){function t(){return arguments.length&&(e=arguments[0]),e}return t.toJSON=function(){return e&&R(e.toJSON)?e.toJSON():e},t}(e)};var J,K,Q,X=[],ee=[],te=[],ne=null,re=0,oe=null,ae=null;function ie(o,a){function e(){return(o.controller||i).apply(this,a)||this}function t(e){for(var t=arguments,n=[e].concat(a),r=1;r<arguments.length;r++)n.push(t[r]);return o.view.apply(o,n)}o.controller&&(e.prototype=o.controller.prototype),t.$original=o.view;var n={controller:e,view:t};return a[0]&&null!=a[0].key&&(n.attrs={key:a[0].key}),n}function se(e,t){X.splice(t,1),te.splice(t,1),ee.splice(t,1),we(e),z.splice(Z(e),1),A=[]}g.component=function(e){for(var t=arguments,n=new Array(arguments.length-1),r=1;r<arguments.length;r++)n[r-1]=t[r];return ie(e,n)},g.mount=g.module=function(e,t){if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var n=X.indexOf(e);n<0&&(n=X.length);var r=!1,o={preventDefault:function(){r=!0,oe=ae=null}};return w(A,function(e){e.handler.call(e.controller,o),e.controller.onunload=null}),r?w(A,function(e){e.controller.onunload=e.handler}):A=[],te[n]&&R(te[n].onunload)&&te[n].onunload(o),function(e,t,n,r){{if(!r){var o;g.redraw.strategy("all"),g.startComputation(),X[n]=t,o=J=e||(e={controller:i});var a=new(e.controller||i);return o===J&&(te[n]=a,ee[n]=e),ce(),null===e&&se(t,n),te[n]}null==e&&se(t,n),Q&&(K=Q)}}(t,e,n,r)};var ue=!1;function le(){oe&&(oe(),oe=null),w(X,function(e,t){var n=ee[t];if(te[t]){var r=[te[t]];g.render(e,n.view?n.view(te[t],r):"")}}),ae&&(ae(),ae=null),ne=null,re=new Date,g.redraw.strategy("diff")}function ce(){"none"===g.redraw.strategy()?(f--,g.redraw.strategy("diff")):g.endComputation()}(g.redraw=function(e){if(!ue){ue=!0,e&&(T=!0);try{ne&&!e?(n===p.requestAnimationFrame||16<new Date-re)&&(0<ne&&r(ne),ne=n(le,16)):(le(),ne=n(function(){ne=null},16))}finally{ue=T=!1}}}).strategy=g.prop(),g.withAttr=function(o,a,i){return function(e){var t=(e=e||window.event).currentTarget||this,n=i||this,r=o in t?t[o]:t.getAttribute(o);a.call(n,r)}};var de,me={pathname:"",hash:"#",search:"?"},fe=i,pe=!1;function he(e){return e.slice(me[g.route.mode].length)}function ye(e){if(!((e=e||event).ctrlKey||e.metaKey||e.shiftKey||2===e.which)){e.preventDefault?e.preventDefault():e.returnValue=!1;var t,n=e.currentTarget||e.srcElement;for(t="pathname"===g.route.mode&&n.search?be(n.search.slice(1)):{};n&&!/a/i.test(n.nodeName);)n=n.parentNode;f=0,g.route(n[g.route.mode].slice(me[g.route.mode].length),t)}}function ge(){"hash"!==g.route.mode&&y.hash?y.hash=y.hash:p.scrollTo(0,0)}function ve(e,t){var n={},r=[];for(var o in e)if(h.call(e,o)){var a=t?t+"["+o+"]":o,i=e[o];if(null===i)r.push(encodeURIComponent(a));else if(m(i))r.push(ve(i,a));else if(b(i)){var s=[];n[a]=n[a]||{},w(i,function(e){n[a][e]||(n[a][e]=!0,s.push(encodeURIComponent(a)+"="+encodeURIComponent(e)))}),r.push(s.join("&"))}else i!==E&&r.push(encodeURIComponent(a)+"="+encodeURIComponent(i))}return r.join("&")}function be(e){if(""===e||null==e)return{};"?"===e.charAt(0)&&(e=e.slice(1));var t=e.split("&"),o={};return w(t,function(e){var t=e.split("="),n=decodeURIComponent(t[0]),r=2===t.length?decodeURIComponent(t[1]):null;null!=o[n]?(b(o[n])||(o[n]=[o[n]]),o[n].push(r)):o[n]=r}),o}function we(e){var t=Z(e);W(e.childNodes,$[t]),$[t]=E}function _e(n,r){var e=g.prop(r);return n.then(e),e.then=function(e,t){return _e(n.then(e,t),r)},e.catch=e.then.bind(null,null),e}(g.route=function(n,r,o,e){if(0===arguments.length)return K;if(3===arguments.length&&M(r)){fe=function(e){var t=K=he(e);if(!function(t,r,e){de={};var n=e.indexOf("?");-1!==n&&(de=be(e.substr(n+1,e.length)),e=e.substr(0,n));var o=Object.keys(r),a=o.indexOf(e);if(-1!==a)return g.mount(t,r[o[a]]),!0;for(var i in r)if(h.call(r,i)){if(i===e)return g.mount(t,r[i]),!0;var s=new RegExp("^"+i.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(s.test(e))return e.replace(s,function(){var e=i.match(/:[^\/]+/g)||[],n=[].slice.call(arguments,1,-2);w(e,function(e,t){de[e.replace(/:|\./g,"")]=decodeURIComponent(n[t])}),g.mount(t,r[i])}),!0}}(n,o,t)){if(pe)throw new Error("Ensure the default route matches one of the routes defined in m.route");g.route(r,pe=!0),pe=!1}};var t="hash"===g.route.mode?"onhashchange":"onpopstate";return p[t]=function(){var e=y[g.route.mode];"pathname"===g.route.mode&&(e+=y.search),K!==he(e)&&fe(e)},oe=ge,void p[t]()}if(n.addEventListener||n.attachEvent){var a="pathname"!==g.route.mode?y.pathname:"";return n.href=a+me[g.route.mode]+e.attrs.href,void(n.addEventListener?(n.removeEventListener("click",ye),n.addEventListener("click",ye)):(n.detachEvent("onclick",ye),n.attachEvent("onclick",ye)))}if(M(n)){Q=K;var i,s=r||{},u=(K=n).indexOf("?");for(var l in i=-1<u?be(K.slice(u+1)):{},s)h.call(s,l)&&(i[l]=s[l]);var c,d=ve(i);c=-1<u?K.slice(0,u):K,d&&(K=c+(-1===c.indexOf("?")?"?":"&")+d);var m=!0===(3===arguments.length?o:r)||Q===K;if(p.history.pushState){var f=m?"replaceState":"pushState";oe=ge,ae=function(){try{p.history[f](null,O.title,me[g.route.mode]+K)}catch(e){y[g.route.mode]=K}},fe(me[g.route.mode]+K)}else y[g.route.mode]=K,fe(me[g.route.mode]+K);Q=null}}).param=function(e){if(!de)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return e?de[e]:de},g.route.mode="search",g.route.buildQueryString=ve,g.route.parseQueryString=be;var ke=1,xe=2,De=3,Se=4;function Ae(t,n){var r=this,o=0,a=0,i=[];function s(e){o=e||Se,i.map(function(e){o===De?e.resolve(a):e.reject(a)})}function u(e,t,n,r){if((null!=a&&m(a)||R(a))&&R(e))try{var o=0;e.call(a,function(e){o++||(a=e,t())},function(e){o++||(a=e,n())})}catch(e){g.deferred.onerror(e),a=e,n()}else r()}function l(){var e;try{e=a&&a.then}catch(e){return g.deferred.onerror(e),a=e,o=xe,l()}o===xe&&g.deferred.onerror(a),u(e,function(){o=ke,l()},function(){o=xe,l()},function(){try{o===ke&&R(t)?a=t(a):o===xe&&R(n)&&(a=n(a),o=ke)}catch(e){return g.deferred.onerror(e),a=e,s()}a===r?(a=TypeError(),s()):u(e,function(){s(De)},s,function(){s(o===ke&&De)})})}r.promise={},r.resolve=function(e){return o||(a=e,o=ke,l()),r},r.reject=function(e){return o||(a=e,o=xe,l()),r},r.promise.then=function(e,t){var n=new Ae(e,t);return o===De?n.resolve(a):o===Se?n.reject(a):i.push(n),n.promise}}function Te(e){return e}return(g.deferred=function(){var e=new Ae;return e.promise=_e(e.promise),e}).onerror=function(e){if("[object Error]"===d.call(e)&&!/ Error/.test(e.constructor.toString()))throw f=0,e},g.sync=function(e){var r=g.deferred(),o=e.length,a=[],i="resolve";function n(t,n){return function(e){return a[t]=e,n||(i="reject"),0==--o&&(r.promise(a),r[i](a)),e}}return 0<e.length?w(e,function(e,t){e.then(n(t,!0),n(t,!1))}):r.resolve([]),r.promise},g.request=function(r){!0!==r.background&&g.startComputation();var e,t,o,n,a,i,s,u,l,c=new Ae,d=r.dataType&&"jsonp"===r.dataType.toLowerCase();return o=d?(e=r.serialize=t=r.deserialize=Te,function(e){return e.responseText}):(e=r.serialize=r.serialize||JSON.stringify,t=r.deserialize=r.deserialize||JSON.parse,r.extract||function(e){return e.responseText.length||t!==JSON.parse?e.responseText:null}),r.method=(r.method||"GET").toUpperCase(),r.url=(u=r.url,(l=r.data)&&(u=u.replace(/:[a-z]\w+/gi,function(e){var t=e.slice(1),n=l[t]||e;return delete l[t],n})),u),function(e,t,n){if("GET"===e.method&&"jsonp"!==e.dataType){var r=e.url.indexOf("?")<0?"?":"&",o=ve(t);e.url+=o?r+o:""}else e.data=n(t)}(r,r.data,e),r.onload=r.onerror=function(e){try{e=e||event;var n=t(o(e.target,r));"load"===e.type?(r.unwrapSuccess&&(n=r.unwrapSuccess(n,e.target)),b(n)&&r.type?w(n,function(e,t){n[t]=new r.type(e)}):r.type&&(n=new r.type(n)),c.resolve(n)):(r.unwrapError&&(n=r.unwrapError(n,e.target)),c.reject(n))}catch(e){c.reject(e),g.deferred.onerror(e)}finally{!0!==r.background&&g.endComputation()}},(n=r).dataType&&"jsonp"===n.dataType.toLowerCase()?(i=(a=n).callbackName||"mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),s=O.createElement("script"),p[i]=function(e){s.parentNode.removeChild(s),a.onload({type:"load",target:{responseText:e}}),p[i]=E},s.onerror=function(){return s.parentNode.removeChild(s),a.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),p[i]=E,!1},s.onload=function(){return!1},s.src=a.url+(0<a.url.indexOf("?")?"&":"?")+(a.callbackKey?a.callbackKey:"callback")+"="+i+"&"+ve(a.data||{}),O.body.appendChild(s)):function(e){var t=new p.XMLHttpRequest;if(t.open(e.method,e.url,!0,e.user,e.password),t.onreadystatechange=function(){4===t.readyState&&(200<=t.status&&t.status<300?e.onload({type:"load",target:t}):e.onerror({type:"error",target:t}))},e.serialize===JSON.stringify&&e.data&&"GET"!==e.method&&t.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.deserialize===JSON.parse&&t.setRequestHeader("Accept","application/json, text/*"),m(e.headers))for(var n in e.headers)h.call(e.headers,n)&&t.setRequestHeader(n,e.headers[n]);if(R(e.config)){var r=e.config(t,e);null!=r&&(t=r)}var o="GET"!==e.method&&e.data?e.data:"";if(!o||M(o)||o.constructor===p.FormData)return t.send(o);throw new Error("Request data should be either be a string or FormData. Check the `serialize` option in `m.request`")}(n),c.promise=_e(c.promise,r.initialValue),c.promise},g}(t),"undefined"==typeof window&&n.deps({document:"undefined"!=typeof document?document:{},location:"undefined"!=typeof location?location:{},clearTimeout:clearTimeout,setTimeout:setTimeout}),null!=e&&e.exports?e.exports=n:t.m=n});window.m=N,window.Pikaday=j;var F=function(e){if(200<=e.status&&e.status<300)return e;var t=new Error(e.statusText);throw t.response=e,t},q=function(e){if(200<=e.status&&e.status<300)return e;throw e},H=function(e){return e.json().catch()},W=function(e){return(e.response?e.response.json():Promise.reject()).catch(function(){return Promise.reject(e)}).then(function(e){return Promise.reject(e)})};function B(e,t){void 0===t&&(t={});var n=Object.assign({credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}},t);return n.body=JSON.stringify(t.body),fetch(e,n).then(F).catch(W)}function V(e,t){return B(e,t).then(H)}var G="../studies",z="../launch",$="../tags",Z="../translate",J="../StudyData",K="../PITracking",Q="../DashboardData",X="../collaboration",ee="../DownloadsAccess",te=window.Pikaday,ne=function(e){return m.component(re,e)},re={view:function(e,t){return m(".row.form-group.date-range",{config:re.config(t)},[m(".col-sm-6",[m("label","Start Date"),m("label.input-group",[m(".input-group-addon",m("i.fa.fa-fw.fa-calendar")),m("input.form-control")])]),m(".col-sm-6",[m("label","End Date"),m("label.input-group",[m(".input-group-addon",m("i.fa.fa-fw.fa-calendar")),m("input.form-control")])])])},config:function(e){var l=e.startDate,c=e.endDate;return function(n,e,r){var o=r.startPicker,a=r.endPicker;function i(t){return function(e){13===e.keyCode&&t.isVisible()&&e.stopPropagation(),27===e.keyCode&&t.isVisible()&&(e.stopPropagation(),t.hide())}}function s(t){return function(e){t(e),u(),m.redraw()}}function u(){o.setDate(l(),!0),a.setDate(c(),!0),o.setStartRange(l()),o.setEndRange(c()),a.setStartRange(l()),a.setEndRange(c()),o.setMaxDate(c()),a.setMinDate(l())}function t(e,t){return e().getTime()===t.getDate().getTime()}e||function(){var e=n.children[0].children[1].children[1];o=r.startPicker=new te({onSelect:s(l),field:e}),e.addEventListener("keyup",i(o));var t=n.children[1].children[1].children[1];a=r.endPicker=new te({onSelect:s(c),field:t}),t.addEventListener("keyup",i(a)),o.setDate(l()),a.setDate(c()),r.onunload=function(){o.destroy(),a.destroy()}}(),t(l,o)&&t(c,a)||u()}}},oe=function(s){return function(e,t){var n,r,o=!e.validity||e.validity(),a=t.form,i=t.colWidth||2;if(!a)throw new Error("Inputs require a form");return a.showValidation()&&(n=o?"has-success":"has-danger",r=o?"form-control-success":"form-control-error"),m(".form-group.row",{class:n},[t.isStack?[m(".col-sm-12",[null!=t.label?m("label",{class:"strong"},t.label):"",s(e,t,{groupClass:n,inputClass:r}),t.help&&m("small.text-muted.m-y-0",t.help)])]:[m(".col-sm-"+i,[m("label.form-control-label",t.label)]),m(".col-sm-"+(12-i),[s(e,t,{groupClass:n,inputClass:r})]),t.help&&m("small.text-muted.col-sm-offset-2.col-sm-10.m-y-0",t.help)]])}},ae={controller:function(e){var t=e.prop,n=e.form,r=e.required;void 0===r&&(r=!1);var o=function(){return!r||t().length};return n.register(o),{validity:o}},view:oe(function(e,t,n){var r=t.prop,o=t.isArea;void 0===o&&(o=!1);var a=t.isFirst;void 0===a&&(a=!1);var i=t.placeholder;void 0===i&&(i="");var s=t.rows;void 0===s&&(s=3);var u=n.inputClass;return o?m("textarea.form-control",{class:u,placeholder:i,oninput:m.withAttr("value",r),rows:s,config:function(e,t){return a&&t&&e.focus()}},[r()]):m("input.form-control",{class:u,placeholder:i,value:r(),oninput:m.withAttr("value",r),config:function(e,t){return a&&t&&e.focus()}})})},ie={controller:function(e){var t=e.prop,n=e.form,r=e.required,o=e.dflt;if(!n)throw new Error("Inputs require a form");var a=m.prop("boolean"==typeof t()?o||"":t()),i=m.prop(!!t()),s=function(){return!r||t()};return n.register(s),{validity:s,showValidation:n.showValidation,text:function(e){return arguments.length&&(a(e),t(e||!0)),a()},checked:function(e){return arguments.length&&(i(e),i()&&a()?t(a()):t(i())),i()}}},view:oe(function(e,t){var n=e.text,r=e.checked,o=t.placeholder||"";return m(".input-group",[m("span.input-group-addon",[m("input",{type:"checkbox",onclick:m.withAttr("checked",r),checked:r()})]),m("input.form-control",{placeholder:o,value:n(),oninput:m.withAttr("value",n),disabled:!r()})])})},se={controller:function(e){var t=e.prop,n=e.form,r=e.required,o=function(){return!r||t()};return n.register(o),{validity:o,showValidation:n.showValidation}},view:oe(function(e,t,n){var r=t.prop,o=t.description;void 0===o&&(o="");var a=n.groupClass,i=n.inputClass;return m(".checkbox.checkbox-input-group",{class:a},[m("label.c-input.c-checkbox",{class:i},[m("input.form-control",{type:"checkbox",onclick:m.withAttr("checked",r),checked:r()}),m("span.c-indicator"),m.trust("&nbsp;"),o])])})},ue={controller:function(e){var t=e.prop,n=e.form,r=e.required;if(!n)throw new Error("Inputs require a form");var o=function(){return!r||t()};return n.register(o),{validity:o,showValidation:n.showValidation}},view:oe(function(e,t,n){var r=t.prop,o=t.isFirst;void 0===o&&(o=!1);var a=t.values;void 0===a&&(a={});var i=n.inputClass,s=r();return m(".input-group",[m("select.c-select.form-control",{class:i,onchange:function(e){return r(a[e.target.value])},config:function(e,t){return o&&t&&e.focus()}},Object.keys(a).map(function(e){return m("option",{selected:s===a[e]},e)}))])})},le={controller:function(e){var t=e.prop,n=e.form,r=e.required;if(!n)throw new Error("Inputs require a form");var o=function(){return!r||t()};return n.register(o),{validity:o,showValidation:n.showValidation}},view:oe(function(e,t){var n=t.prop,r=t.values;void 0===r&&(r={});var o=Object.keys(r);return 1===o.length&&n(r[o[0]]),m(".c-inputs-stacked",o.map(function(e){return m("label.c-input.c-radio",[m("input",{type:"radio",checked:r[e]===n(),onchange:n.bind(null,r[e])}),m("span.c-indicator"),e])}))})};function ce(){var t=[];return{register:function(e){t.push(e)},isValid:function(){return t.every(function(e){return e.call()})},showValidation:m.prop(!1)}}var de=function(e){return m.component(ae,e)},me=function(e){return m.component(ie,e)},fe=function(e){return m.component(se,e)},pe=function(e){return m.component(ue,e)},he=function(e){return m.component(le,e)},ye=function(t){var e,n,r,o,a,i=function(e){return e},s=Object.assign(t);return s.prop=(e={prop:t.prop,output:function(e){return e.map(t.fromArr||i).join("\n")},input:function(e){return""===e?[]:e.replace(/\n*$/,"").split("\n").map(t.toArr||i)}},n=e.prop,r=e.input,o=e.output,(a=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return e.length&&n(r(e[0])),o(n())}).toJSON=function(){return o(n())},a),m.component(ae,s)},ge={"Research pool - Current studies":"Pool:Current","All research - Pool and lab":"Research:Any","Demo studies":"Demo:Any","All studies":"Both:Any"},ve={controller:function(){return{form:ce()}},view:function(e,t){var n=e.form,r=t.query;return m(".col-sm-12",[pe({label:"Source",prop:r.source,values:ge,form:n,colWidth:3}),de({label:"Study",prop:r.study,form:n,colWidth:3}),m("div",{style:"padding: .375rem"},[ne({startDate:r.startDate,endDate:r.endDate}),m("small.text-muted","The data for the study statistics by day is saved in 24 hour increments by date in USA eastern time (EST).")]),m(".form-group.row",[m(".col-sm-3",[m("label.form-control-label","Show by")]),m(".col-sm-9.pull-right",[m(".btn-group.btn-group-sm",[be(r.sortstudy,"Study"),be(r.sorttask,"Task"),m("a.btn.btn-secondary.statistics-time-button",{class:"All"!==r.sorttime()?"active":""},["Time",m(".time-card",[m(".card",[m(".card-header","Time filter"),m(".card-block.c-inputs-stacked",[we(r.sorttime,"None"),we(r.sorttime,"Days"),we(r.sorttime,"Weeks"),we(r.sorttime,"Months"),we(r.sorttime,"Years")])])])])]),m(".btn-group.btn-group-sm.pull-right",[be(r.showEmpty,"Hide Empty","Hide Rows with Zero Started Sessions"),be(r.sortgroup,"Show Data Group")])])]),m(".form-group.row",[m(".col-sm-3",[m("label.form-control-label","Compute completions")]),m(".col-sm-9",[m(".row",[m(".col-sm-5",[m("input.form-control",{placeholder:"First task",value:r.firstTask(),onchange:m.withAttr("value",r.firstTask)})]),m(".col-sm-1",[m(".form-control-static","to")]),m(".col-sm-5",[m("input.form-control",{placeholder:"Last task",value:r.lastTask(),onchange:m.withAttr("value",r.lastTask)})])])])])])}},be=function(e,t,n){return void 0===n&&(n=""),m("a.btn.btn-secondary",{class:e()?"active":"",onclick:function(){return e(!e())},title:n},t)},we=function(e,t){return m("label.c-input.c-radio",[m("input.form-control[type=radio]",{onclick:e.bind(null,t),checked:e()==t}),m("span.c-indicator"),t])};function _e(o,a){return function(e){var n=e.target.getAttribute("data-sort-by"),t=o();if(n){"function"==typeof a&&a(n);var r=t[0];t.sort(function(e,t){return e[n]>t[n]?1:e[n]<t[n]?-1:0}),r===t[0]&&t.reverse()}}}function ke(e){var t=function(e){return e<10?"0"+e:e};return t(e.getMonth()+1)+"\\"+t(e.getDate())+"\\"+e.getFullYear()}var xe={controller:function(){return{sortBy:m.prop()}},view:function(e,t){var n=e.sortBy,r=t.tableContent,o=t.query;if(o.error())return m(".alert.alert-warning",m("strong","Error: "),o.error());var a=r();if(!a)return m("div");if(!a.data)return m(".col-sm-12",[m(".alert.alert-info","There was no data found for this request")]);var i=m.prop(a.data);return m(".col-sm-12",[m("table.table.table-sm",{onclick:_e(i,n)},[m("thead",[m("tr.table-default",[De(n,"studyName","Study Name"),o.sorttask_sent()?De(n,"taskName","Task Name"):"","All"===o.sorttime_sent()?"":De(n,"date","Date"),De(n,"starts","Starts"),De(n,"completes","Completes"),De(n,"completion_rate","Completion Rate %"),o.sortgroup()?De(n,"schema","Schema"):""])]),m("tbody",[i().map(function(e){return o.showEmpty()&&0===e.starts?"":m("tr.table-default",[m("td",e.studyName),o.sorttask_sent()?m("td",e.taskName):"","All"===o.sorttime_sent()?"":m("td",ke(new Date(e.date))),m("td",e.starts),m("td",e.completes),m("td",e.completion_rate=0===e.starts?0:(e.completes/e.starts).toFixed(2)),o.sortgroup()?m("td",e.schema):""])})])])])}},De=function(e,t,n){return m("th",{"data-sort-by":t,class:e()===t?"active":""},n)},Se={controller:function(){var e,t=m.prop(!1),n=m.prop(""),r=m.prop(!1),o={source:m.prop("Pool:Current"),startDate:m.prop((e=new Date,new Date(e.getFullYear(),e.getMonth()-1,1))),endDate:m.prop(new Date),study:m.prop(""),task:m.prop(""),studyType:m.prop("Both"),studydb:m.prop("Any"),sortstudy:m.prop(!0),sorttask:m.prop(!1),sorttask_sent:m.prop(!1),sortgroup:m.prop(!1),sorttime:m.prop("None"),sorttime_sent:m.prop("None"),showEmpty:m.prop(!1),firstTask:m.prop(""),lastTask:m.prop(""),error:m.prop(""),rows:m.prop([])};return{query:o,submit:function(){r(!0),(e=o,V(K,{method:"post",body:function(e){var t=e.source,n=e.study,r=e.sortstudy,o=e.sorttask,a=e.sorttime,i=e.startDate,s=e.endDate,u=e.firstTask,l=e.lastTask;return{schema:t().match(/^(.*?):/)[1],studyId:n(),startDate:c(i()),endDate:c(s()),startTask:u(),sorttask:o(),sortstudy:r(),endTask:l(),timeframe:"None"===a()?"All":a(),extended:o()};function c(e){if(e)return e.getMonth()+1+"/"+e.getDate()+"/"+(e.getYear()+1900)}}(e)}).then(function(e){return e})).then(n).catch(function(e){o.error(e.message)}).then(r.bind(null,!1)).then(o.sorttask_sent(o.sorttask())).then(o.sorttime_sent(o.sorttime())).then(m.redraw);var e},displayHelp:t,tableContent:n,loading:r}},view:function(e){var t,n,r=e.query,o=e.tableContent,a=e.submit,i=e.displayHelp,s=e.loading;return m(".container.statistics",[m("h3","Statistics"),m(".row",[(n={query:r},m.component(ve,n))]),m(".row",[m(".col-sm-12",[m("button.btn.btn-secondary.btn-sm",{onclick:function(){return i(!i())}},["Toggle help ",m("i.fa.fa-question-circle")]),m("a.btn.btn-primary.pull-right",{onclick:a},"Submit"),o()?m("a.btn.btn-secondary.pull-right.m-r-1",{config:Ae(r.study()?r.study()+".csv":"stats.csv",o(),r)},"Download CSV"):""])]),i()?m(".row",[m(".col-sm-12.p-a-2",m(".text-muted",[m("p","Choose whether you want participation data from demo studies, research pool, all research studies (including lab studies), or all studies (demo and research)."),m("p","Enter the study id or any part of the study id (the study name that that appears in an .expt file). Note that the study id search feature is case-sensitive. If you leave this box blank you will get data from all studies."),m("p","You can also use the Task box to enter a task name or part of a task name (e.g., realstart) if you only want participation data from certain tasks."),m("p",'You can also choose how you want the data displayed, using the "Show by" options. If you click "Study", you will see data from each study that meets your search criteria. If you also check "Task" you will see data from any study that meets your search criteria separated by task.  The "Data Group" option will allow you to see whether a given study is coming from the demo or research site.  '),m("p",'You can define how completion rate is calculated by entering text to "First task" and "Last task". Only sessions that visited those tasks would be used for the calculation.'),m("p",'When you choose to show the results by date, you will see all the studies that have at least one session in the requested date range, separated by day, week, month or year. This will also show dates with zero sessions. If you want to hide rows with zero sessions, select the "Hide empty" option.')]))]):"",m(".row.m-t-1",[s()?m(".loader"):(t={tableContent:o,query:r},m.component(xe,t))])])}},Ae=function(a,i,s){return function(e){var t=i.data;t=s.showEmpty()?t.filter(function(e){return 0!==e.starts}):t;var n=["studyName",s.sorttask_sent()?"taskName":"","All"===s.sorttime_sent()?"":"date","starts","completes",s.sortgroup()?"schema":""].filter(function(e){return e}),r=function(e,t){return null===t?"":t},o=t.map(function(t){return n.map(function(e){return JSON.stringify(t[e],r)}).join(",")});o.unshift(n.join(",")),e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(o.join("\r\n"))),e.setAttribute("download",a)}},Te=function(n){return(e=K,t={method:"post",body:function(e){var t=e.source,n=e.study,r=e.task,o=e.sortstudy,a=e.sorttask,i=e.sortgroup,s=e.sorttime,u=e.showEmpty,l=e.startDate,c=e.endDate,d=e.firstTask,m=e.lastTask,f=location.origin+"/implicit";return{db:t().match(/^(.*?):/)[1],current:t().match(/:(.*?)$/)[1],testDB:"newwarehouse",study:n(),task:r(),since:p(l()),until:p(c()),refresh:"no",startTask:d(),endTask:m(),filter:"",studyc:o(),taskc:a(),datac:i(),timec:"None"!==s(),dayc:"Days"===s(),weekc:"Weeks"===s(),monthc:"Months"===s(),yearc:"Years"===s(),method:"3",cpath:"",hpath:"",tasksM:"3",threads:"yes",threadsNum:"1",zero:u(),curl:f+"/research/library/randomStudiesConfig/RandomStudiesConfig.xml",hurl:f+"/research/library/randomStudiesConfig/HistoryRand.xml",baseURL:f};function p(e){if(e)return e.getMonth()+1+"/"+e.getDate()+"/"+(e.getYear()+1900)}}(n)},B(e,t).then(function(e){return e.text()})).then(function(e){var t=e?function(e,t){t=t||",";var n=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),r=[[]],o=null;for(;o=n.exec(e);){var a,i=o[1];i.length&&i!==t&&r.push([]),a=o[2]?o[2].replace(new RegExp('""',"g"),'"'):o[3],r[r.length-1].push(a)}return r}(e):[[]];return{study:n.study(),file:e,headers:t.shift(),data:t,query:Object.assign(n)}});var e,t};var Ce={"Research pool - Current studies":"Research:Current","All research - Pool and lab":"Research:Any","Demo studies":"Demo:Any","All studies":"Both:Any"},Ee={controller:function(){return{form:ce()}},view:function(e,t){var n=e.form,r=t.query;return m(".col-sm-12",[pe({label:"Source",prop:r.source,values:Ce,form:n,colWidth:3}),de({label:"Study",prop:r.study,form:n,colWidth:3}),de({label:"Task",prop:r.task,form:n,colWidth:3}),m("div",{style:"padding: .375rem .75rem"},ne({startDate:r.startDate,endDate:r.endDate})),m(".form-group.row",[m(".col-sm-3",[m("label.form-control-label","Show by")]),m(".col-sm-9.pull-right",[m(".btn-group.btn-group-sm",[Re(r.sortstudy,"Study"),Re(r.sorttask,"Task"),m("a.btn.btn-secondary.statistics-time-button",{class:"None"!==r.sorttime()?"active":""},["Time",m(".time-card",[m(".card",[m(".card-header","Time filter"),m(".card-block.c-inputs-stacked",[Me(r.sorttime,"None"),Me(r.sorttime,"Days"),Me(r.sorttime,"Weeks"),Me(r.sorttime,"Months"),Me(r.sorttime,"Years")])])])]),Re(r.sortgroup,"Data Group")]),m(".btn-group.btn-group-sm.pull-right",[Re(r.showEmpty,"Hide empty","Hide Rows with Zero Started Sessions")])])]),m(".form-group.row",[m(".col-sm-3",[m("label.form-control-label","Compute completions")]),m(".col-sm-9",[m(".row",[m(".col-sm-5",[m("input.form-control",{placeholder:"First task",value:r.firstTask(),onchange:m.withAttr("value",r.firstTask)})]),m(".col-sm-1",[m(".form-control-static","to")]),m(".col-sm-5",[m("input.form-control",{placeholder:"Last task",value:r.lastTask(),onchange:m.withAttr("value",r.lastTask)})])])])])])}},Re=function(e,t,n){return void 0===n&&(n=""),m("a.btn.btn-secondary",{class:e()?"active":"",onclick:function(){return e(!e())},title:n},t)},Me=function(e,t){return m("label.c-input.c-radio",[m("input.form-control[type=radio]",{onclick:e.bind(null,t),checked:e()==t}),m("span.c-indicator"),t])},Oe={controller:function(){return{sortBy:m.prop()}},view:function(e,t){var n=e.sortBy,r=t.tableContent,o=r();if(!o)return m("div");if(!o.file)return m(".col-sm-12",[m(".alert.alert-info","There was no data found for this request")]);var a=m.prop(o.data);return m(".col-sm-12",[m("table.table.table-sm",{onclick:_e(a,n)},[m("thead",[m("tr.table-default",r().headers.map(function(e,t){return m("th",{"data-sort-by":t,class:n()===t?"active":""},e)}))]),m("tbody",r().data.map(function(e){return m("tr",e.length?e.map(function(e){return m("td",e)}):"")}))])])}},Ie={controller:function(){var e,t=m.prop(!1),n=m.prop(),r=m.prop(!1),o={source:m.prop("Research:Current"),startDate:m.prop((e=new Date,new Date(e.getFullYear(),e.getMonth()-1,1))),endDate:m.prop(new Date),study:m.prop(""),task:m.prop(""),studyType:m.prop("Both"),studydb:m.prop("Any"),sortstudy:m.prop(!0),sorttask:m.prop(!1),sortgroup:m.prop(!1),sorttime:m.prop("None"),showEmpty:m.prop(!1),firstTask:m.prop(""),lastTask:m.prop("")};return{query:o,submit:function(){r(!0),Te(o).then(n).then(r.bind(null,!1)).then(m.redraw)},displayHelp:t,tableContent:n,loading:r}},view:function(e){var t,n,r=e.query,o=e.tableContent,a=e.submit,i=e.displayHelp,s=e.loading;return m(".container.statistics",[m("h3","Statistics"),m(".row",[(n={query:r},m.component(Ee,n))]),m(".row",[m(".col-sm-12",[m("button.btn.btn-secondary.btn-sm",{onclick:function(){return i(!i())}},["Toggle help ",m("i.fa.fa-question-circle")]),m("a.btn.btn-primary.pull-right",{onclick:a},"Submit"),o()&&o().file?m("a.btn.btn-secondary.pull-right.m-r-1",{config:Pe(o().study+".csv",o().file)},"Download CSV"):""])]),i()?m(".row",[m(".col-sm-12.p-a-2",m(".text-muted",[m("p","Choose whether you want participation data from demo studies, research pool, all research studies (including lab studies), or all studies (demo and research)."),m("p","Enter the study id or any part of the study id (the study name that that appears in an .expt file). Note that the study id search feature is case-sensitive. If you leave this box blank you will get data from all studies."),m("p","You can also use the Task box to enter a task name or part of a task name (e.g., realstart) if you only want participation data from certain tasks."),m("p",'You can also choose how you want the data displayed, using the "Show by" options. If you click "Study", you will see data from each study that meets your search criteria. If you also check "Task" you will see data from any study that meets your search criteria separated by task.  The "Data Group" option will allow you to see whether a given study is coming from the demo or research site.  '),m("p",'You can define how completion rate is calculated by entering text to "First task" and "Last task". Only sessions that visited those tasks would be used for the calculation.'),m("p",'When you choose to show the results by date, you will see all the studies that have at least one session in the requested date range, separated by day, week, month or year. This will also show dates with zero sessions. If you want to hide rows with zero sessions, select the "Hide empty" option.')]))]):"",m(".row.m-t-1",[s()?m(".loader"):(t={tableContent:o},m.component(Oe,t))])])}},Pe=function(t,n){return function(e){e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n)),e.setAttribute("download",t)}},Ue="R";function Ye(e,t){var n=Object.assign({action:"updateStudyStatus"},e,{studyStatus:t});return V(J,{method:"post",body:n}).then(Le)}function Le(e){if(!e.error)return e;return Promise.reject({message:{1:"This ID already exists.",2:"The study could not be found.",3:"The rule file could not be found.",4:'The rules file does not fit the "research" schema.'}[e.error]})}var je=function(){},Ne={vm:{isOpen:!1},open:function(n,r){void 0===r&&(r={});var e=new Promise(function(e,t){Ne.vm={resolve:e,reject:t,type:n,opts:r,isOpen:!0}});return m.redraw(),e},close:function(e){var t=Ne.vm;t.isOpen=!1,"function"==typeof t.resolve&&t.resolve(e),m.redraw()},custom:function(e){return Ne.open("custom",e)},alert:function(e){return Ne.open("alert",e)},confirm:function(e){return Ne.open("confirm",e)},prompt:function(e){return Ne.open("prompt",e)},view:function(){var e=Ne.vm,t=Ne.close.bind(null,null);return m("#messages.backdrop",[e&&e.isOpen?[m(".overlay",{config:Ne.config(e.opts)}),m(".backdrop-content",{onclick:t},[m(".card",{class:e.opts.wide?"col-sm-8":"col-sm-5",config:Fe},[m(".card-block",{onclick:function(e){return e.stopPropagation()}},[Ne.views[e.type](e.opts)])])])]:""])},config:function(o){return function(e,t,n){if(!t){var r=function(e){27==e.keyCode&&Ne.close(null),13!=e.keyCode||o.preventEnterSubmits||Ne.close(!0)};document.body.addEventListener("keyup",r),n.onunload=function(){document.body.removeEventListener("keyup",r)}}}},views:{custom:function(e){return void 0===e&&(e={}),e.content},alert:function(e){void 0===e&&(e={});var t;return[m("h4",e.header),m("p.card-text",e.content),m(".text-xs-right.btn-toolbar",[m("button.btn.btn-primary.btn-sm",{onclick:(t=!0,Ne.close.bind(null,t))},e.okText||"OK")])]},confirm:function(e){void 0===e&&(e={});var t=function(e){return Ne.close.bind(null,e)};return[m("h4",e.header),m("p.card-text",e.content),m(".text-xs-right.btn-toolbar",[m("button.btn.btn-secondary.btn-sm",{onclick:t(null)},e.cancelText||"Cancel"),m("button.btn.btn-primary.btn-sm",{onclick:t(!0)},e.okText||"OK")])]},prompt:function(e){void 0===e&&(e={prop:je});var t=e.prop,n=e.header,r=e.content,o=e.postContent,a=e.okText,i=e.cancelText,s=function(e){return Ne.close.bind(null,e)};return[m("h4",n),m(".card-text",r),m(".card-block",[m("input.form-control",{key:"prompt",value:t(),onchange:m.withAttr("value",t),config:function(e,t){t||setTimeout(function(){return e.focus()})}})]),m(".card-text",o),m(".text-xs-right.btn-toolbar",[m("button.btn.btn-secondary.btn-sm",{onclick:s(null)},i||"Cancel"),m("button.btn.btn-primary.btn-sm",{onclick:s(!0)},a||"OK")])]}}},Fe=function(e,t,n){function r(){e.style.maxHeight=.9*document.documentElement.clientHeight+"px"}t||(r(),window.addEventListener("resize",r,!0),n.onunload=function(){window.removeEventListener("resize",r)})},qe={display:m.prop(!1),show:function(e){return qe.display(!0),m.redraw(),e},hide:function(e){return qe.display(!1),m.redraw(),e},view:function(){return m(".backdrop",{hidden:!qe.display()},m(".overlay"),m(".backdrop-content.spinner.icon.fa.fa-cog.fa-spin"))}},He={}.hasOwnProperty;function We(){for(var e=arguments,t="",n=0;n<arguments.length;n++){var r=e[n];if(r){var o=typeof r;if("string"===o||"number"===o)t+=" "+r;else if(Array.isArray(r))t+=" "+We.apply(null,r);else if("object"===o)for(var a in r)He.call(r,a)&&r[a]&&(t+=" "+a)}}return t.substr(1)}var Be=function(e){return Ne.custom({content:m.component(Ve,Object.assign({close:Ne.close},e)),wide:!0})},Ve={controller:function(e){var n=e.input,t=e.output,r=e.close,o=["rulesUrl","targetCompletions","autopauseUrl","userEmail"].reduce(function(e,t){return e[t]=m.prop(n[t]||""),e},{});t(o);var a={study:o,submitAttempt:!1,validity:function(){var e,t;return{rulesUrl:o.rulesUrl(),targetCompletions:(t=o.targetCompletions(),/^\+?(0|[1-9]\d*)$/.test(t)),autopauseUrl:o.autopauseUrl(),userEmail:(e=o.userEmail(),/\S+@\S+\.\S+/.test(e))}},ok:function(){a.submitAttempt=!0;var t=a.validity();Object.keys(t).every(function(e){return t[e]})&&(o.targetCompletions(+o.targetCompletions()),r(!0))},cancel:function(){r(null)}};return a},view:function(n,e){var t=e.input,r=n.study,o=n.validity(),a=function(e,t,n){return m("button.btn.btn-secondary.btn-sm",{onclick:e.bind(null,n)},t)},i=function(e,t){return e||!n.submitAttempt?"":m("small.text-muted",t)},s=function(e){return n.submitAttempt?We({"has-danger":!e,"has-success":e}):""},u=function(e){return n.submitAttempt?We({"form-control-danger":!e,"form-control-success":e}):""};return m("div",[m("h4","Study Editor"),m(".card-block",[m(".form-group",[m("label","Study ID"),m("p",[m("strong.form-control-static",t.studyId)])]),m(".form-group",[m("label","Study URL"),m("p",[m("strong.form-control-static",t.studyUrl)])]),m(".form-group",{class:s(o.rulesUrl)},[m("label","Rules File URL"),m("input.form-control",{config:Ge,placeholder:"Rules file URL",value:r.rulesUrl(),oninput:m.withAttr("value",r.rulesUrl),class:u(o.rulesUrl)}),m("p.text-muted.btn-toolbar",[a(r.rulesUrl,"Priority26","/research/library/rules/Priority26.xml")]),i(o.rulesUrl,"This row is required")]),m(".form-group",{class:s(o.autopauseUrl)},[m("label","Auto-pause file URL"),m("input.form-control",{placeholder:"Auto pause file URL",value:r.autopauseUrl(),oninput:m.withAttr("value",r.autopauseUrl),class:u(o.autopauseUrl)}),m("p.text-muted.btn-toolbar",[a(r.autopauseUrl,"Default","/research/library/pausefiles/pausedefault.xml"),a(r.autopauseUrl,"Never","/research/library/pausefiles/neverpause.xml"),a(r.autopauseUrl,"Low restrictions","/research/library/pausefiles/pauselowrestrictions.xml")]),i(o.autopauseUrl,"This row is required")]),m(".form-group",{class:s(o.targetCompletions)},[m("label","Target number of sessions"),m("input.form-control",{type:"number",placeholder:"Target Sessions",value:r.targetCompletions(),oninput:m.withAttr("value",r.targetCompletions),onclick:m.withAttr("value",r.targetCompletions),class:u(o.targetCompletions)}),i(o.targetCompletions,"This row is required and has to be an integer above 0")]),m(".form-group",{class:s(o.userEmail)},[m("label","User Email"),m("input.form-control",{type:"email",placeholder:"Email",value:r.userEmail(),oninput:m.withAttr("value",r.userEmail),class:u(o.userEmail)}),i(o.userEmail,"This row is required and must be a valid Email")])]),m(".text-xs-right.btn-toolbar",[m("a.btn.btn-secondary.btn-sm",{onclick:n.cancel},"Cancel"),m("a.btn.btn-primary.btn-sm",{onclick:n.ok},"OK")])])}},Ge=function(e,t){t||e.focus()},ze={controller:function(e){var t=e.output,n=e.close,r=t({studyUrl:m.prop("")}),o={study:r,submitAttempt:!1,validity:function(){return{studyUrl:r.studyUrl()}},ok:function(){o.submitAttempt=!0;var t=o.validity();Object.keys(t).every(function(e){return t[e]})&&n(!0)},cancel:function(){n(null)}};return o},view:function(e){var t,n,r,o,a=e.study,i=e.validity();return m("div",[m("h4","Create Study"),m(".card-block",[m(".form-group",{class:(o=i.studyUrl,e.submitAttempt?We({"has-danger":!o,"has-success":o}):"")},[m("label","Study URL"),m("input.form-control",{config:$e,placeholder:"Study URL",value:a.studyUrl(),oninput:m.withAttr("value",a.studyUrl),class:(r=i.studyUrl,e.submitAttempt?We({"form-control-danger":!r,"form-control-success":r}):"")}),(t=i.studyUrl,n="This row is required",t||!e.submitAttempt?"":m("small.text-muted",n))])]),m(".text-xs-right.btn-toolbar",[m("a.btn.btn-secondary.btn-sm",{onclick:e.cancel},"Cancel"),m("a.btn.btn-primary.btn-sm",{onclick:e.ok},"Proceed")])])}},$e=function(e,t){t||e.focus()};function Ze(t){return Ne.confirm({header:"Continue Study:",content:'Are you sure you want to continue "'+t.studyId+'"?'}).then(function(e){if(e)return nt(t,!0)(),Ye(t,Ue).then(function(){return t.studyStatus=Ue}).catch(tt("Continue Study")).then(nt(t,!1))})}function Je(t){return Ne.confirm({header:"Pause Study:",content:'Are you sure you want to pause "'+t.studyId+'"?'}).then(function(e){if(e)return nt(t,!0)(),Ye(t,"P").then(function(){return t.studyStatus="P"}).catch(tt("Pause Study")).then(nt(t,!1))})}var Ke=function(t,n){return Ne.confirm({header:"Remove Study:",content:'Are you sure you want to remove "'+t.studyId+'" from the pool?'}).then(function(e){if(e)return nt(t,!0)(),Ye(t,"S").then(function(){return n(n().filter(function(e){return e!==t}))}).catch(tt("Remove Study")).then(nt(t,!1))})},Qe=function(o){var a=m.prop();return Be({input:o,output:a}).then(function(e){if(e){nt(o,!0)();var t=Object.assign({},o,rt(a()));return(n=t,r=Object.assign({action:"updateRulesTable"},n),V(J,{method:"post",body:r}).then(Le)).then(function(){return Object.assign(o,t)}).catch(tt("Study Editor")).then(nt(o,!1))}var n,r})},Xe=function(i){var e,r=m.prop();return(e={output:r},Ne.custom({content:m.component(ze,Object.assign({close:Ne.close},e)),wide:!0})).then(function(e){var t,n;e&&(qe.show(),(t=r(),n=Object.assign({action:"getStudyId"},t),V(J,{method:"post",body:n})).then(function(e){return Object.assign(rt(r()),e)}).then(qe.hide).then(o))});function o(o){var a=m.prop();return Be({input:o,output:a}).then(function(e){if(e){var t=Object.assign({startedSessions:0,completedSessions:0,creationDate:new Date,studyStatus:Ue},o,rt(a()));return(n=t,r=Object.assign({action:"insertRulesTable",creationDate:new Date,studyStatus:Ue},n),V(J,{method:"post",body:r}).then(Le)).then(function(){return i().push(t)}).then(m.redraw).catch(tt("Create Study"))}var n,r})}},et=function(r){Ne.confirm({header:"Restart study",content:"Are you sure you want to restart this study? This action will reset all started and completed sessions."}).then(function(e){if(e){var t={startedSessions:r.startedSessions,completedSessions:r.completedSessions};return r.startedSessions=r.completedSessions=0,m.redraw(),(n=r,V(J,{method:"post",body:Object.assign({action:"resetCompletions"},n)}).then(Le)).catch(function(e){return Object.assign(r,t),Promise.reject(e)}).catch(tt("Restart study"))}var n})},tt=function(t){return function(e){return Ne.alert({header:t,content:e.message})}},nt=function(e,t){return function(){e.$pending=t,m.redraw()}},rt=function(n){return Object.keys(n).reduce(function(e,t){return e[t]=n[t](),e},{})},ot=function(){return V("../is_loggedin",{method:"get"})},at="https://implicit.harvard.edu/implicit/",it={controller:function(){var t={play:Ze,pause:Je,remove:Ke,edit:Qe,reset:et,create:Xe,canCreate:!1,list:m.prop([]),globalSearch:m.prop(""),sortBy:m.prop(),error:m.prop(""),loaded:m.prop()};return ot().then(function(e){t.canCreate="SU"===e.role}),V(J,{method:"post",body:{action:"getAllPoolStudies"}}).then(Le).then(t.list).then(t.loaded).catch(t.error).then(m.redraw),t},view:function(t){var n=t.list;return m(".pool",[m("h2","Study pool"),t.error()?m(".alert.alert-warning",m("strong","Warning!! "),t.error().message):m("table",{class:"table table-striped table-hover",onclick:_e(n,t.sortBy)},[m("thead",[m("tr",[m("th",{colspan:7},[m("input.form-control",{placeholder:"Global Search ...",oninput:m.withAttr("value",t.globalSearch)})]),m("th",[m("a.btn.btn-secondary",{href:"/pool/history",config:m.route},[m("i.fa.fa-history"),"  History"])])]),t.canCreate?m("tr",[m("th.text-xs-center",{colspan:8},[m("button.btn.btn-secondary",{onclick:t.create.bind(null,n)},[m("i.fa.fa-plus"),"  Add new study"])])]):"",m("tr",[m("th",st("studyId",t.sortBy),"ID"),m("th",st("studyUrl",t.sortBy),"Study"),m("th",st("rulesUrl",t.sortBy),"Rules"),m("th",st("autopauseUrl",t.sortBy),"Autopause"),m("th",st("completedSessions",t.sortBy),"Completion"),m("th",st("creationDate",t.sortBy),"Date"),m("th","Status"),m("th","Actions")])]),m("tbody",[0===n().length?m("tr.table-info",m("td.text-xs-center",{colspan:8},m("strong","Heads up! "),t.loaded()?"None of your studies is in the Research Pool right now":"Loading...")):n().filter(function(t){return function(e){return n(e.studyId,t.globalSearch())||n(e.studyUrl,t.globalSearch())||n(e.rulesUrl,t.globalSearch())};function n(e,t){return"string"==typeof e&&e.includes(t)}}(t)).map(function(e){return m("tr",[m("td",e.studyId),m("td",[m("a",{href:at+e.studyUrl,target:"_blank"},"Study")]),m("td",[m("a",{href:at+e.rulesUrl,target:"_blank"},"Rules")]),m("td",[m("a",{href:at+e.autopauseUrl,target:"_blank"},"Autopause")]),m("td",[e.startedSessions?(100*e.completedSessions/e.startedSessions).toFixed(1)+"% ":"n/a ",m("i.fa.fa-info-circle"),m(".info-box",[m(".card",[m(".card-header","Completion Details"),m("ul.list-group.list-group-flush",[m("li.list-group-item",[m("strong","Target Completions: "),e.targetCompletions]),m("li.list-group-item",[m("strong","Started Sessions: "),e.startedSessions]),m("li.list-group-item",[m("strong","Completed Sessions: "),e.completedSessions])])])])]),m("td",ke(new Date(e.creationDate))),m("td",[{R:m("span.label.label-success","Running"),P:m("span.label.label-info","Paused"),S:m("span.label.label-danger","Stopped")}[e.studyStatus]]),m("td",[e.$pending?m(".l","Loading..."):m(".btn-group",[e.canUnpause&&"P"===e.studyStatus?m("button.btn.btn-sm.btn-secondary",{onclick:t.play.bind(null,e)},[m("i.fa.fa-play")]):"",e.canPause&&e.studyStatus===Ue?m("button.btn.btn-sm.btn-secondary",{onclick:t.pause.bind(null,e)},[m("i.fa.fa-pause")]):"",e.canReset?m("button.btn.btn-sm.btn-secondary",{onclick:t.edit.bind(null,e)},[m("i.fa.fa-edit")]):"",e.canReset?m("button.btn.btn-sm.btn-secondary",{onclick:t.reset.bind(null,e)},[m("i.fa.fa-refresh")]):"",e.canStop?m("button.btn.btn-sm.btn-secondary",{onclick:t.remove.bind(null,e,n)},[m("i.fa.fa-close")]):""])])])})])])])}},st=function(e,t){return{"data-sort-by":e,class:t()===e?"active":""}};var ut="https://implicit.harvard.edu/implicit/",lt={controller:function(){var e={list:m.prop([]),globalSearch:m.prop(""),startDate:m.prop(new Date(0)),endDate:m.prop(new Date),sortBy:m.prop()};return V(J,{method:"post",body:{action:"getLast100PoolUpdates"}}).then(Le).then(e.list).then(m.redraw),e},view:function(e){var t=e.list;return m(".pool",[m("h2","Pool history"),m(".row",{colspan:8},[m(".col-sm-3",[m("label","Search"),m("input.form-control",{placeholder:"Search ...",oninput:m.withAttr("value",e.globalSearch)})]),m(".col-sm-4",[ne(e)]),m(".col-sm-5",[m("label",m.trust("&nbsp")),m(".text-muted.btn-toolbar",[dt(e,"Last 7 Days",7),dt(e,"Last 30 Days",30),dt(e,"Last 90 Days",90),dt(e,"All time",3650)])])]),m("table",{class:"table table-striped table-hover",onclick:_e(t,e.sortBy)},[m("thead",[m("tr",[m("th",ct("studyId",e.sortBy),"ID"),m("th",ct("studyUrl",e.sortBy),"Study"),m("th",ct("rulesUrl",e.sortBy),"Rules"),m("th",ct("autopauseUrl",e.sortBy),"Autopause"),m("th",ct("creationDate",e.sortBy),"Creation Date"),m("th",ct("completedSessions",e.sortBy),"Completion"),m("th","New Status"),m("th","Old Status"),m("th",ct("updaterId",e.sortBy),"Updater")])]),m("tbody",[t().filter(function(t){return function(e){return(n(e.studyId,t.globalSearch())||n(e.updaterId,t.globalSearch())||n(e.rulesUrl,t.globalSearch())||n(e.targetCompletions,t.globalSearch()))&&new Date(e.creationDate).getTime()>=t.startDate().getTime()&&new Date(e.creationDate).getTime()<=t.endDate().getTime()+86e6};function n(e,t){return"string"==typeof e&&e.includes(t)}}(e)).map(function(e){return m("tr",[m("td",e.studyId),m("td",[m("a",{href:ut+e.studyUrl,target:"_blank"},"Study")]),m("td",[m("a",{href:ut+e.rulesUrl,target:"_blank"},"Rules")]),m("td",[m("a",{href:ut+e.autopauseUrl,target:"_blank"},"Autopause")]),m("td",ke(new Date(e.creationDate))),m("td",[e.startedSessions?(100*e.completedSessions/e.startedSessions).toFixed(1)+"% ":"n/a ",m("i.fa.fa-info-circle"),m(".card.info-box",[m(".card-header","Completion Details"),m("ul.list-group.list-group-flush",[m("li.list-group-item",[m("strong","Target Completions: "),e.targetCompletions]),m("li.list-group-item",[m("strong","Started Sessions: "),e.startedSessions]),m("li.list-group-item",[m("strong","Completed Sessions: "),e.completedSessions])])])]),m("td",[{R:m("span.label.label-success","Running"),P:m("span.label.label-info","Paused"),S:m("span.label.label-danger","Stopped")}[e.newStatus]]),m("td",[{R:m("span.label.label-success","Running"),P:m("span.label.label-info","Paused"),S:m("span.label.label-danger","Stopped")}[e.studyStatus]]),m("td",e.updaterId)])})])])])}},ct=function(e,t){return{"data-sort-by":e,class:t()===e?"active":""}};var dt=function(t,e,n){return m("button.btn.btn-secondary.btn-sm",{onclick:function(){var e=new Date;e.setDate(e.getDate()-n),t.startDate(e),t.endDate(new Date)}},e)},mt="R",ft=function(){return V(Q,{method:"post",body:{action:"getAllDownloads"}}).then(ht)},pt=function(e){return B(Q,{method:"post",body:Object.assign({action:"removeDownload"},e)}).then(ht)};function ht(e){return e&&e.error?Promise.reject({message:e.msg}):e}var yt,gt,vt,bt,wt={controller:function(e){var t=e.output,n=e.close,r={studyId:m.prop(""),db:m.prop("test"),startDate:m.prop(kt(3650)),endDate:m.prop(new Date)};t(r);var o={download:r,submitAttempt:!1,validity:function(){return{studyId:r.studyId()}},ok:function(){o.submitAttempt=!0;var t=o.validity();Object.keys(t).every(function(e){return t[e]})&&(r.endDate(function(e){if(e)return new Date(e.setHours(23,59,59,999))}(r.endDate())),n(!0))},cancel:function(){n(null)}};return o},view:function(e){var t,n,r,o,a=e.download,i=e.validity();return m("div",[m("h4","Request Data"),m(".card-block",[m(".row",[m(".col-sm-6",[m(".form-group",{class:(o=i.studyId,e.submitAttempt?We({"has-danger":!o,"has-success":o}):"")},[m("label","Study ID"),m("input.form-control",{config:_t,placeholder:"Study Id",value:a.studyId(),oninput:m.withAttr("value",a.studyId),class:(r=i.studyId,e.submitAttempt?We({"form-control-danger":!r,"form-control-success":r}):"")}),(t=i.studyId,n="The study ID is required in order to request a download.",t||!e.submitAttempt?"":m("small.text-muted",n))])]),m(".col-sm-6",[m(".form-group",[m("label","Database"),m("select.form-control.c-select",{onchange:m.withAttr("value",a.db)},[m("option",{value:"test",selected:"test"===a.db()},"Development"),m("option",{value:"warehouse",selected:"warehouse"===a.db()},"Production")])])])]),m(".row",[m(".col-sm-12",[m(".form-group",[ne(a),m("p.text-muted.btn-toolbar",[Dt(a,"Last 7 Days",7),Dt(a,"Last 30 Days",30),Dt(a,"Last 90 Days",90),Dt(a,"All time",3650)])])])])]),m(".text-xs-right.btn-toolbar",[m("a.btn.btn-secondary.btn-sm",{onclick:e.cancel},"Cancel"),m("a.btn.btn-primary.btn-sm",{onclick:e.ok},"OK")])])}},_t=function(e,t){t||e.focus()},kt=function(e){var t=new Date;return t.setDate(t.getDate()-e),t},xt=function(e,t){return e.getDate()===t.getDate()},Dt=function(e,t,n){return m("button.btn.btn-secondary.btn-sm",{class:(r=e,o=n,a=r.startDate,i=r.endDate,xt(a(),kt(o))&&xt(i(),new Date)?"active":""),onclick:function(){e.startDate(kt(n)),e.endDate(new Date)}},t);var r,o,a,i},St=(yt=At,gt=5e3,bt=!0,function(){var e=this,t=arguments;clearTimeout(vt),vt=setTimeout(function(){vt=null,yt.apply(e,t)},gt),bt&&(yt.apply(e,t),bt=!1)});function At(e){var t=e.list,n=e.cancel,r=e.error,o=e.loaded;return ft().then(t).then(function(e){!n()&&e.some(function(e){return e.studyStatus===mt})&&St({list:t,cancel:n,error:r,loaded:o})}).catch(r).then(function(){o(!0)}).then(m.redraw)}function Tt(r,o){return Ne.confirm({header:"Delete Request:",content:["Are you sure you want to delete this request from your queue?",m(".text-xs-center",m("small.muted-text","(Don't worry, the data will stay on our servers and you can request it again in the future)"))]}).then(function(e){if(e)return t=r,(n=o)(n().filter(function(e){return e!==t})),m.redraw(),void pt(t).catch(function(e){return n().push(t),Ne.alert({header:"Delete Request",content:e.message})});var t,n})}function Ct(a,i,s){var e,u=m.prop();return(e={output:u},Ne.custom({content:m.component(wt,Object.assign({close:Ne.close},e)),wide:!0})).then(function(e){if(e){var t=(o=u(),Object.keys(o).reduce(function(e,t){return e[t]=o[t](),e},{}));return a().unshift(Object.assign({studyStatus:mt,creationDate:new Date},t)),i(!0),(r=t,B(Q,{method:"post",body:Object.assign({action:"download"},r)}).then(ht)).catch((n="Error creating download",function(e){return Ne.alert({header:n,content:e.message})})).then(i.bind(null,!1)).then(function(){At({list:a,cancel:i,loaded:s})})}var n,r,o})}var Et={},Rt={controller:function(){var e=m.prop([]),t=m.prop(!1),n=m.prop(!1),r={loaded:t,list:e,cancelDownload:n,create:Ct,remove:Tt,globalSearch:m.prop(""),sortBy:m.prop("studyId"),onunload:function(){n(!0)},error:m.prop("")};return At({list:r.list,cancel:n,error:r.error,loaded:r.loaded}),r},view:function(t){if(!t.loaded())return m(".loader");var n=t.list;return t.error()?m(".downloads",[m("h3","Data Download"),m(".alert.alert-warning",[m("strong","Warning!! "),t.error().message])]):m(".downloads",[m(".row.m-b-1",[m(".col-sm-6",[m("h3","Data Download")]),m(".col-sm-3",[m("button.btn.btn-secondary.pull-right",{onclick:t.create.bind(null,n,t.cancelDownload,t.loaded)},[m("i.fa.fa-plus")," Request Data"])]),m(".col-sm-3",[m("input.form-control",{placeholder:"Search ...",oninput:m.withAttr("value",t.globalSearch)})])]),m("table",{class:"table table-striped table-hover",onclick:_e(n,t.sortBy)},[m("thead",[m("tr",[m("th",Mt("studyId",t.sortBy),"ID"),m("th","Data file"),m("th",Mt("db",t.sortBy),"Database"),m("th",Mt("fileSize",t.sortBy),"File Size"),m("th",Mt("creationDate",t.sortBy),"Date Added"),m("th","Status"),m("th","Actions")])]),m("tbody",[0===n().length?m("tr.table-info",[m("td.text-xs-center",{colspan:7},"There are no downloads running yet")]):n().filter(function(e){var t=e.globalSearch();return function(e){return n(e.studyId,t)||n(e.studyUrl,t)};function n(e,t){return"string"==typeof e&&e.includes(t)}}(t)).map(function(e){return m("tr",[m("td",e.studyId),m("td",e.studyStatus==mt?m("i.text-muted","Loading..."):e.fileSize?m("a",{href:e.studyUrl,download:e.studyId+".zip",target:"_blank"},"Download"):m("i.text-muted","No Data")),m("td",e.db),m("td","unknown"!==e.fileSize?e.fileSize:m("i.text-muted","Unknown")),m("td",[ke(new Date(e.creationDate)),"  ",m("i.fa.fa-info-circle"),m(".info-box",[m(".card",[m(".card-header","Creation Details"),m("ul.list-group.list-group-flush",[m("li.list-group-item",[m("strong","Creation Date: "),ke(new Date(e.creationDate))]),m("li.list-group-item",[m("strong","Start Date: "),ke(new Date(e.startDate))]),m("li.list-group-item",[m("strong","End Date: "),ke(new Date(e.endDate))])])])])]),m("td",[Et[e.studyStatus]]),m("td",[m(".btn-group",[m("button.btn.btn-sm.btn-secondary",{onclick:t.remove.bind(null,e,n)},[m("i.fa.fa-close")])])])])})])])])}},Mt=function(e,t){return{"data-sort-by":e,class:t()===e?"active":""}};Et.C=m("span.label.label-success","Complete"),Et[mt]=m("span.label.label-info","Running"),Et.X=m("span.label.label-danger","Error");function Ot(e){var t=Object.assign({action:"createDataAccessRequest"},e);return V(ee,{method:"post",body:t}).then(Pt)}function It(e){var t=Object.assign({action:"deleteDataAccessRequest"},e);return V(ee,{method:"post",body:t}).then(Pt)}function Pt(e){if(!e.error)return e;return Promise.reject({message:{1:"This ID already exists.",2:"The study could not be found.",3:"The rule file could not be found.",4:'The rules file does not fit the "research" schema.'}[e.error]})}var Ut={controller:function(e){var t=e.output,n=e.close,r={studyId:m.prop("")};t(r);var o={downloadAccess:r,submitAttempt:!1,validity:function(){return{studyId:r.studyId()}},ok:function(){o.submitAttempt=!0;var t=o.validity();Object.keys(t).every(function(e){return t[e]})&&n(!0)},cancel:function(){n(null)}};return o},view:function(e){var t,n,r,o,a=e.downloadAccess,i=e.validity();return m("div",[m("h4","Request Download Access From Admin"),m("p","This page will request access to a study from admin.  For studies created by users you should instead email them directly for access."),m(".card-block",[m(".form-group",{class:(o=i.studyId,e.submitAttempt?We({"has-danger":!o,"has-success":o}):"")},[m("label","Study Id"),m("input.form-control",{config:Yt,placeholder:"Study Id",value:a.studyId(),oninput:m.withAttr("value",a.studyId),class:(r=i.studyId,e.submitAttempt?We({"form-control-danger":!r,"form-control-success":r}):"")}),(t=i.studyId,n="The study ID is required in order to request access.",t||!e.submitAttempt?"":m("small.text-muted",n))])]),m(".text-xs-right.btn-toolbar",[m("a.btn.btn-secondary.btn-sm",{onclick:e.cancel},"Cancel"),m("a.btn.btn-primary.btn-sm",{onclick:e.ok},"OK")])])}},Yt=function(e,t){t||e.focus()},Lt={controller:function(e){var t=e.output,n=e.close,r={studyId:m.prop(""),username:m.prop("")};t(r);var o={downloadAccess:r,submitAttempt:!1,validity:function(){return{studyId:r.studyId(),username:r.username()}},ok:function(){o.submitAttempt=!0;var t=o.validity();Object.keys(t).every(function(e){return t[e]})&&n(!0)},cancel:function(){n(null)}};return o},view:function(n){var e,t=n.downloadAccess,r=n.validity(),o=function(e,t){return e||!n.submitAttempt?"":m("small.text-muted",t)},a=function(e){return n.submitAttempt?We({"form-control-danger":!e,"form-control-success":e}):""};return m("div",[m("h4","Grant Data Access"),m(".card-block",[m(".form-group",{class:(e=r.studyId,n.submitAttempt?We({"has-danger":!e,"has-success":e}):"")},[m("label","Study Id"),m("input.form-control",{config:jt,placeholder:"Study Id",value:t.studyId(),oninput:m.withAttr("value",t.studyId),class:a(r.studyId)}),m("label","Username"),m("input.form-control",{config:jt,placeholder:"Username",value:t.username(),oninput:m.withAttr("value",t.username),class:a(r.username)}),o(r.studyId,"The study ID is required in order to grant access."),o(r.username,"The username is required in order to grant access.")])]),m(".text-xs-right.btn-toolbar",[m("a.btn.btn-secondary.btn-sm",{onclick:n.cancel},"Cancel"),m("a.btn.btn-primary.btn-sm",{onclick:n.ok},"OK")])])}},jt=function(e,t){t||e.focus()},Nt={controller:function(e){var t=e.output,n=e.close,r={studyId:m.prop(""),username:m.prop("")};t(r);var o={downloadAccess:r,submitAttempt:!1,validity:function(){return{studyId:r.studyId(),username:r.username()}},ok:function(){o.submitAttempt=!0;var t=o.validity();Object.keys(t).every(function(e){return t[e]})&&n(!0)},cancel:function(){n(null)}};return o},view:function(n){var e,t=n.downloadAccess,r=n.validity(),o=function(e,t){return e||!n.submitAttempt?"":m("small.text-muted",t)},a=function(e){return n.submitAttempt?We({"form-control-danger":!e,"form-control-success":e}):""};return m("div",[m("h4","Revoke Data Access"),m(".card-block",[m(".form-group",{class:(e=r.studyId,n.submitAttempt?We({"has-danger":!e,"has-success":e}):"")},[m("label","Study Id"),m("input.form-control",{config:Ft,placeholder:"Study Id",value:t.studyId(),oninput:m.withAttr("value",t.studyId),class:a(r.studyId)}),m("label","Username"),m("input.form-control",{config:Ft,placeholder:"Username",value:t.username(),oninput:m.withAttr("value",t.username),class:a(r.username)}),o(r.studyId,"The study ID is required in order to revoke access."),o(r.username,"The username is required in order to revoke access.")])]),m(".text-xs-right.btn-toolbar",[m("a.btn.btn-secondary.btn-sm",{onclick:n.cancel},"Cancel"),m("a.btn.btn-primary.btn-sm",{onclick:n.ok},"OK")])])}},Ft=function(e,t){t||e.focus()};function qt(o,a){return Ne.confirm({header:"Approve Access Request:",content:"Are you sure you want to grant access of '"+o.studyId+"' to '"+o.username+"'?"}).then(function(e){if(e)return(t=o,n=!0,r=Object.assign({action:"updateApproved"},t,{approved:n}),V(ee,{method:"post",body:r}).then(Pt)).then(function(){return a(a().filter(function(e){return e!==o}))}).then(Ne.alert({header:"Grant access completed",content:"Access granted"})).catch(Gt("Grant Access")).then(m.redraw());var t,n,r})}var Ht=function(t,n){return Ne.confirm({header:"Delete request:",content:"Are you sure you want to delete the access request for'"+t.studyId+"'? If access has already been granted you will lose it"}).then(function(e){if(e)return It(t).then(function(){return n(n().filter(function(e){return e!==t}))}).then(Ne.alert({header:"Deletion complete",content:"Access has been deleted"})).catch(Gt("Remove Download Request")).then(m.redraw())})},Wt=function(){var e,n=m.prop();return(e={output:n},Ne.custom({content:m.component(Lt,Object.assign({close:Ne.close},e)),wide:!0})).then(function(e){if(e){var t=new Date;return Ot(Object.assign({approved:!0,creationDate:t},null,zt(n()))).then(Ne.alert({header:"Grant access completed",content:"Access granted"})).catch(Gt("Grant Access"))}})},Bt=function(){var e,n=m.prop();return(e={output:n},Ne.custom({content:m.component(Nt,Object.assign({close:Ne.close},e)),wide:!0})).then(function(e){if(e){var t=new Date;return It(Object.assign({creationDate:t},null,zt(n()))).then(Ne.alert({header:"Revoke access completed",content:"Access revoked"})).catch(Gt("Revoke Access"))}})},Vt=function(r){var e,o=m.prop();return(e={output:o},Ne.custom({content:m.component(Ut,Object.assign({close:Ne.close},e)),wide:!0})).then(function(e){if(e){var t=new Date,n=Object.assign({creationDate:t,approved:"access pending"},null,zt(o()));return Ot(n).then(function(){return r().unshift(n)}).then(m.redraw).catch(Gt("Data Access Request"))}})},Gt=function(t){return function(e){return Ne.alert({header:t,content:e.message})}},zt=function(n){return Object.keys(n).reduce(function(e,t){return e[t]=n[t](),e},{})},$t={controller:function(){var t={play:qt,loaded:m.prop(!1),remove:Ht,create:Vt,grant:Wt,revoke:Bt,list:m.prop([]),globalSearch:m.prop(""),sortBy:m.prop(),error:m.prop(""),isAdmin:!1};return ot().then(function(e){t.isAdmin="SU"===e.role}),V(ee,{method:"post",body:{action:"getAllOpenRequests"}}).then(Pt).then(t.list).catch(t.error).then(function(){t.loaded(!0)}).then(m.redraw),t},view:function(t){if(!t.loaded())return m(".loader");var n=t.list;return m(".downloadAccess",[m("h3","Data Download Access Requests"),m("p.col-xs-12.text-muted",[m("small",[t.isAdmin?"Approve requests by clicking the Play button; Reject requests by clicking the X button; To grant permission without a request: hit the Grant Access button; For all actions: The user will be notified by email.":"You will receive an email when your request is approved or rejected; To cancel a request, click the X button next to the request"])]),t.error()?m(".alert.alert-warning",m("strong","Warning!! "),t.error().message):m("table",{class:"table table-striped table-hover",onclick:_e(n,t.sortBy)},[m("thead",[m("tr",[m("th",{colspan:6},[m(".row",[m(".col-xs-3.text-xs-left",[m("button.btn.btn-secondary",{disabled:t.isAdmin,onclick:t.isAdmin||t.create.bind(null,n)},[m("i.fa.fa-plus"),"  Request Access From Admin"])]),m(".col-xs-2.text-xs-left",[m("button.btn.btn-secondary",{onclick:t.grant.bind(null,n)},[m("i.fa.fa-plus"),"  Grant Access"])]),m(".col-xs-2.text-xs-left",[t.isAdmin?m("button.btn.btn-secondary",{onclick:t.revoke.bind(null,n)},[m("i.fa.fa-plus"),"  Revoke Access"]):""]),m(".col-xs-5.text-xs-left",[m("input.form-control",{placeholder:"Global Search ...",oninput:m.withAttr("value",t.globalSearch)})])])])]),m("tr",[m("th",Zt("studyId",t.sortBy),"ID"),m("th",Zt("username",t.sortBy),"Username"),m("th",Zt("email",t.sortBy),"Email"),m("th",Zt("creationDate",t.sortBy),"Date"),m("th","Status"),m("th","Actions")])]),m("tbody",[0===n().length?m("tr.table-info",m("td.text-xs-center",{colspan:6},m("strong","Heads up! "),"There are no requests yet")):n().filter(function(t){return function(e){return n(e.studyId,t.globalSearch())||n(e.username,t.globalSearch())||n(e.email,t.globalSearch())};function n(e,t){return"string"==typeof e&&e.includes(t)}}(t)).map(function(e){return m("tr",[m("td",e.studyId),m("td",e.username),m("td",e.email),m("td",ke(new Date(e.creationDate))),!0===e.approved?m("td",{style:"color:green"},"access granted"):m("td",{style:"color:red"},"access pending"),m("td",[m(".btn-group",[e.canApprove&&!1===e.approved?m("button.btn.btn-sm.btn-secondary",{title:"Approve request, and auto email requester",onclick:t.play.bind(null,e,n)},[m("i.fa.fa-play")]):"",e.canDelete?m("button.btn.btn-sm.btn-secondary",{title:"Delete request.  If this is a granted request owner will lose access to it",onclick:t.remove.bind(null,e,n)},[m("i.fa.fa-close")]):""])])])})])])])}},Zt=function(e,t){return{"data-sort-by":e,class:t()===e?"active":""}};var Jt=function(e,t,n){function r(){e.style.height=document.documentElement.clientHeight-e.getBoundingClientRect().top+"px"}t||(r(),window.addEventListener("resize",r,!0),n.onunload=function(){window.removeEventListener("resize",r)})},Kt={controller:function(){var n={username:m.prop(""),password:m.prop(""),isloggedin:!1,loginAction:function(){n.username()&&n.password()&&(e=n.username,t=n.password,V("../connect",{method:"post",body:{username:e,password:t}})).then(function(){m.route(location.hash?decodeURIComponent(location.hash).substring(1):"./")}).catch(function(e){n.error(e.message),m.redraw()});var e,t},error:m.prop("")};return ot().then(function(e){e.isloggedin&&m.route("./")}),n},view:function(t){return m(".login.centrify",{config:Jt},[m(".card.card-inverse.col-md-4",[m(".card-block",[m("h4","Please sign in"),m("form",{onsubmit:t.loginAction},[m("input.form-control",{type:"username",placeholder:"Username / Email",value:t.username(),name:"username",autofocus:!0,oninput:m.withAttr("value",t.username),onkeydown:function(e){13==e.keyCode&&t.loginAction()},onchange:m.withAttr("value",t.username),config:Qt(t.username)}),m("input.form-control",{type:"password",name:"password",placeholder:"Password",value:t.password(),oninput:m.withAttr("value",t.password),onkeydown:function(e){13==e.keyCode&&t.loginAction()},onchange:m.withAttr("value",t.password),config:Qt(t.password)})]),t.error()?m(".alert.alert-warning",m("strong","Error: "),t.error()):"",m("button.btn.btn-primary.btn-block",{onclick:t.loginAction},"Sign in"),m("p.text-center",m("small.text-muted",m("a",{href:"index.html?/recovery"},"Lost your password?")))])])])}};function Qt(n){return function(e,t){t||setTimeout(function(){return n(e.value)},30)}}var Xt={curly:!1,latedef:"nofunc",undef:!0,unused:"vars",strict:!1,browser:!0,devel:!0,esversion:3,predef:["piGlobal","define","require","requirejs","angular"]},en={apiUrl:function(){return"../files/"+encodeURIComponent(this.studyId)+"/file/"+encodeURIComponent(this.id)},get:function(){var n=this;return V(this.apiUrl()).then(function(e){var t=e.content.replace(/\r\n/g,"\n").replace(/([^\n])$/,"$1\n");n.sourceContent(t),n.content(t),n.loaded=!0,n.error=!1,n.last_modify=e.last_modify}).catch(function(e){return n.loaded=!0,n.error=!0,Promise.reject(e)})},save:function(){var t=this;return V(this.apiUrl(),{method:"put",body:{content:this.content,last_modify:this.last_modify}}).then(function(e){return t.sourceContent(t.content()),t.last_modify=e.last_modify,e})},copy:function(e,t,n){return V(this.apiUrl()+"/copy/",{method:"put",body:{new_study_id:n}}).catch(function(e){return Promise.reject(e)})},del:function(){return B(this.apiUrl(),{method:"delete"})},hasChanged:function(){return this.sourceContent()!==this.content()},define:function(t){void 0===t&&(t=window),console.warn("This should be deprecated!!!");var n=t.requirejs,r=this.url,o=this.content();return new Promise(function(e){n.undef(r),t.eval(o.replace("define(","define('"+r+"',")),e()})},require:function(e){var n=this;void 0===e&&(e=window);var r=e.requirejs;return new Promise(function(e,t){r([n.url],e,t)})},checkSyntax:function(){var e=window.JSHINT;return this.syntaxValid=e(this.content(),Xt),this.syntaxData=e.data(),this.syntaxValid},setPath:function(e){void 0===e&&(e=""),this.path=e,this.name=e.substring(e.lastIndexOf("/")+1),this.basePath=e.substring(0,e.lastIndexOf("/"))+"/",this.type=e.substring(e.lastIndexOf(".")+1).toLowerCase()}},tn=function(t){var e=Object.create(en),n=decodeURIComponent(t.path);return e.setPath(n),Object.assign(e,t,{id:t.id,sourceContent:m.prop(t.content||""),content:function(n){var r=this,e=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return e.length&&(n=e[0],"js"===r.type&&r.checkSyntax()),n};return e.toJSON=function(){return n},e}.call(e,t.content||""),loaded:!1,error:!1,syntaxValid:void 0,syntaxData:void 0,undoManager:m.prop(),position:m.prop()}),e.content(t.content||""),t.files&&(e.files=t.files.map(tn).map(function(e){return Object.assign(e,{studyId:t.studyId})})),e},nn={loaded:!1,isUploading:!1,apiURL:function(e){return void 0===e&&(e=""),"../files/"+encodeURIComponent(this.id)+e},get:function(){var n=this;return V(this.apiURL()).then(function(e){var t=n.parseFiles(e.files);n.loaded=!0,n.isReadonly=e.is_readonly,n.istemplate=e.is_template,n.is_locked=e.is_locked,n.is_published=e.is_published,n.is_public=e.is_public,n.name=e.study_name,n.type=e.type||"minno02",n.base_url=e.base_url,n.versions=e.versions?e.versions:[],n.files(t),n.sort()}).catch(function(e){return n.error=!0,Promise.reject(e)})},parseFiles:function(e){var t=this;return r(e).map(tn).map(function e(t){var n=r(t.files).map(e);return[t].concat(n)}).reduce(function e(t,n){return Array.isArray(n)?t.concat(n.reduce(e,[])):t.concat(n)},[]).map(function(e){return Object.assign(e,{studyId:t.id})});function r(e){return e||[]}},mergeFiles:function(e){var n=this.parseFiles(e),r=this.files(),t=r.filter(function(t){return!n.some(function(e){return t.id==e.id})});n.filter(function(t){return!r.some(function(e){return e.id==t.id})}).forEach(this.addFile.bind(this)),t.forEach(this.removeFile.bind(this)),this.sort()},getFile:function(t){return this.files().find(function(e){return e.id===t})},getChosenFiles:function(){var r=this.vm;return function n(e){return e.reduce(function(e,t){return 1===r(t.id).isChosen()?e.push(t):e=e.concat(n(t.files||[])),e},[])}(this.files().filter(function(e){return"/"===e.basePath}))},addFile:function(e){this.files().push(e);var t=this.getParent(e);t&&(t.files||(t.files=[]),t.files.push(e))},removeFile:function(e){var t=this.getParent(e);function n(e,t){var n=e.indexOf(t);e.splice(n,1)}n(this.files(),e),t&&t.files&&n(t.files,e)},createFile:function(e){var n=this,r=e.name,o=e.content;void 0===o&&(o="");var a=e.isDir;if(/[^/-_.A-Za-z0-9]/.test(r))return Promise.reject({message:'The file name "'+r+'" is not valid'});if(this.files().some(function(e){return e.path===r}))return Promise.reject({message:'The file "'+r+'" already exists'});var t=r.substring(0,r.lastIndexOf("/")).replace(/^\//,"");return""===t||this.files().some(function(e){return e.isDir&&e.path===t})?V(this.apiURL("/file"),{method:"post",body:{name:r,content:o,isDir:a}}).then(function(e){Object.assign(e,{studyId:n.id,content:o,path:r,isDir:a});var t=tn(e);return t.id=encodeURIComponent(t.id),t.loaded=!0,n.addFile(t),e}).then(this.sort.bind(this)):Promise.reject({message:'The directory "'+t+'" does not exist'})},sort:function(e){var t=this.files().sort(n);return this.files(t),e;function n(e,t){var n=+!e.isDir+e.name.toLowerCase(),r=+!t.isDir+t.name.toLowerCase();return n<r?-1:r<n?1:0}},move:function(t,e){var n=this.files(),r=t.substring(0,t.lastIndexOf("/")),o=""===r||n.some(function(e){return e.isDir&&e.path===r}),a=n.some(function(e){return e.path===t}),i=this.getChildren(e).some(function(e){return e.hasChanged()});return o?a?Promise.reject({message:"Target file "+t+" already exists."}):i?Promise.reject({message:"You have unsaved changes in one of the files please save, then try again."}):V(e.apiUrl()+"/move/",{method:"put",body:{path:t,url:e.url}}).then(this.mergeFiles.bind(this)):Promise.reject({message:"Target folder "+r+" does not exist."})},uploadFiles:function(e){var t,n,r,o=this,a=e.path,i=e.fd,s=e.force;return i.append("forceUpload",+s),this.isUploading=!0,m.redraw(),(t=this.apiURL("/upload/"+("/"===a?"":encodeURIComponent(a))),n={method:"post",body:i},r=Object.assign({credentials:"same-origin"},n),fetch(t,r).then(F).then(H).catch(W)).then(this.mergeFiles.bind(this)).then(function(){return o.isUploading=!1}).catch(function(e){return o.isUploading=!1,Promise.reject(e)})},downloadFiles:function(e){return V(this.apiURL(),{method:"post",body:{files:e}}).then(function(e){return"../download?path="+e.zip_file+"&study=_PATH"})},delFiles:function(e){var t=e.map(function(e){return e.path});return V(this.apiURL(),{method:"delete",body:{files:t}}).then(this.mergeFiles.bind(this))},make_experiment:function(t,e){return V(this.apiURL("/file/"+t.id+"/experiment"),{method:"post",body:{descriptive_id:e}}).then(function(e){return t.exp_data=e})},delete_experiment:function(e){return B(this.apiURL("/file/"+e.id+"/experiment"),{method:"delete"})},update_experiment:function(e,t){return B(this.apiURL("/file/"+e.id+"/experiment"),{method:"put",body:{descriptive_id:t}})},getParents:function(t){return this.files().filter(function(e){return e.isDir&&0===t.basePath.indexOf(e.path)})},getParent:function(e){return this.getParents(e).reduce(function(e,t){return e&&e.path.length>t.path.length?e:t},null)},getChildren:function(e){return function e(t){if(!t.files)return[t];return t.files.map(e).reduce(function(e,t){return e.concat(t)},[t])}(e)}},rn=function(n){var r={};return function(e){if(!r[e])for(var t in r[e]={},n)r[e][t]=m.prop(n[t]());return r[e]}},on=function(e){var t=e.file;return m("div.img-editor.centrify",[m("img",{src:t.url})])},an=function(){return m(".centrify",[m("i.fa.fa-file.fa-5x"),m("h5","Unknow file type")])},sn=!window.externalHost&&"download"in document.createElement("a"),un=function(e,t){if(sn){var n=document.createElement("a");n.href=e,n.download=t,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)}else{window.open(e,"_blank").focus()}},ln={controller:function(e){var t=e.file,a=e.study,n=a.files().filter(function(e){return e.isDir}).filter(function(e){return e!==t}).map(function(e){var t=e.name,n=e.basePath,r=e.path,o=e.id;return{name:t,basePath:n,path:r,id:o,isOpen:m.prop(a.vm(o).isOpen())}}).reduce(function(e,t){var n=t.basePath;return e[n]||(e[n]=[]),e[n].push(t),e},{"/":[]});return{root:{isOpen:m.prop(!0),name:"/",path:"/"},dirs:n}},view:function(e,t){var n=e.dirs,r=e.root,o=t.newPath;return m(".card-block",[m("p.card-text",[m("strong","Moving to: "),cn(o())]),m(".folders-well",[m("ul.list-unstyled",function t(e,n,r){var o=n[e.path.replace(/\/?$/,"/")];return m("li",[m("i.fa.fa-fw",{onclick:function(){return e.isOpen(!e.isOpen())},class:We({"fa-caret-right":o&&!e.isOpen(),"fa-caret-down":o&&e.isOpen()})}),m("span",{onclick:function(){return r(e.path)}},[m("i.fa.fa-folder-o.m-r-1"),cn(e.name)]),o&&e.isOpen()?m("ul.bulletless",o.map(function(e){return t(e,n,r)})):""])}(r,n,o))])])}};function cn(e){return"/"===e?m("span.text-muted","Root Directory"):e}function dn(e){return G+"/"+encodeURIComponent(e)}function mn(e){return G+"/"+encodeURIComponent(e)+"/experiments"}var fn=function(){return V(G)},pn=function(){return V("../templates")},hn=function(e){return V(mn(e))},yn=function(e,t){return V(G+"/"+encodeURIComponent(e)+"/copy",{method:"put",body:{study_name:t}})},gn=function(e,t){return V((n=e,t?G+"/"+encodeURIComponent(n)+"/lock":G+"/"+encodeURIComponent(n)+"/unlock"),{method:"post"});var n},vn=function(e,t,n){return V(G+"/"+encodeURIComponent(e)+"/publish",{method:"post",body:{publish:t,update_url:n}})};var bn={controller:function(e){var t=e.new_study_id,n=e.study_id,r=m.prop([]),o=m.prop(!1),a=m.prop(null);return fn().then(function(e){return r(e.studies.sort(wn).filter(kn()))}).catch(a).then(o.bind(null,!0)).then(m.redraw),{studies:r,study_id:n,new_study_id:t,loaded:o,error:a}},view:function(e){var t=e.studies,n=e.study_id,r=e.new_study_id,o=e.loaded,a=e.error;return m("div",[o()?"":m(".loader"),a()?m(".alert.alert-warning",a().message):"",o()&&!t().length?m(".alert.alert-info","You have no studies yet"):"",m("select.form-control",{value:r(),onchange:m.withAttr("value",r)},[m("option",{value:"",disabled:!0},"Select Study"),t().filter(function(e){return!e.is_locked&&!e.is_public&&!e.isReadonly&&"read only"!==e.permission&&e.id!=n()}).map(function(e){return m("option",{value:e.id,selected:r()===e.id},e.name)})])])}};function wn(e,t){return e.name.toLowerCase()===t.name.toLowerCase()?0:e.name.toLowerCase()>t.name.toLowerCase()?1:-1}var _n,kn=function(){return function(e){return"regular"===e.study_type&&!e.is_template}},xn=function(a,i){return function(n,e){var t=e.map(function(e){return"/"===a?e:a+"/"+e}),r=i.files().filter(function(e){return t.includes(e.path)}).map(function(e){return e.path});return r.length?Ne.confirm({header:"Upload Files",content:"The file"+(1<r.length?"s":"")+' "'+r.join(", ")+'" already exists, do you want to overwrite '+(1<r.length?"them":"it")+"?",okText:"Overwrite"}).then(function(e){return e&&o({force:!0})}):o({force:!1});function o(e){void 0===e&&(e={force:!1});var t=e.force;return i.uploadFiles({path:a,fd:n,force:t}).catch(function(e){return Ne.alert({header:"Upload File",content:m("p.alert.alert-danger",e.message)})}).then(m.redraw)}}},Dn=function(r,o){return function(){var e,n=m.prop(r.basePath);Ne.confirm({header:"Move File",content:(e={newPath:n,file:r,study:o},m.component(ln,e))}).then(function(e){var t=n().replace(/\/$/,"")+"/"+r.name;if(e&&n()!==r.basePath)return An(t,r,o)})}},Sn=function(s,t){return function(){var e,o=m.prop(s.basePath),a=m.prop(t.id),i=m.prop("");Ne.confirm({header:"Copy File",content:(e={new_study_id:i,study_id:a},m.component(bn,e))}).then(function(e){if(e&&a()!==i)return t=o()+"/"+s.name,n=a,r=i,s.copy(t,n,r).catch(function(e){return Ne.alert({header:"Copy File",content:m("p.alert.alert-danger",e.message)})}).then(m.redraw);var t,n,r})}};function An(e,t,n){var r=t.id===m.route.param("fileId"),o=n.move(e,t).then(function(e){r&&m.route("/editor/"+n.id+"/file/"+encodeURI(t.id));return e}).catch(function(e){return Ne.alert({header:"Move/Rename File",content:m("p.alert.alert-danger",e.message)})}).then(m.redraw);return m.redraw(),o}var Tn=function(n,r){return function(){var e=r.files().every(function(e){return!e.hasChanged()}),t=function(){_n&&!_n.closed&&_n.close();(_n=window.open("../play/"+r.id+"/"+n.id,"Playground")).onload=function(){_n.addEventListener("unload",function(){window.focus()}),_n.focus()}};e?t():Ne.confirm({header:"Play task",content:"You have unsaved files, the player will use the saved version, are you sure you want to proceed?"}).then(function(e){return e&&t()})}},Cn=function(e){return function(){e.save().then(m.redraw).catch(function(e){return Ne.alert({header:"Error Saving:",content:e.message})})}},En=function(e){return m.prop(e.replace(/\/?$/,"/").replace(/^\//,""))},Rn=function(t,e,n){t.createFile({name:e(),content:n()}).then(function(e){return m.route("/editor/"+t.id+"/file/"+encodeURIComponent(encodeURIComponent(e.id))),e}).catch(function(e){return Ne.alert({header:"Failed to create file:",content:e.message})})},Mn=function(o){return function(){var t=o.getChosenFiles(),n=t.some(function(e){return e.id===m.route.param("fileId")});function r(e){return n&&m.route("/editor/"+o.id),e}t.length?Ne.confirm({header:"Remove Files",content:"Are you sure you want to remove all checked files? This is a permanent change."}).then(function(e){e&&o.delFiles(t).then(r).catch(function(e){return Ne.alert({header:"Failed to delete files:",content:e.message})}).then(m.redraw)}):Ne.alert({header:"Remove Files",content:"There are no files selected"})}},On=function(e){return function(){return e.content(e.sourceContent())}},In=function(){},Pn={controller:function(){var e=m.prop();return{editorCache:e,onunload:function(){e()&&e().destroy()}}},view:function(e,t){return m(".editor",{id:"text-editor",config:Pn.config(e,t)})},config:function(e,t){var h=e.editorCache,y=t.content,g=t.observer,v=t.settings;return void 0===v&&(v={}),function(l,e,t){var c=h(),d=v.mode||"javascript";c&&c.setReadOnly(!!v.isReadonly);var f=function(e){if(!c)return!1;var t=c.getSelectionRange().start,n=c.getSession().getLine(t.row).match(/^\s*/);n&&(e=e.replace(/(?:\r\n|\r|\n)/g,"\n"+n[0])),c.insert(e),c.focus()};function p(){var e=h();e&&e.getValue()!==y()&&(e.setValue(y()),e.moveCursorTo(0,0),e.focus())}e||(Jt(l,e,t),require(["ace/ace"],function(e){var t=v.undoManager||function(e){return e},n=v.position||function(e){return e};e.config.set("packaged",!0),e.config.set("basePath",require.toUrl("ace")),c=e.edit(l),h(c);var r=c.getSession(),o=c.commands;if(c.setReadOnly(!!v.isReadonly),c.setTheme("ace/theme/cobalt"),r.setMode("ace/mode/"+d),"javascript"!==d&&r.setUseWorker(!1),c.setHighlightActiveLine(!0),c.setShowPrintMargin(!1),c.setFontSize("18px"),c.$blockScrolling=1/0,r.on("changeMode",function(e,t){"ace/mode/javascript"===t.getMode().$id&&t.$worker&&v.jshintOptions&&t.$worker.send("setOptions",[v.jshintOptions])}),r.on("change",function(){y(c.getValue()),m.redraw()}),o.addCommand({name:"save",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:v.onSave||In}),g&&g.on("paste",f),g&&g.on("settings",function(){return c.execCommand("showSettingsMenu")}),p(),n()){var a=n(),i=a.scroll,s=a.row,u=a.column;c.session.setScrollTop(i),c.moveCursorTo(s,u),c.clearSelection()}r.setUndoManager(t()||t(new e.UndoManager)),c.focus(),c.on("destroy",function(){n(Object.assign({scroll:c.session.getScrollTop()},c.getCursorPosition())),g&&g.off(f)})})),p()}}};var Un={analize:function(e,t){var n=0,r=0,o=e?[]:t.errors.filter(function(e){return e}).map(function(e){var t=e.code&&"E"===e.code[0];return t?n++:r++,{isError:t,line:e.line,col:e.character,reason:e.reason,evidence:e.evidence}});return{isValid:e,data:t,errors:o,errorCount:n,warningCount:r}},controller:function(e){var t=e.file;return Un.analize(t.syntaxValid,t.syntaxData)},view:function(e){return m("div",[e.isValid?m("div",{class:"alert alert-success"},[m("strong","Well done!"),"Your script is squeaky clean"]):m("div",[m("table.table",[m("tbody",e.errors.map(function(e){return m("tr",[m("td.text-muted","line "+e.line),m("td.text-muted","col "+e.col),m("td",{class:e.isError?"text-danger":"text-info"},e.reason),m("td",e.evidence)])}))]),m(".row",[m(".col-md-6",[m("div",{class:"alert alert-danger"},[m("strong",{class:"glyphicon glyphicon-exclamation-sign"}),"You have "+e.errorCount+" critical errors."])]),m(".col-md-6",[m("div",{class:"alert alert-info"},[m("strong",{class:"glyphicon glyphicon-warning-sign"}),"You have "+e.warningCount+" non standard syntax errors."])])])])])}};function Yn(e,t){return{level:"warn",message:e,test:t}}function Ln(e,t){return{level:"error",message:e,test:t}}function jn(t,e){var n=function n(e){return e.reduce(function(e,t){return e.concat(Array.isArray(t)?n(t):t)},[])}(e).filter(function(e){return e}).filter(function(e){return"function"==typeof e.test?e.test(t):!!e.test});return n.length?{element:t,messages:n}:null}function Nn(e,t){return e.map(function(e){return e&&[].concat(e[t[0]],e[t[1]],e[t[2]])}).reduce(function(e,t){return e.concat(t)},[]).filter(function(e){return e})}function Fn(e){return e.reduce(function(e,t){return e.concat(t&&t.mixer?Fn([].concat((n=t).data,n.elseData,(n.branches||[]).map(function(e){return e.data}))):t);var n},[]).filter(function(e){return e})}function qn(){var e=[].splice.call(arguments,0);return[].concat.apply([],e).filter(function(e){return e})}function Hn(e,t){var n,r,o,a,i,s,u,l,c,d,m,f,p,h,y=[],g={trials:r=qn(Fn((n=e).sequence),n.trialSets),stimuli:o=qn(n.stimulusSets,Nn(r,["stimuli","layout"])),media:qn(n.mediaSets,Nn(o,["media","touchMedia"]))};return y.push({type:"Settings",errors:(a=e,i=t,s=a.settings||{},[(u="base_url",l=[(f=Yn,d="Your base_url is not in the same directory as your script.",m=function(e){var t=function(e){var t=document.createElement("a");return t.href=e,t.pathname},n=t(i).substring(0,i.lastIndexOf("/")+1),r=function(e){return!e||0!==t(e).indexOf(n)};return"object"==typeof e?r(e.image)&&r(e.template):r(e)},f(d,function(e){for(var t in e)return m(e[t])}))],c={},c[u]=s[u],u in s&&jn(c,l))].filter(function(e){return!!e}))}),y.push({type:"Trials",errors:(p=g.trials,h=Wn,p.map(h).filter(function(e){return e}))}),y}function Wn(e){var t,n=[function(e){return e?Array.isArray(e)?e.map(function(e,t){return[e.conditions?[Ln("Interaction conditon ["+t+"] must have a type",n(e.conditions).some(function(e){return!e.type}))]:Ln("Interaction ["+t+"] must have conditions",!0),e.actions?[Ln("Interaction action ["+t+"] must have a type",n(e.actions).some(function(e){return!e.type}))]:Ln("Interaction ["+t+"] must have actions",!0)]}):[Ln("Interactions must be an array.",!0)]:void 0;function n(e){return Array.isArray(e)?e:[e]}}(e.interactions),(t=e.input,t?Array.isArray(e.input)?[Ln("Input must always have a handle",t.some(function(e){return!e.handle})),Ln("Input must always have an on attribute",t.some(function(e){return!e.on}))]:[Ln("Input must be an Array",!0)]:void 0)];return jn(e,n)}var Bn={controller:function(e){var t=e.file,n={validations:m.prop([]),isError:!1};return m.startComputation(),t.define().then(function(){return t.require()}).then(function(e){n.validations(function(e){var t=e.type&&e.type.toLowerCase();switch(t){case"pip":return Hn.apply(null,arguments);case"quest":return function(){var e=[];return e.push({type:"Settings",errors:[]}),e.push({type:"Pages",errors:[]}),e.push({type:"Questions",errors:[]}),e}.apply(null,arguments);case"manager":return function(){var e=[];return e.push({type:"Settings",errors:[]}),e.push({type:"Tasks",errors:[]}),e}.apply(null,arguments);default:throw new Error("Unknown script.type: "+t)}}(e,t.url)),m.endComputation()}).catch(function(){n.isError=!0,m.endComputation()}),n},view:function(e){return m("div",[e.isError?m("div",{class:"alert alert-danger"},[m("strong",{class:"glyphicon glyphicon-exclamation-sign"}),"There was a problem parsing this script. Are you sure that it is a valid PI script? Make sure you fix all syntax errors."]):"",e.validations().map(function(e){return[m("h4",e.type),e.errors.length?e.errors.map(function(e){return m(".row",[m(".col-md-4.stringified",m("div",{class:"pre"},m.trust(function(e){if(null==e)return'<i class="text-muted">undefined</i>';if(""===e)return'<i class="text-muted">an empty string</i>';switch(typeof e){case"string":break;case"number":e=""+e;break;case"object":if(e instanceof Error){e=e.message;break}default:t=JSON.stringify(e,null,4),e=(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="'+t+'">'+e+"</span>"})}var t;return e}(e.element)))),m(".col-md-8",[m("ul",e.messages.map(function(e){return m("li.list-unstyled",{class:"error"==e.level?"text-danger":"text-info"},[m("strong",e.level),e.message])}))])])}):m("div",{class:"alert alert-success"},[m("strong","Well done!"),"Your script is squeaky clean"])]})])}};var Vn=function(e){return function(){return m.component($n,Zn(e))}},Gn=function(e,t){return function(){Ne.alert({header:"Copy URL",content:m.component($n,Zn(e),t),okText:"Done"})}},$n={controller:function(e){var t=m.prop(!1);return{autoCopy:function(){return(r=e,new Promise(function(e,t){var n=document.createElement("input");n.value=r,document.body.appendChild(n),n.select();try{document.execCommand("copy")}catch(e){t(e)}n.parentNode.removeChild(n)})).catch(function(){return t(!0)}).then(m.redraw);var r},copyFail:t}},view:function(e,t,n){var r=e.autoCopy,o=e.copyFail;return m(".card-block",[m(".form-group",[m("label","Copy Url by clicking Ctrl + C, or click the copy button."),m("label.input-group",[m(".input-group-addon",{onclick:r},m("i.fa.fa-fw.fa-copy")),m("input.form-control",{config:function(e){return e.select()},value:t})]),n?[m("input-group-addon",["Right-click ",m("a",{href:t},"HERE")," to launch"]),m("label","You can use this option to play that study in a private or incognito window to bypass cached content.")]:"",o()?m("small.text-muted","Auto copy will not work on your browser, you need to manually copy this url"):""])])}};function Zn(e){var t=document.createElement("a");return t.href=e,t.href}var Jn=function(e,t){return void 0===t&&(t="\t"),e.replace(/^/gm,t)},Kn=function(e){switch(typeof e){case"boolean":return e?"true":"false";case"string":return""===(t=e)?t:t.replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0").split("\n").map(function(e){return"'"+e+"'"}).join(" +\n\t");case"number":return e+"";case"undefined":return"undefined";case"function":return e.toJSON?Kn(e()):e.toString()}var t,n,r,o,a;return null===e?"null":Array.isArray(e)?(r=(n=e).every(function(e){return["string","number","boolean"].includes(typeof e)&&(void 0===e.length||e.length<15)}),o=n.map(function(e){return Kn(e)}).join(r?", ":",\n"),r?"["+o+"]":"[\n"+Jn(o)+"\n]"):(a=e,"{\n"+Object.keys(a).map(function(e){return(/[^1-9a-zA-Z$_]/.test(t=e)?"'"+t+"'":t)+" : "+Kn(a[e]);var t}).map(function(e){return Jn(e)}).join(",\n")+"\n}")},Qn=function(e){return m.component(Xn,e)},Xn={controller:function(e){var n=e.prop,t=n(),r=m.prop("string"==typeof t?"random":t.type),o=m.prop("string"==typeof t?t:t.set);return{type:function(e){arguments&&(r(e),a());return r()},set:function(e){arguments&&(o(e),a());return o()}};function a(){var e=r(),t=o();n("random"===e?t:{type:e,set:t})}},view:oe(function(e){var t=e.type,n=e.set;return m(".form-inline",[m(".form-group.input-group",[m("input.form-control",{placeholder:"Set",onchange:m.withAttr("value",n)}),m("span.input-group-addon",{style:"display:none"})]),m("select.c-select",{onchange:m.withAttr("value",t)},er.map(function(e){return m("option",{value:e},e)}))])})},er=["random","exRandom","sequential"],tr={controller:function(e){var t=e.output,n=e.close,r=ce(),o=m.prop("message"),a={inherit:m.prop(""),name:m.prop(""),title:m.prop("")},i=m.prop({});return{type:o,common:a,task:i,form:r,close:n,proceed:function(){t(Object.assign({type:o},a,i())),n(!0)()}}},view:function(e){var t=e.type,n=e.common,r=e.task,o=e.form,a=e.close,i=e.proceed;return m("div",[m("h4","Add task"),m(".card-block",[Qn({label:"inherit",prop:n.inherit,form:o,help:"Base this element off of an element from a set"}),pe({label:"type",prop:t,form:o,values:{message:"message","minno-time":"time","minno-quest":"minno","pip (old minno-time)":"pip"}}),de({label:"name",prop:n.name,help:"The name for the task",form:o}),de({label:"title",prop:n.title,help:"The title to be displayed in the browsers tab",form:o}),m.component(function(e){switch(e){case"message":return nr;case"pip":return or;case"quest":return ar;case"time":return rr;default:throw new Error("Unknown task type: "+e)}}(t()),{task:r,form:o})]),m(".text-xs-right.btn-toolbar",[m("a.btn.btn-secondary.btn-sm",{onclick:a(!1)},"Cancel"),m("a.btn.btn-primary.btn-sm",{onclick:i},"Proceed")])])}};var nr={controller:function(e){(0,e.task)({template:m.prop(""),templateUrl:m.prop("")})},view:function(e,t){var n=t.task,r=t.form,o=n();return m("div",[de({label:"templateUrl",prop:o.templateUrl,help:"The URL for the task template file",form:r}),de({label:"template",prop:o.template,rows:6,form:r,isArea:!0,help:m.trust("You can manually create your template here <strong>instead</strong> of using a url")})])}},rr={controller:function(e){(0,e.task)({scriptUrl:m.prop("")})},view:function(e,t){var n=t.task,r=t.form,o=n();return m("div",[de({label:"scriptUrl",prop:o.scriptUrl,help:"The URL for the task script file",form:r})])}},or={controller:function(e){var t=e.task,n=m.prop("0.3"),r=m.prop(""),o="//cdn.jsdelivr.net/gh/minnojs/minno-quest@"+n()+"/dist/js";t({version:n,scriptUrl:r,baseUrl:o})},view:function(e,t){var n=t.task,r=t.form,o=n();return m("div",[de({label:"scriptUrl",prop:o.scriptUrl,help:"The URL for the task script file",form:r}),pe({label:"version",prop:function(){arguments.length&&(o.version(arguments[0]),o.baseUrl="//cdn.jsdelivr.net/gh/minnojs/minno-quest@"+o.version()+"/dist/js");return o.version()},form:r,values:{.3:.3,.2:.2},help:"The version of PIP that you want to use"})])}},ar={controller:function(e){(0,e.task)({scriptUrl:m.prop("")})},view:function(e,t){var n=t.task,r=t.form,o=n();return m("div",[de({label:"scriptUrl",prop:o.scriptUrl,help:"The URL for the task script file",form:r})])}},ir={controller:function(e){var t=e.output,n=e.close,r=ce(),o={inherit:m.prop(""),header:m.prop(""),decline:m.prop(!1),progressBar:m.prop("<%= pagesMeta.number %> out of <%= pagesMeta.outOf%>"),autoFocus:!0,questions:[]};return t(o),{page:o,form:r,close:n}},view:function(e){var t=e.page,n=e.form,r=e.close;return m("div",[m("h4","Add Page"),m(".card-block",[Qn({label:"inherit",prop:t.inherit,form:n,help:"Base this element off of an element from a set"}),de({label:"header",prop:t.header,help:"The header for the page",form:n}),fe({label:"decline",description:"Allow declining to answer",prop:t.decline,form:n}),me({label:"progressBar",help:"If and when to display the  progress bar (use templates to control the when part)",prop:t.progressBar,form:n})]),m(".text-xs-right.btn-toolbar",[m("a.btn.btn-secondary.btn-sm",{onclick:r(!1)},"Cancel"),m("a.btn.btn-primary.btn-sm",{onclick:r(!0)},"Proceed")])])}},sr={controller:function(e){var t=e.output,n=e.close,r=ce(),o=m.prop(),a={inherit:m.prop(""),name:m.prop(""),stem:m.prop(""),required:m.prop(!1),errorMsg:{required:m.prop("")}},i=m.prop({});return t(i),{type:o,common:a,quest:i,form:r,close:n,proceed:function(){var e=t(Object.assign({type:o},a,i()));e.required()||(e.required=e.errorMsg=void 0);e.help&&e.help()||(e.help=e.helpText=void 0);n(!0)()}}},view:function(e){var t=e.type,n=e.common,r=e.quest,o=e.form,a=e.close,i=e.proceed;return m("div",[m("h4","Add Question"),m(".card-block",[pe({label:"type",prop:t,form:o,values:ur}),Qn({label:"inherit",prop:n.inherit,form:o,help:"Base this element off of an element from a set"}),de({label:"name",prop:n.name,help:"The name by which this question will be recorded",form:o}),de({label:"stem",prop:n.stem,help:"The question text",form:o}),m.component(lr(t()),{type:t,quest:r,form:o,common:n}),fe({label:"required",prop:n.required,description:"Require this question to be answered",form:o}),n.required()?de({label:"requiredText",help:"The error message for when the question has not been answered",prop:n.errorMsg.required,form:o}):""]),m(".text-xs-right.btn-toolbar",[m("a.btn.btn-secondary.btn-sm",{onclick:a(!1)},"Cancel"),m("a.btn.btn-primary.btn-sm",{onclick:i},"Proceed")])])}},ur={None:void 0,Text:"text","Text Area":"textarea","Select One":"selectOne","Select Multiple":"selectMulti",Slider:"slider"},lr=function(e){switch(e){case"text":return cr;case"textarea":return dr;case"selectOne":case"selectMulti":return mr;case"slider":return fr;case void 0:return{view:function(){return m("div")}};default:throw new Error("Unknown question type")}},cr={controller:function(e){var t=e.quest;e.common.errorMsg.required("This text field is required"),t({autoSubmit:m.prop(!1)})},view:function(e,t){var n=t.quest,r=t.form,o=n();return m("div",[fe({label:"autoSubmit",prop:o.autoSubmit,description:"Submit on enter",form:r})])}},dr={controller:function(e){var t=e.quest;e.common.errorMsg.required("This text field is required"),t({rows:m.prop(3),columns:m.prop("")})},view:function(e,t){var n=t.quest,r=t.form,o=n();return m("div",[de({label:"rows",prop:o.rows,help:"The number of visible text lines",form:r})])}},mr={controller:function(e){var t=e.quest;e.common.errorMsg.required("Please select an answer, or click 'decline to answer'"),t({autoSubmit:m.prop(!0),answers:m.prop(["Very much","Somewhat","Undecided","Not realy","Not at all"]),numericValues:!0,help:m.prop(!1),helpText:m.prop("Tip: For quick response, click to select your answer, and then click again to submit.")})},view:function(e,t){var n=t.quest,r=t.form,o=n();return m("div",[fe({label:"autoSubmit",prop:o.autoSubmit,description:"Submit on double click",form:r}),ye({label:"answers",prop:o.answers,rows:7,form:r,isArea:!0,help:"Each row here represents an answer option",required:!0}),me({label:"help",help:"If and when to display the help text (use templates to control the when part)",prop:o.help,form:r,dflt:"<%= pagesMeta.number < 3 %>"}),o.help()?de({label:"helpText",help:"The instruction text for using this type of question",prop:o.helpText,form:r,isArea:!0}):""])}},fr={controller:function(e){var t=e.quest;e.common.errorMsg.required("Please select an answer, or click 'decline to answer'"),t({min:m.prop(0),max:m.prop(100),steps:m.prop(""),hidePips:m.prop(!1),highlight:m.prop(!0),labels:m.prop(["Low","Medium","High"]),help:m.prop(!1),helpText:m.prop("Click on the gray line to indicate your judgment. After clicking the line, you can slide the circle to choose the exact judgment.")})},view:function(e,t){var n=t.quest,r=t.form,o=n();return m("div",[de({label:"min",prop:o.min,help:"The minimum value for the slider",form:r}),de({label:"max",prop:o.max,help:"The maximum value for the slider",form:r}),de({label:"steps",prop:o.steps,help:"Break the slider continuum to individual steps. Set to an integer or empty for a continuous slider",form:r}),o.steps()?"":fe({label:"hidePips",prop:o.hidePips,description:"Hide the markers for the individual steps",form:r}),ye({label:"labels",prop:o.labels,help:"A list of labels for the slider range",isArea:!0,rows:5,form:r}),me({label:"help",help:"If and when to display the help text (use templates to control the when part)",prop:o.help,form:r,dflt:"<%= pagesMeta.number < 3 %>"}),o.help()?de({label:"helpText",help:"The instruction text for using this type of question",prop:o.helpText,form:r,isArea:!0}):""])}},pr=function(e){return function(n){return function(){var t=m.prop();Ne.custom({preventEnterSubmits:!0,content:m.component(e,{output:t,close:function(e){return function(){return Ne.close(e)}}}),wide:!0}).then(function(e){return e&&n.trigger("paste",Kn((r=t(),Object.keys(r).reduce(function(e,t){var n=r[t];return"function"==typeof n&&n.toJSON&&(n=n()),""===n||void 0===n||Array.isArray(n)&&!n.length||(e[t]=n),e},{}))));var r})}}},hr=pr(tr),yr=pr(ir),gr=pr(sr);var vr=/(?:define\(\[['"])(.*?)(?=['"])/,br=function(e){return m.component(wr,e)},wr={controller:function(e){var r,t=e.file,n=m.prop();return t.loaded||t.get().catch(n).then(m.redraw),{mode:m.prop("edit"),observer:(r={},{on:function(e,t){r[e]||(r[e]=[]),r[e].push(t)},off:function(e){for(var t in r){var n=r[t].indexOf(e);-1<n&&r[t].splice(n,1)}},trigger:function(e){for(var t=[],n=arguments.length-1;0<n--;)t[n]=arguments[n+1];r[e]&&r[e].forEach(function(e){return e.apply(null,t)})}}),err:n}},view:function(e,t){var n,r,o,a,i,s,u,l,c,d,f,p,h,y,g=t.file,v=t.study,b=e.observer,w=e.err,_=e.mode;return g.loaded?g.error?m("div",{class:"alert alert-danger"},[m("strong",{class:"glyphicon glyphicon-exclamation-sign"}),'The file "'+g.path+'" was not found ('+(w()?w().message:"please try to refresh the page")+")."]):m(".editor",[(n={mode:_,file:g,study:v,observer:b},r=n.mode,o=n.file,a=n.study,i=n.observer,s=function(e){return function(){return r(e)}},u=function(e){return r()===e?"active":""},l="js"===o.type,c=o.hasChanged(),d=/\.expt\.xml$/.test(o.path),f=["html","htm","jst","ejs"].includes(o.type),p=vr.exec(o.content()),h=p&&p[1],y="https://app-prod-03.implicit.harvard.edu/implicit/Launch?study="+o.url.replace(/^.*?\/implicit/,"")+"&refresh=true",m(".btn-toolbar.editor-menu",[m(".file-name",{class:o.hasChanged()?"text-danger":""},m("span",{class:o.hasChanged()?"":"invisible"},"*"),o.path),m(".btn-group.btn-group-sm.pull-xs-right",[m("button.btn.btn-secondary",{onclick:On(o),title:"Reset any chnages made to this file since the last change"},[m("strong.fa.fa-refresh")]),m("a.btn.btn-secondary",{onclick:function(){return i.trigger("settings")},title:"Editor settings"},[m("strong.fa.fa-cog")])]),m(".btn-group.btn-group-sm.pull-xs-right",[m("a.btn.btn-secondary",{href:"https://minnojs.github.io/minno-quest/0.2/basics/overview.html",target:"_blank",title:"API documentation"},[m("strong.fa.fa-book"),m("strong"," Docs")]),m("a.btn.btn-secondary",{href:"https://github.com/ajaxorg/ace/wiki/Default-Keyboard-Shortcuts",target:"_blank",title:"Editor help"},[m("strong.fa.fa-info")])]),l?m(".btn-group.btn-group-sm.pull-xs-right",[m("a.btn.btn-secondary",{onclick:s("edit"),class:u("edit")},[m("strong",a.isReadonly?"View":"Edit")]),m("a.btn.btn-secondary",{onclick:s("syntax"),class:u("syntax")},[m("strong","Syntax ",o.syntaxValid?m("i.fa.fa-check-square.text-success"):m("span.label.label-danger",o.syntaxData.errors.length))])]):"",a.isReadonly?"":m(".btn-group.btn-group-sm.pull-xs-right",[/^minno/.test(a.type)?["managerAPI"!==h?"":[m("a.btn.btn-secondary",{onclick:hr(i),title:"Add task element"},[m("strong","T")])],"questAPI"!==h?"":[m("a.btn.btn-secondary",{onclick:gr(i),title:"Add question element"},[m("strong","Q")]),m("a.btn.btn-secondary",{onclick:yr(i),title:"Add page element"},[m("strong","P")])],m("a.btn.btn-secondary",{onclick:function(){return i.trigger("paste","{\n<%= %>\n}")},title:"Paste a template wizard"},[m("strong.fa.fa-percent")])]:"","html"===a.type&&f?[m("a.btn.btn-secondary",{onclick:function(){return i.trigger("paste","\x3c!-- os:base --\x3e")},title:"Paste a base url template"},[m("strong","base")]),m("a.btn.btn-secondary",{onclick:function(){return i.trigger("paste","\x3c!-- os:vars --\x3e")},title:"Paste a variables template"},[m("strong","vars")])]:""]),m(".btn-group.btn-group-sm.pull-xs-right",[/^minno/.test(a.type)?[l?m("a.btn.btn-secondary",{onclick:Tn(o,a),title:"Play this task"},[m("strong.fa.fa-play")]):"",d?[m("a.btn.btn-secondary",{href:y,target:"_blank",title:"Play this task"},[m("strong.fa.fa-play")]),m("a.btn.btn-secondary",{onmousedown:Gn(y),title:"Copy Launch URL"},[m("strong.fa.fa-link")])]:"",f?m("a.btn.btn-secondary",{href:o.url,target:"_blank",title:"View this file"},[m("strong.fa.fa-eye")]):""]:"","html"!==a.type?"":[f?m("a.btn.btn-secondary",{onclick:Tn(o,a),title:"Play this task"},[m("strong.fa.fa-play")]):""],m("a.btn.btn-secondary",{onclick:c&&Cn(o),title:"Save (ctrl+s)",class:We({"btn-danger-outline":c,disabled:!c||a.isReadonly})},[m("strong.fa.fa-save")])])])),_r(e,{key:g.id,file:g,observer:b,study:v})]):m(".loader")}},_r=function(e,t){var n,r,o,a=t.file,i=t.study,s=t.observer,u=kr[a.type]||"javascript";switch(e.mode()){case"edit":return o={content:a.content,observer:s,settings:{onSave:Cn(a),mode:u,jshintOptions:Xt,isReadonly:i.isReadonly||i.is_locked,undoManager:a.undoManager,position:a.position}},m.component(Pn,o);case"validator":return r={file:a},m.component(Bn,r);case"syntax":return n={file:a},m.component(Un,n)}},kr={js:"javascript",json:"json",jsp:"jsp",jst:"ejs",html:"ejs",htm:"ejs",txt:"txt",css:"css",scss:"scss",sass:"sass",m:"m",c:"cpp",cs:"cs",h:"txt",py:"py",xml:"xml"},xr={js:br,jsp:br,json:br,html:br,htm:br,jst:br,txt:br,m:br,c:br,cs:br,css:br,sass:br,scss:br,h:br,py:br,xml:br,jpg:on,jpeg:on,bmp:on,png:on,pdf:function(e){var t=e.file;return m("object",{data:t.url,type:"application/pdf",width:"100%",height:"100%"},[m("embed",{src:t.url,type:"application/pdf"},"Your browser does not support PDF")])}},Dr={controller:function(e){return{study:e.study}},view:function(e,t){var n=e.study;void 0===t&&(t={});var r=m.route.param("fileId"),o=n.getFile(r),a=o&&xr[o.type]||an;return m("div",{config:Jt},[o?a({file:o,study:n,settings:t.settings,key:o.id}):m(".centrify",[m("i.fa.fa-smile-o.fa-5x"),m("h5","Please select a file to start working")])])}};var Sr={controller:function(e){var t=e.study,n=m.prop(""),r=ce(),o=function(i){return function(){return i.basicPage.questions=[{inherit:{type:i.randomize()?"exRandom":"sequential",set:"questionList"}}],i.sequence=[{mixer:"repeat",times:i.times()||i.questionList().length,data:[{inherit:"basicPage"}]}],t=(e=i).basicPage,n=e.basicSelect,r=e.questionList,o=e.sequence,a=["var API = new Quest();","","// The structure for the basic questionnaire page","API.addPagesSet('basicPage', "+Kn(t)+");","","// The structure for the basic question    ","API.addQuestionsSet('basicSelect', "+Kn(n)+");","// This is the question pool, the sequence picks the questions from here","API.addQuestionsSet('questionList', "+Kn(r)+");","","// This is the sequence of questions",'// Note that you may want to update the "times" property if you change the number of questions',"API.addSequence("+Kn(o)+");","","return API.script;"].join("\n"),"define(['questAPI'], function(Quest){\n"+Jn(a)+"\n});";var e,t,n,r,o,a}},a={basicPage:{header:m.prop(""),decline:m.prop(!0),autoFocus:!0},basicSelect:{type:"selectOne",autoSubmit:m.prop(!1),numericValues:m.prop(!0),help:m.prop("<%= pagesMeta.number < 3 %>"),helpText:m.prop("Tip: For quick response, click to select your answer, and then click again to submit."),answers:m.prop(["Very much","Somewhat","Undecided","Not realy","Not at all"])},questionList:m.prop([{stem:"Do you like chocolate?",name:"q1",inherit:"basicSelect"},{stem:"Do you like bannanas?",name:"q2",inherit:"basicSelect"}]),times:m.prop(!1),randomize:m.prop(!0),sequence:[{mixer:"repeat",times:m.prop(10),data:[{inherit:"basicPage"}]}]};return{path:n,form:r,submit:function(){r.showValidation(!0),r.isValid()&&Rn(t,n,o(a))},script:a}},view:function(e){var t=e.form,n=e.submit,r=e.script,o=e.path,a=r.basicPage,i=r.basicSelect;return m(".wizard.container",[m("h3","Rating wizard"),m("p","This wizard is responsible for rating stuff"),de({label:"File Name",placeholder:"Path to file",prop:o,form:t,required:!0}),m("h4","Basic Page"),de({label:"Header",placeholder:"Page header",help:"The header for all pages.",prop:a.header,form:t}),fe({label:"Decline",description:"Allow users to decline",prop:a.decline,form:t}),m("h4","Basic Select"),fe({label:"autoSubmit",description:"Submit upon second click",prop:i.autoSubmit,form:t}),ye({label:"answers",prop:i.answers,rows:7,form:t,isArea:!0,help:"Each row here represents an answer option",required:!0}),fe({label:"numericValues",description:"Responses are recorded as numbers",prop:i.numericValues,form:t}),me({label:"help",help:"If and when to display the help text (use templates to control the when part)",prop:i.help,form:t}),i.help()?de({label:"helpText",help:"The instruction text for using this type of question",prop:i.helpText,form:t,isArea:!0}):"",m("h4","Sequence"),fe({label:"Randomize",description:"Randomize questions",prop:r.randomize,form:t}),me({label:"Choose",help:"Set a number of questions to choose from the pool. If this option is not selected all questions will be used.",form:t,prop:r.times}),ye({label:"questions",prop:r.questionList,toArr:function(e,t){return{stem:e,name:"q"+t,inherit:"basicSelect"}},fromArr:function(e){return e.stem},rows:20,form:t,isArea:!0,help:"Each row here represents a questions",required:!0}),m(".row",[m(".col-cs-12.text-xs-right",[!t.showValidation()||t.isValid()?m("button.btn.btn-primary",{onclick:n},"Create"):m("button.btn.btn-danger",{disabled:!0},"Not Valid")])])])}},Ar={vm:{show:m.prop(!1),style:m.prop({}),menu:m.prop([])},view:function(){return m(".context-menu",{class:We({"show-context-menu":Ar.vm.show()}),style:Ar.vm.style()},Ar.vm.menu().map(Tr))},open:function(a){return function(e){e.preventDefault(),e.stopPropagation();var t=e.pageX+"px",n=e.pageY+"px",r=window.innerHeight-e.pageY+"px",o=window.innerHeight/2>e.pageY?{left:t,top:n}:{left:t,bottom:r};Ar.vm.menu(a),Ar.vm.show(!0),Ar.vm.style(o),document.addEventListener("mousedown",function e(){Ar.vm.show(!1);document.removeEventListener("mousedown",e);m.redraw()},!1)}}},Tr=function(e,t){if(!e)return"";if(e.separator)return m(".context-menu-separator",{key:t});var n=e.action;return e.href&&!n&&(n=function(){window.open(e.href,"_blank").focus()}),e.disabled&&(n=null),m(".context-menu-item",{class:We({disabled:e.disabled,submenu:e.menu,key:t})},[m("button.context-menu-btn",{onmousedown:n},[m("i.fa",{class:e.icon}),m("span.context-menu-text",e.text)]),e.menu?m(".context-menu",e.menu.map(Tr)):""])},Cr=function(r,o){var e,a,i,n,s,t=r?r.isDir?r.path:r.basePath:"/",u=o.isReadonly,l=[];u||(l=l.concat([{icon:"fa-folder",text:"New Directory",action:(n=o,s=t,void 0===s&&(s=""),function(){var t=En(s);Ne.prompt({header:"Create Directory",content:"Please insert directory name",prop:t}).then(function(e){if(e)return n.createFile({name:t(),isDir:!0})}).then(m.redraw).catch(function(e){return Ne.alert({header:"Failed to create directory:",content:e.message})})})},{icon:"fa-file",text:"New File",action:(a=o,i=t,void 0===i&&(i=""),function(){var t=En(i),n=function(){return""};Ne.prompt({header:"Create file",content:"Please insert the file name:",prop:t}).then(function(e){if(e)return Rn(a,t,n)})})},{icon:"fa-magic",text:"New from wizard",menu:[{text:"Rating wizard",action:(e="rating",function(){return m.route("/editor/"+o.id+"/wizard/"+e)})}]}]));var c,d,f,p,h,y,g,v,b,w,_,k,x=o.versions.length?o.versions[o.versions.length-1].id:"";if(r){var D=r.exp_data&&!r.exp_data.inactive;u||l.push({separator:!0}),l=l.concat([{icon:"fa-refresh",text:"Refresh/Reset",action:On(r),disabled:u||r.content()==r.sourceContent()},{icon:"fa-download",text:"Download",action:(_=o,k=r,function(){if(!k.isDir)return un(k.url,k.name);_.downloadFiles([k.path]).then(function(e){return un(e,_.name)}).catch(function(e){return Ne.alert({header:"Failed to download files:",content:e.message})})})},{icon:"fa-link",text:"Copy URL",action:Gn(r.url)},D?{icon:"fa-desktop",text:"Experiment options",menu:[{icon:"fa-exchange",text:"Rename",action:(g=r,v=o,function(){var t=m.prop(g.exp_data.descriptive_id),e=m.prop("");return Ne.confirm({header:"New Name",content:m("div",[m("input.form-control",{placeholder:"Enter new descriptive id",value:t(),onchange:m.withAttr("value",t)}),e()?m("p.alert.alert-danger",e()):""])}).then(function(e){return e&&v.update_experiment(g,t())}).then(function(){g.exp_data.descriptive_id=t,m.redraw()})}),disabled:u},{icon:"fa-close",text:"Cancel Experiment File",action:(h=r,y=o,function(){Ne.confirm({header:"Remove Experiment",content:"Are you sure you want to remove this experiment? This is a permanent change."}).then(function(e){e&&y.delete_experiment(h)}).then(function(){delete h.exp_data,m.redraw()})}),disabled:u},{icon:"fa-play",href:z+"/"+r.exp_data.id+"/"+x,text:"Play this task"},{icon:"fa-link",text:"Copy Launch URL",action:Gn(z+"/"+r.exp_data.id+"/"+x,!0)}]}:{icon:"fa-desktop",text:"Make Experiment",action:(b=r,w=o,function(){var t=m.prop(b.path),e=m.prop("");return Ne.confirm({header:"New Name",content:m("div",[m("input.form-control",{placeholder:"Enter Descriptive Id",onchange:m.withAttr("value",t)}),e()?m("p.alert.alert-danger",e()):""])}).then(function(e){return e&&w.make_experiment(b,t()).then(function(){return m.redraw()})})}),disabled:u},{icon:"fa-close",text:"Delete",action:function(){var t=r.id===m.route.param("fileId");function n(e){return t&&m.route("/editor/"+o.id),e}Ne.confirm({header:["Delete ",m("small",r.name)],content:"Are you sure you want to delete this file? This action is permanent!"}).then(function(e){e&&o.delFiles([r]).then(n).catch(function(e){return Ne.alert({header:"Failed to delete file:",content:e.message})}).then(m.redraw)})},disabled:u},{icon:"fa-arrows-v",text:"Move",action:Dn(r,o),disabled:u},{icon:"fa-clone",text:"Duplicate",action:(f=r,p=o,function(){var t=m.prop(f.path);return Ne.prompt({header:"Duplicate File",postContent:m("p.text-muted",'You can move a file to a specific folder be specifying the full path. For example "images/img.jpg"'),prop:t}).then(function(e){if(e&&t()!==f.name)return Rn(p,t,f.content)})}),disabled:u},{icon:"fa-clone",text:"Copy to Different Study",action:Sn(r,o),disabled:u},{icon:"fa-exchange",text:"Rename...",action:(c=r,d=o,function(){var t=m.prop(c.path);return Ne.prompt({header:"Rename File",postContent:m("p.text-muted",'You can move a file to a specific folder be specifying the full path. For example "images/img.jpg"'),prop:t}).then(function(e){if(e&&t()!==c.name)return An(t(),c,d)})}),disabled:u}])}return Ar.open(l)},Er="is-dragover";var Rr=function(n){return function(e,t){t||function(t,n){function e(){t.classList.remove(Er)}n=n||{},t.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation(),t.classList.add(Er)}),t.addEventListener("dragleave",e),t.addEventListener("dragend",e),t.addEventListener("drop",e),t.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation(),Mr(n)(e),m.redraw()})}(e,{onchange:n.onchange})}},Mr=function(m){return function(e){var t,n,r,o,a,i,s,u,l,c=e.dataTransfer||e.target,d=m.onchange;"function"==typeof d&&(c.items&&c.items.length&&"webkitGetAsEntry"in c.items[0]?function(e,t){var o=new FormData,a=[],n=[];function i(e,r,n){r||(r=e.name),function n(r,e,o,a){var i=e||r.createReader();i.readEntries(function(e){var t=o?o.concat(e):e;e.length?setTimeout(n.bind(null,r,i,t,a),0):a(t)})}(e,0,0,function(e){var t=[];e.forEach(function(e){t.push(new Promise(function(n){e.isFile?e.file(function(e){var t=r+"/"+e.name;o.append("files[]",e,t),a.push(t),n()},n.bind()):i(e,r+"/"+e.name,n)}))}),Promise.all(t).then(n.bind())})}[].slice.call(e).forEach(function(e){(e=e.webkitGetAsEntry())&&n.push(new Promise(function(t){e.isFile?e.file(function(e){o.append("files[]",e,e.name),a.push(e.name),t()},t.bind()):e.isDirectory&&i(e,null,t)}))}),Promise.all(n).then(t.bind(null,o,a))}(c.items,d):"getFilesAndDirectories"in c?(a=c,i=d,s=new FormData,u=[],l=function(e,r,t){var o=[];e.forEach(function(n){o.push(new Promise(function(t){if("getFilesAndDirectories"in n)n.getFilesAndDirectories().then(function(e){l(e,n.path+"/",t)});else{if(n.name){var e=(r+n.name).replace(/^[/\\]/,"");s.append("files[]",n,e),u.push(e)}t()}}))}),Promise.all(o).then(t)},a.getFilesAndDirectories().then(function(t){new Promise(function(e){l(t,"/",e)}).then(i.bind(null,s,u))})):c.files?(t=c,n=d,r=new FormData,o=[],[].slice.call(t.files).forEach(function(e){r.append("files[]",e,e.webkitRelativePath||e.name),o.push(e.webkitRelativePath||e.name)}),n(r,o)):d())}};var Or={view:function(e,t){var n=t.file,r=t.folderHash,o=t.study,a=o.vm(n.id),i=!!(n.isDir&&n.files&&n.files.length);return m("li.file-node",{key:n.id,class:We({open:a.isOpen()}),onclick:n.isDir?Ir(a):Pr(n),oncontextmenu:Cr(n,o),config:n.isDir?Rr({onchange:xn(n.path,o)}):null},[m("a.wholerow",{unselectable:"on",class:We({current:m.route.param("fileId")===n.id})},m.trust("&nbsp;")),m("i.fa.fa-fw",{class:We({"fa-caret-right":i&&!a.isOpen(),"fa-caret-down":i&&a.isOpen()})}),m("a",{class:We({"text-primary":/\.expt\.xml$/.test(n.name)})},[m("i.fa.fa-fw",{onclick:Ur({file:n,study:o}),class:We({"fa-check-square-o":1===a.isChosen(),"fa-square-o":0===a.isChosen(),"fa-minus-square-o":-1===a.isChosen()})}),m("i.fa.fa-fw.fa-file-o",{class:We({"fa-file-code-o":/(js)$/.test(n.type),"fa-file-text-o":/(jst|html|xml)$/.test(n.type),"fa-file-image-o":/(jpg|png|bmp)$/.test(n.type),"fa-file-pdf-o":/(pdf)$/.test(n.type),"fa-folder-o":n.isDir})}),m("span",{class:We({"font-weight-bold":n.hasChanged()})}," "+n.name),i&&a.isOpen()?Yr({path:n.path+"/",folderHash:r,study:o}):""])])}},Ir=function(t){return function(e){t.isOpen(!t.isOpen()),e.preventDefault(),e.stopPropagation()}},Pr=function(t){return function(e){e.stopPropagation(),e.preventDefault(),t.viewStudy?m.route("/view/"+m.route.param("code")+"/file/"+encodeURIComponent(t.id)):m.route("/editor/"+t.studyId+"/file/"+encodeURIComponent(t.id)),m.redraw.strategy("diff")}},Ur=function(e){var n=e.file,o=e.study;return function(e){e.stopPropagation(),e.preventDefault();var t=1===r(n)()?0:1;function r(e){return o.vm(e.id).isChosen}o.getChildren(n).forEach(function(e){return r(e)(t)}),o.getParents(n).forEach(function(t){var e=o.getChildren(t).filter(function(e){return e!==t}).map(function(e){return r(e)()}).reverse(),n=e.every(function(e){return 0===e})?0:e.every(function(e){return 1===e})?1:-1;r(t)(n)})}},Yr=function(e){return e.key=e.path,m.component(Lr,e)},Lr={view:function(e,t){var n=t.path,r=t.folderHash,o=t.study,a=r[n]||[];return m(".files",[m("ul",a.map(function(e){return t={key:e.id,file:e,folderHash:r,study:o},m.component(Or,t);var t}))])}},jr=function(e){return e.reduce(function(e,t){var n=t.basePath;return e[n]||(e[n]=[]),e[n].push(t),e},{})};var Nr=function(e){return m.component(Fr,e)},Fr={controller:function(){return{isOpen:m.prop(!1),inLowerViewport:m.prop(!0)}},view:function(e,t){var n=e.isOpen,r=e.inLowerViewport,o=t.toggleSelector,a=t.toggleContent,i=t.elements,s=t.right;return m(".dropdown.dropdown-component",{class:We({open:n()}),config:Fr.config(n)},[m(o,{onmousedown:function(e){r(document.documentElement.clientHeight/2<e.target.getBoundingClientRect().top),n(!n())}},a),m(".dropdown-menu",{class:We({"dropdown-menu-right":s,"dropdown-menu-up":r()})},i)])},config:function(o){return function(r,e,t){function n(e){if(o()){if(e.target.closest&&e.target.closest(".dropdown")===r&&(t=e.target,n="dropdown-onclick",!(-1<(" "+t.className+" ").replace(/[\n\t\r]/g," ").indexOf(" "+n+" "))))return!0;var t,n;o(!1),m.redraw()}}e||(document.addEventListener("mousedown",n,!1),t.onunload=function(){return document.removeEventListener("mousedown",n)})}}};var qr={controller:function(e){var t=e.load_templates,n=e.studies,r=e.reuse_id,o=e.templates,a=e.template_id,i=m.prop(!1),s=m.prop(null);return t().then(function(e){return o(e.templates)}).catch(s).then(i.bind(null,!0)).then(m.redraw),{studies:n,template_id:a,reuse_id:r,templates:o,loaded:i,error:s}},view:function(e){var t=e.studies,n=e.template_id,r=e.reuse_id,o=e.templates,a=e.loaded,i=e.error;return m("div.space",[a()?"":m(".loader"),i()?m(".alert.alert-warning",i().message):"",a()&&!o().length?m(".alert.alert-info","There is no templates yet"):"",m("select.form-control",{value:n(),onchange:m.withAttr("value",n)},[m("option",{value:"",disabled:!0},"Select template"),o().filter(Wr()).sort(Hr).map(function(e){return m("option",{value:e.id},e.name)})]),n()?m("div.space",[m("select.form-control",{value:r(),onchange:m.withAttr("value",r)},[m("option",{value:"",disabled:!0},"Select template for reuse (optional)"),t.map(function(e){return m("option",{value:e.id},e.name)})])]):""])}};function Hr(e,t){return e.name.toLowerCase()===t.name.toLowerCase()?0:e.name.toLowerCase()>t.name.toLowerCase()?1:-1}var Wr=function(){return function(e){return"owner"==e.permission}};function Br(e){return $+"/"+encodeURIComponent(e)}function Vr(e){return G+"/"+encodeURIComponent(e)+"/tags"}var Gr=function(){return V($,{method:"get"})},zr=function(e,t){return V($,{method:"post",body:{tag_text:e,tag_color:t}})},$r=function(e,t,n){return V(Br(e),{method:"put",body:{tag_text:t,tag_color:n}})};var Zr={controller:function(e){var t,n=e.tags,r=e.study_id,o=m.prop(""),a=m.prop(!1),i=m.prop(null);return(t=r,V(Vr(t),{method:"get"})).then(function(e){return n(e.tags)}).catch(i).then(a.bind(null,!0)).then(m.redraw),{tagName:o,tags:n,loaded:a,error:i}},view:function(e,t){var n,r,o,a,i=e.tagName,s=e.tags,u=e.loaded,l=e.error;t.study_id;return m("div",[m(".input-group",[m("input.form-control",{placeholder:"Filter Tags",value:i(),oninput:m.withAttr("value",i)}),m("span.input-group-btn",[m("button.btn.btn-secondary",{onclick:(r=i,o=s,a=l,function(){return zr(r(),"E7E7E7").then(function(e){return o().push(e)}).then(r.bind(null,"")).catch(a).then(m.redraw)}),disabled:!i()},[m("i.fa.fa-plus")," Create New"])])]),m(".small.text-muted.m-b-1",'Use this text field to filter your tags. Click "Create New" to turn a filter into a new tag'),u()?"":m(".loader"),l()?m(".alert.alert-warning",l().message):"",u()&&!s().length?m(".alert.alert-info","You have no tags yet"):"",m(".custom-controls-stacked.pre-scrollable",s().sort(Jr).filter((n=i(),function(e){return-1!==e.text.indexOf(n)})).map(function(e){return m("label.custom-control.custom-checkbox",[m("input.custom-control-input",{type:"checkbox",checked:e.used,onclick:function(){e.used=!e.used,e.changed=!e.changed}}),m("span.custom-control-indicator"),m("span.custom-control-description.m-l-1.study-tag",{style:{"background-color":"#"+e.color}},e.text)])}))])}};function Jr(e,t){return e.text.toLowerCase()===t.text.toLowerCase()?0:e.text.toLowerCase()>t.text.toLowerCase()?1:-1}var Kr={controller:function(e){var t=e.exps,n=(e.dates,e.study_id),r=e.versions,o=e.close,a={data_study_id:m.prop(""),exp_id:m.prop(""),study_id:m.prop(n),exps:t,versions:r,studies:m.prop([]),version_id:m.prop(""),all_exp_ids:m.prop(""),all_versions:m.prop(""),file_format:m.prop("csv"),file_split:m.prop("taskName"),loaded:m.prop(!1),downloaded:m.prop(!0),link:m.prop(""),error:m.prop(null),dates:{startDate:m.prop(Qr(3650)),endDate:m.prop(Qr(-1))}};return fn().then(function(e){a.studies(e.studies),a.studies(a.studies().filter(function(e){return e.has_data_permission}).sort(to))}).then(function(){return no(a)}),{ctrl:a,close:o}},view:function(e){var t=e.ctrl,n=e.close;return m("div",[m(".card-block",[m(".input-group",[m("strong","Study name"),m("select.c-select.form-control",{onchange:function(e){return function(e,t){e.study_id(t),e.loaded.bind(null,!1);var n=e.studies().filter(function(e){return e.id==t})[0];return e.versions=n.versions,no(e)}(t,e.target.value)}},[t.studies().map(function(e){return m("option",{value:e.id,selected:e.id==t.study_id()},e.name)})])]),m(".row",[m(".col-sm-4",[m(".input-group",[m("strong","Experimant id"),m("select.c-select.form-control",{onchange:function(e){return t.exp_id(e.target.value)}},[t.exps().length<=1?"":m("option",{selected:!0,value:t.all_exp_ids()},"All experiments"),t.exps().map(function(e){return m("option",{value:e.ids},e.descriptive_id)})])])]),m(".col-sm-5",[m(".input-group",[m("strong","Version id"),m("select.c-select.form-control",{onchange:function(e){return t.version_id(e.target.value)}},[t.versions.length<=1?"":m("option",{selected:!0,value:t.all_versions()},"All versions"),t.versions.map(function(e){return m("option",{value:e.id},e.version+" ("+e.state+")")})])])]),m(".col-sm-3",[m(".input-group",[m("strong","Output type"),m("select.c-select.form-control",{onchange:function(e){return t.file_format(e.target.value)}},[m("option",{value:"csv"},"csv"),m("option",{value:"tsv"},"tsv"),m("option",{value:"json"},"json")])])])]),m(".row.space",[m(".col-sm-9",[m("span","Split to files by (clear text to download in one file):"),m("input.form-control",{placeholder:"File split variable",value:t.file_split(),oninput:m.withAttr("value",t.file_split)})])]),m(".row.space",[m(".col-sm-12",[m(".form-group",[ne(t.dates),m("p.text-muted.btn-toolbar",[eo(t.dates,"Last 7 Days",7),eo(t.dates,"Last 30 Days",30),eo(t.dates,"Last 90 Days",90),eo(t.dates,"All time",3650)])])])])]),t.loaded()?"":m(".loader"),t.error()?m(".alert.alert-warning",t.error()):"",!t.loaded()&&t.exps().length<1?m(".alert.alert-info","You have no experiments yet"):"",t.link()?m("input-group-addon",["Your file is ready for downloading: ",m("a",{href:t.link()},t.link())]):"",t.downloaded()?"":m(".loader"),m(".text-xs-right.btn-toolbar",[m("a.btn.btn-secondary.btn-sm",{onclick:function(){n(null)}},"Cancel"),m("a.btn.btn-primary.btn-sm",{onclick:function(){!function(n){if(n.error(""),""===n.exp_id())return error("Please select experiment id");Array.isArray(n.exp_id())||n.exp_id(n.exp_id().split(","));return n.downloaded(!1),(e=n.study_id(),t=n.exp_id(),r=n.version_id(),o=n.file_format(),a=n.file_split(),i=n.dates.startDate(),s=n.dates.endDate(),V(mn(e),{method:"post",body:{exp_id:t,version_id:r,file_format:o,file_split:a,start_date:i,end_date:s}})).then(function(e){var t=e.data_file;if(null==t)return Promise.reject("There was a problem creating your file, please contact your administrator");n.link("../download?path="+t,t)}).catch(function(e){return n.error(e.message)}).then(function(){return n.downloaded(!0)}).then(m.redraw);var e,t,r,o,a,i,s}(t)}},"OK")])])}};var Qr=function(e){var t=new Date;return t.setDate(t.getDate()-e),t},Xr=function(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()},eo=function(e,t,n){return m("button.btn.btn-secondary.btn-sm",{class:(r=e,o=n,a=r.startDate,i=r.endDate,Xr(a(),Qr(o))&&Xr(i(),new Date)?"active":""),onclick:function(){e.startDate(Qr(n)),e.endDate(new Date)}},t);var r,o,a,i};function to(e,t){return e.name.toLowerCase()===t.name.toLowerCase()?0:e.name.toLowerCase()>t.name.toLowerCase()?1:-1}function no(r){hn(r.study_id()).then(function(e){r.exps(e.experiments),r.all_exp_ids(r.exps().map(function(e){return e.id})),r.exp_id(r.all_exp_ids());var n=[];r.exps().forEach(function(t){n.find(function(e){return e.descriptive_id===t.descriptive_id})?n.map(function(e){return e.descriptive_id===t.descriptive_id?e.ids.push(t.id):e}):n.push({ids:[t.id],descriptive_id:t.descriptive_id}),r.exps(n)}),console.log(r.exps())}).then(function(){r.all_versions(r.versions.map(function(e){return e.id})),r.version_id(r.all_versions())}).catch(r.error).then(r.loaded.bind(null,!0)).then(m.redraw)}function ro(e){return G+"/"+encodeURIComponent(e)+"/collaboration"}function oo(e){return G+"/"+encodeURIComponent(e)+"/link"}var ao=function(e,t){return V(G+"/"+encodeURIComponent(e)+"/public",{method:"post",body:{is_public:t}})},io=function(t,n){var r=m.prop(""),o=m.prop(""),a=m.prop([]),i=m.prop(""),s=m.prop(""),u=m.prop(""),l=m.prop("minno02"),c="regular"!==t,d=function(){return Ne.confirm({header:c?"New Template Study":"New Study",content:m.component({view:function(){return m("p",[m(".form-group",[m("label","Enter Study Name:"),m("input.form-control",{oninput:m.withAttr("value",r)})]),m(".form-group",[m("label","Enter Study Description:"),m("textarea.form-control",{oninput:m.withAttr("value",o)})]),c?"":m(".form-group",[m("label","Pick Study Player:"),m("select.c-select.form-control",{onchange:m.withAttr("value",l)},[m("option",{value:"minno02"},"MinnoJS v0.2"),m("option",{value:"html"},"JSPysch (run any HTML)")])]),u()?m("p.alert.alert-danger",u()):"",c?m("p",(e={load_templates:pn,studies:n,reuse_id:s,templates:a,template_id:i},m.component(qr,e))):""]);var e}})}).then(function(e){return e&&f()})},f=function(){return(e={study_name:r,study_type:l,description:o,type:t,template_id:i,reuse_id:s},V(G,{method:"post",body:e})).then(function(e){return m.route("regular"==t?"/editor/"+e.study_id:"/translate/"+e.study_id)}).catch(function(e){u(e.message),d()});var e};d()},so=function(n){return function(e){e.preventDefault();var t=m.prop("");return Ne.confirm({okText:["Yes, make ",n.is_public?"private":"public"],cancelText:["No, keep ",n.is_public?"public":"private"],header:"Are you sure?",content:m("p",[m("p",n.is_public?"Making the study private will hide its files from everyone but you.":"Making the study public will allow everyone to view the files. It will NOT allow others to modify the study or its files."),m("span",{class:t()?"alert alert-danger":""},t())])}).then(function(e){e&&ao(n.id,!n.is_public).then(n.is_public=!n.is_public).then(m.redraw)})}},uo=function(o,a){return function(e){e.preventDefault();var t=m.prop(""),n=function(){return Ne.confirm({okText:["Yes, ",o.is_locked?"unlock":"lock"," the study"],cancelText:"Cancel",header:"Are you sure?",content:m("p",[m("p",o.is_locked?o.is_published?[m("p","Unlocking the study will let you modifying the study. When a study is Unlocked, you can add files, delete files, rename files, edit files, rename the study, or delete the study."),m("p","However, the study is currently published so you might want to make sure participants are not taking it. We recommend unlocking a published study only if you know that participants are not taking it while you modify the files, or if you know exactly what you are going to change and you are confident that you will not make mistakes that will break the study.")]:"Unlocking the study will let you modifying the study. When a study is Unlocked, you can add files, delete files, rename files, edit files, rename the study, or delete the study.":"Are you sure you want to lock the study? This will prevent you from modifying the study until you unlock the study again. When a study is locked, you cannot add files, delete files, rename files, edit files, rename the study, or delete the study."),t()?m("p.alert.alert-danger",t()):""])}).then(function(e){return e&&r()})},r=function(){return gn(o.id,!o.is_locked).then(function(){return o.is_locked=!o.is_locked}).then(function(){return o.isReadonly=o.is_locked}).then(a).catch(function(e){t(e.message),n()}).then(m.redraw)};n()}},lo=function(a,i){return function(e){e.preventDefault();var t=m.prop(""),n=m.prop("update"),r=function(){return Ne.confirm({okText:["Yes, ",a.is_published?"Unpublish":"Publish"," the study"],cancelText:"Cancel",header:[a.is_published?"Unpublish":"Publish"," the study?"],content:m("p",[m("p",a.is_published?"The launch URL participants used to run the study will be removed. Participants using this link will see an error page. Use it if you completed running the study, or if you want to pause the study and prevent participants from taking it for a while. You will be able to publish the study again, if you want.":[m("p","This will create a link that participants can use to launch the study."),m("p","Publishing locks the study for editing to prevent you from modifying the files while participants take the study. To make changes to the study, you will be able to unpublish it later."),m("p","Although it is strongly not recommended, you can also unlock the study after it is published by using Unlock Study in the Study menu."),m("p","After you publish the study, you can obtain the new launch URL by right clicking on the experiment file and choosing Experiment options->Copy Launch URL"),m(".input-group",[m("select.c-select.form-control",{onchange:function(e){return n(e.target.value)}},[m("option",{value:"update",selected:!0},"Update the launch URL"),m("option",{value:"keep"},"Keep the launch URL"),a.versions.length<2?"":m("option",{value:"reuse"},"Use the launch URL from the previous published version")])])]),t()?m("p.alert.alert-danger",t()):""])}).then(function(e){return e&&o()})},o=function(){return vn(a.id,!a.is_published,n).then(function(e){return a.versions.push(e)}).then(a.is_published=!a.is_published).then(a.is_locked=a.is_published||a.is_locked).then(a.isReadonly=a.is_locked).then(i).catch(function(e){t(e.message),r()}).then(m.redraw)};r()}},co=function(e){return!e.isReadonly&&"read only"!==e.permission},mo=function(e){return e.is_locked},fo=function(e){return e.is_published},po=function(e){return e.is_public},ho=function(t){return function(e){return!t(e)}},yo={tags:[],data:[],delete:[],rename:[],description:[],duplicate:[],publish:[],unpublish:[],lock:[],unlock:[],sharing:[],public:[],private:[],copyUrl:[]},go={tags:{text:"Tags",config:{display:[co],onmousedown:function(a){return function(e){e.preventDefault();var t,r=a.id,o=m.prop([]);Ne.confirm({header:"Tags",content:(t={tags:o,study_id:r},m.component(Zr,t))}).then(function(e){if(e){var t=o().filter(function(e){return e.used});return a.tags=t,o(o().filter(function(e){return e.changed}).map(function(e){return{text:e.text,id:e.id,used:e.used}})),n=o,V(Vr(r),{method:"put",body:{tags:n}})}var n}).then(m.redraw)}},class:"fa-tags"}},data:{text:"Data",config:{display:[co],onmousedown:function(u){return function(e){e.preventDefault();var t,n=u.id,r=u.versions,o=m.prop([]),a=m.prop([]),i=m.prop(),s=Ne.close;Ne.custom({header:"Data download",content:(t={tags:a,exps:o,dates:i,study_id:n,versions:r,close:s},m.component(Kr,t))}).then(m.redraw)}},class:"fa-download"}},delete:{text:"Delete Study",config:{display:[co,ho(mo)],onmousedown:function(n){return function(e){return e.preventDefault(),Ne.confirm({header:"Delete study",content:"Are you sure?"}).then(function(e){var t;e&&(t=n.id,V(dn(t),{method:"delete"})).then(function(){return n.deleted=!0}).catch(function(e){return Ne.alert({header:"Delete study",content:m("p.alert.alert-danger",e.message)})}).then(m.redraw).then(m.route("./"))})}},class:"fa-remove"}},rename:{text:"Rename Study",config:{display:[co,ho(mo)],onmousedown:function(a){return function(e){e.preventDefault();var n=m.prop(a.name),r=m.prop(""),o=function(){return Ne.confirm({header:"New Name",content:{view:function(){return m("div",[m("input.form-control",{placeholder:"Enter Study Name",value:n(),onchange:m.withAttr("value",n)}),r()?m("p.alert.alert-danger",r()):""])}}}).then(function(e){return e&&t()})},t=function(){return(e=a.id,t=n,V(dn(e)+"/rename",{method:"put",body:{study_name:t}})).then(function(){return a.name=n()}).then(m.redraw).catch(function(e){r(e.message),o()}).then(m.redraw);var e,t};o()}},class:"fa-exchange"}},description:{text:"Change description",config:{display:[co,ho(mo)],onmousedown:function(a){return function(e){e.preventDefault();var n=m.prop(a.description?a.description:""),r=m.prop(),o=function(){return Ne.confirm({header:"Study Description",content:{view:function(){return m("div",[m("textarea.form-control",{placeholder:"Enter description",value:n(),onchange:m.withAttr("value",n)}),r()?m("p.alert.alert-danger",r()):""])}}}).then(function(e){return e&&t()})},t=function(){return(e=a.id,t={description:n()},V(dn(e),{method:"put",body:t})).then(function(){return a.description=n()}).catch(function(e){r(e.message),o()}).then(m.redraw);var e,t};o()}},class:"fa-comment"}},duplicate:{text:"Duplicate study",config:{onmousedown:function(a,i){return function(e){e.preventDefault();var t=m.prop(a.name),n=m.prop(""),r=function(){return Ne.confirm({header:"New Name",content:m("div",[m("input.form-control",{placeholder:"Enter Study Name",onchange:m.withAttr("value",t)}),n()?m("p.alert.alert-danger",n()):""])}).then(function(e){return e&&o()})},o=function(){return yn(a.id,t).then(function(e){return m.route((a.type,"/editor/"+e.study_id))}).then(i).then(m.redraw).catch(function(e){n(e.message),r()})};r()}},class:"fa-clone"}},lock:{text:"Lock Study",config:{display:[co,ho(mo)],onmousedown:uo,class:"fa-lock"}},publish:{text:"Publish Study",config:{display:[co,ho(mo),ho(fo)],onmousedown:lo,class:"fa-cloud-upload"}},unpublish:{text:"Unpublish Study",config:{display:[co,fo],onmousedown:lo,class:"fa-cloud-upload"}},republish:{text:"Republish Study",config:{display:[co,ho(fo)],onmousedown:lo,class:"fa-cloud-upload"}},public:{text:"Make public",config:{display:[co,ho(mo),ho(po)],onmousedown:so,class:"fa-globe"}},private:{text:"Make private",config:{display:[co,ho(mo),po],onmousedown:so,class:"fa-globe"}},unlock:{text:"Unlock Study",config:{display:[co,mo],onmousedown:uo,class:"fa-unlock"}},deploy:{text:"Request Deploy",config:{display:[co,ho(mo)],href:"/deploy/"}},studyChangeRequest:{text:"Request Change",config:{display:[co,ho(mo)],href:"/studyChangeRequest/"}},studyRemoval:{text:"Request Removal",config:{display:[co,ho(mo)],href:"/studyRemoval/"}},sharing:{text:"Sharing",config:{display:[co],href:"/sharing/",class:"fa-user-plus"}},copyUrl:{text:"Copy Base URL",config:{onmousedown:function(e){return Gn(e.base_url)},class:"fa-link"}}},vo=function(o){return Object.keys(yo).map(function(e){var t,n,r=go[e].config;return n=o,(t=r).display&&!t.display.every(function(e){return e(n)})?"":r.href?m("a.dropdown-item",{href:r.href+o.id,config:m.route},[m("i.fa.fa-fw."+r.class),go[e].text]):m("a.dropdown-item.dropdown-onclick",{onmousedown:r.onmousedown(o)},[m("i.fa.fa-fw."+r.class),go[e].text])})};var bo=function(e){var t,n=e.study,r=n.isReadonly;return m(".sidebar-buttons.btn-toolbar",[m(".btn-group.btn-group-sm",[Nr({toggleSelector:"a.btn.btn-secondary.btn-sm.dropdown-menu-right",toggleContent:m("i.fa.fa-bars"),elements:[vo(n)]})]),m(".btn-group.btn-group-sm",[m("a.btn.btn-secondary.btn-sm",{class:r?"disabled":"",onclick:r||Cr(null,n),title:"Create new files"},[m("i.fa.fa-plus")]),m("a.btn.btn-secondary.btn-sm",{class:r?"disabled":"",onclick:r||Mn(n),title:"Delete selected files"},[m("i.fa.fa-close")]),m("a.btn.btn-secondary.btn-sm",{onclick:(t=n,function(){var e=t.getChosenFiles().map(function(e){return e.path});e.length?t.downloadFiles(e).then(function(e){return un(e,t.name)}).catch(function(e){return Ne.alert({header:"Failed to download files:",content:e.message})}):Ne.alert({header:"Download Files",content:"There are no files selected"})}),title:"Download selected files"},[m("i.fa.fa-download")]),m("label.btn.btn-secondary.btn-sm",{class:r?"disabled":"",title:"Drag files over the file list in order to upload easily"},[m("i.fa.fa-upload"),r?"":m('input[type="file"]',{style:"display:none",multiple:"true",onchange:Mr({onchange:xn("/",n)})})])])])},wo={view:function(e,t){var n,r,o,a,i,s,u,l,c,d,f,p=t.study;return m(".sidebar",{config:_o},[bo({study:p}),(n={study:p},l=n.study,c=jr(l.files()),d=Rr({onchange:xn("/",l)}),o=(r=l).vm,a=r.files().length,f=(i=r.files().reduce(function(e,t){return o(t.id).isChosen()?e+1:e},0))?a===i?1:-1:0,m(".sidebar-files",{config:d},[m("h5",[m("small",[m("i.fa.fa-fw",{onclick:(s=f,u=l,function(){return u.files().forEach(function(e){return u.vm(e.id).isChosen(1===s?0:1)})}),class:We({"fa-check-square-o":1===f,"fa-square-o":0===f,"fa-minus-square-o":-1===f})})]),m("a.no-decoration",{href:"/editor/"+l.id,config:m.route},l.name)]),l.isUploading?m("div",[m(".loader"),m(".text-sm-center",[m("strong","UPLOADING...")])]):Yr({path:"/",folderHash:c,study:l})]))])}};function _o(e,t,n){t||e.addEventListener("scroll",function(){n.scrollTop=e.scrollTop},!1),e.scrollTop=n.scrollTop||0}var ko,xo=function(e){return m.component(Do,e)},Do={controller:function(e){var t=e.leftWidth;return{parentWidth:m.prop(),parentOffset:m.prop(),leftWidth:t||m.prop("auto")}},view:function(e,t){var n=e.parentWidth,r=e.parentOffset,o=e.leftWidth,a=t.left;void 0===a&&(a="");var i=t.right;return void 0===i&&(i=""),m(".split-pane",{config:So(n,r,o)},[m(".split-pane-col-left",{style:{flexBasis:o()+"px"}},a),m(".split-pane-divider",{onmousedown:Ao(r,o)}),m(".split-pane-col-right",i)])}},So=function(o,a,i){return function(e,t,n){function r(){o(e.offsetWidth),a(e.getBoundingClientRect().left)}t||(r(),void 0===i()&&i(o()/6)),document.addEventListener("resize",r),n.onunload=function(){return document.removeEventListener("resize",r)}}},Ao=function(t,n){return function(){function e(e){n(e.pageX-t()),m.redraw()}document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",e)}),document.addEventListener("mousemove",e)}},To={controller:function(){var e,t,n=m.route.param("studyId");ko&&ko.id===n||(e=n,t=Object.create(nn),Object.assign(t,{id:e,files:m.prop([]),loaded:!1,error:!1,vm:rn({isOpen:m.prop(!1),isChanged:m.prop(!1),isChosen:m.prop(0)})}),(ko=t).get().catch(function(e){return ko.err=e.message}).then(m.redraw));var r={study:ko,onunload:function(e){var t=!/^\/editor\//.test(m.route());t&&o()&&!window.confirm("You have unsaved data are you sure you want to leave?")?e.preventDefault():window.removeEventListener("beforeunload",a);t&&(ko=null)}};return window.addEventListener("beforeunload",a),r;function o(){return ko.files().some(function(e){return e.content()!==e.sourceContent()})}function a(e){if(o())return e.returnValue="You have unsaved data are you sure you want to leave?"}},view:function(e){var t=e.study;return m(".study",{config:Jt},[t.err?m(".alert.alert-danger",m("strong","Error: "),t.err):t.loaded?xo({leftWidth:Co,left:m.component(wo,{study:t}),right:"wizard"===m.route.param("resource")?m.component(Sr,{study:t}):m.component(Dr,{study:t})}):""])}};function Co(e){return arguments.length&&(localStorage.fileSidebarWidth=e),localStorage.fileSidebarWidth}var Eo,Ro={apiURL:function(e){return void 0===e&&(e=""),"../view_files/"+encodeURIComponent(this.code)+e},get:function(){var r=this;return function(e,t){void 0===t&&(t={});var n=Object.assign({credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json"}},t);return n.body=JSON.stringify(t.body),fetch(e,n).then(q).then(H).catch()}(this.apiURL()).then(function(e){r.loaded=!0,r.id=e.id,r.isReadonly=e.is_readonly,r.istemplate=e.is_template,r.is_locked=e.is_locked,r.name=e.study_name,r.baseUrl=e.base_url;var t,n=o(e.files).map((t=r.id,function(e){return Object.assign(e,{studyId:t})})).map(function(e){return Object.assign(e,{viewStudy:!0})}).map(tn);r.files(n),r.sort()}).catch(function(e){throw r.error=!0,e});function o(e){return e?e.map(t).reduce(function(e,t){return e.concat(t)},[]):[]}function t(e){return[e].concat(o(e.files))}},getFile:function(t){return this.files().find(function(e){return e.id===t})},getChosenFiles:function(){var r=this.vm;return function n(e){return e.reduce(function(e,t){return 1===r(t.id).isChosen()?e.push(t):e=e.concat(n(t.files||[])),e},[])}(this.files().filter(function(e){return"/"===e.basePath}))},addFile:function(e){this.files().push(e);var t=this.getParents(e).reduce(function(e,t){return e&&e.path.length>t.path.length?e:t},null);t&&(t.files||(t.files=[]),t.files.push(e))},createFile:function(e){var n=this,r=e.name,o=e.content;void 0===o&&(o="");var a=e.isDir;if(/[^\/-_.A-Za-z0-9]/.test(r))return Promise.reject({message:'The file name "'+r+'" is not valid'});if(this.files().some(function(e){return e.path===r}))return Promise.reject({message:'The file "'+r+'" already exists'});var t=r.substring(0,r.lastIndexOf("/")).replace(/^\//,"");return""===t||this.files().some(function(e){return e.isDir&&e.path===t})?V(this.apiURL("/file"),{method:"post",body:{name:r,content:o,isDir:a}}).then(function(e){Object.assign(e,{studyId:n.id,content:o,path:r,isDir:a});var t=tn(e);return t.loaded=!0,n.addFile(t),e}).then(this.sort.bind(this)):Promise.reject({message:'The directory "'+t+'" does not exist'})},sort:function(e){var t=this.files().sort(n);return this.files(t),e;function n(e,t){var n=+!e.isDir+e.name.toLowerCase(),r=+!t.isDir+t.name.toLowerCase();return n<r?-1:r<n?1:0}},downloadFiles:function(e){return V(this.apiURL(),{method:"post",body:{files:e}}).then(function(e){return"../download?path="+e.zip_file+"&study=_PATH"})},getParents:function(t){return this.files().filter(function(e){return e.isDir&&0===t.basePath.indexOf(e.path)})},getChildren:function(e){return function e(t){if(!t.files)return[t];return t.files.map(e).reduce(function(e,t){return e.concat(t)},[t])}(e)}},Mo=function(n){var r={};return function(e){if(!r[e])for(var t in r[e]={},n)r[e][t]=m.prop(n[t]());return r[e]}},Oo={controller:function(){var e,t,n=m.route.param("code");return Eo&&Eo.code===n||(e=n,t=Object.create(Ro),Object.assign(t,{code:e,id:"",view:!0,files:m.prop([]),loaded:!1,error:!1,vm:Mo({isOpen:m.prop(!1),isChanged:m.prop(!1),isChosen:m.prop(0)})}),(Eo=t).get().catch(function(e){403==e.status&&m.route("/")}).then(m.redraw)),{study:Eo,onunload:onunload}},view:function(e){var t=e.study;return m(".study",{config:Jt},[t.loaded?xo({leftWidth:Io,left:m.component(wo,{study:t}),right:"wizard"===m.route.param("resource")?m.component(Sr,{study:t}):m.component(Dr,{study:t})}):""])}};function Io(e){return arguments.length&&(localStorage.fileSidebarWidth=e),localStorage.fileSidebarWidth}var Po={controller:function(){var n={studies:m.prop([]),have_templates:m.prop(!1),tags:m.prop([]),user_name:m.prop(""),globalSearch:m.prop(""),permissionChoice:m.prop("all"),loaded:!1,order_by_name:!0,loadStudies:e,loadTags:t,type:m.prop(""),sort_studies_by_name:a,sort_studies_by_date:function(){n.studies(n.studies().sort(o))}};function e(){n.type("/studies"==m.route()?"regular":"template"),fn().then(function(e){return e.studies}).then(n.studies).then(function(){return n.loaded=!0}).then(a).then(m.redraw)}function t(){Gr().then(function(e){return e.tags}).then(n.tags).then(m.redraw)}return t(),e(),n;function r(e,t){return n.order_by_name=!0,e.name.toLowerCase()===t.name.toLowerCase()?0:e.name.toLowerCase()>t.name.toLowerCase()?1:-1}function o(e,t){return n.order_by_name=!1,e.last_modified===t.last_modified?0:e.last_modified<t.last_modified?1:-1}function a(){n.studies(n.studies().sort(r))}},view:function(e){var t=e.loaded,n=e.studies,r=e.tags,o=e.permissionChoice,a=e.globalSearch,i=e.sort_studies_by_date,s=e.sort_studies_by_name,u=e.order_by_name,l=e.type;return t?m(".container.studies",[m(".row.p-t-1",[m(".col-sm-4",[m("h3",["My ","regular"==l()?"Studies":"Template Studies"])]),m(".col-sm-8",[m("button.btn.btn-success.btn-sm.pull-right",{onclick:function(){io(l(),n().filter(Uo(l())))}},[m("i.fa.fa-plus"),"  Add new study"]),m(".pull-right.m-r-1",[Nr({toggleSelector:"button.btn.btn-sm.btn-secondary.dropdown-toggle",toggleContent:[m("i.fa.fa-tags")," Tags"],elements:[m("h6.dropdown-header","Filter by tags"),r().length?r().map(function(e){return m("a.dropdown-item",m("label.custom-control.custom-checkbox",[m("input.custom-control-input",{type:"checkbox",checked:e.used,onclick:function(){e.used=!e.used}}),m("span.custom-control-indicator"),m("span.custom-control-description.m-r-1.study-tag",{style:{"background-color":"#"+e.color}},e.text)]))}):m("em.dropdown-header","You do not have any tags yet"),m(".dropdown-divider"),m("a.dropdown-item",{href:"/tags",config:m.route},"Manage tags")]})]),m(".input-group.pull-right.m-r-1",[m("select.c-select.form-control",{onchange:function(e){return o(e.target.value)}},[m("option",{value:"all"},"Show all my studies"),m("option",{value:"owner"},"Show only studies I created"),m("option",{value:"collaboration"},"Show only studies shared with me"),m("option",{value:"public"},"Show public studies"),m("option",{value:"bank"},"Show study bank studies")])])])]),m(".card.studies-card",[m(".card-block",[m(".row",{key:"@@notid@@"},[m(".col-sm-5",[m(".form-control-static",{onclick:s,style:"cursor:pointer"},[m("strong","Study Name "),m("i.fa.fa-sort",{style:{color:u?"black":"grey"}})])]),m(".col-sm-3",[m(".form-control-static",{onclick:i,style:"cursor:pointer"},[m("strong"," Last Changed "),m("i.fa.fa-sort",{style:{color:u?"grey":"black"}})])]),m(".col-sm-4",[m("input.form-control",{placeholder:"Search ...",value:a(),oninput:m.withAttr("value",a)})])]),n().filter(function(e){return"deleted"!==e.permission}).filter(Uo(l())).filter(Lo(r().filter(jo()).map(function(e){return e.text}))).filter(Yo(o())).filter(No(a())).filter(function(e){return!e.deleted}).map(function(e){return m("a",{href:"/studies"!=m.route()?"/translate/"+e.id:"/editor/"+e.id,config:Fo,key:e.id},[m(".row.study-row",[m(".col-sm-5",[m(".study-text",[m("i.fa.fa-fw.owner-icon",{class:We({"fa-lock":e.is_locked,"fa-globe":e.is_public,"fa-flag":e.is_template,"fa-university":e.is_bank,"fa-users":!e.is_public&&"owner"!==e.permission}),title:e.is_public?e.is_bank?"Bank":"Public":"owner"===e.permission?"":"Collaboration"}),m("strong",e.name)]),e.description?m(".study-description",[e.description,m(".study-tip",e.description)]):""]),m(".col-sm-3",[m(".study-text",ke(new Date(e.last_modified)))]),m(".col-sm-3",[e.tags.map(function(e){return m("span.study-tag",{style:{"background-color":"#"+e.color}},e.text)})]),m(".col-sm-1",[m(".btn-toolbar.pull-right",m(".btn-group.btn-group-sm",Nr({toggleSelector:"a.btn.btn-secondary.btn-sm.dropdown-toggle",toggleContent:"Actions",elements:[vo(e)]})))])])])})])])]):m(".loader")}},Uo=function(t){return function(e){return e.study_type===t}},Yo=function(t){return function(e){return"all"===t?!(e.is_public&&"owner"!==e.permission):"public"===t?e.is_public&&!e.is_bank:"collaboration"===t?"owner"!==e.permission&&!e.is_public:"template"===t?e.is_template:"bank"===t?e.is_bank:e.permission===t}},Lo=function(t){return function(e){return 0==t.length||e.tags.map(function(e){return e.text}).some(function(e){return-1!=t.indexOf(e)})}},jo=function(){return function(e){return e.used}},No=function(t){return function(e){return!e.name||e.name.match(new RegExp(t,"i"))||e.description&&e.description.match(new RegExp(t,"i"))}};function Fo(e,t,n,r){e.href=location.pathname+"?"+r.attrs.href,t||e.addEventListener("click",function(e){var t=e.currentTarget;if(e.ctrlKey||e.metaKey||e.shiftKey||2===e.which)return;if(e.defaultPrevented)return;if(e.preventDefault(),"A"===e.target.tagName&&e.target!==t)return;m.route(t.search.slice(1))})}var qo=function(e,t){return{"data-sort-by":e,class:t()===e?"active":""}},Ho={controller:function(){var t={list:m.prop(""),sortBy:m.prop("CREATION_DATE")};return V("../deploy_list").then(function(e){t.list(e.requests)}).catch(function(e){throw e}).then(m.redraw),{ctrl:t}},view:function(e){var t=e.ctrl,n=t.list;return 0===t.list().length?m(".loader"):m("table",{class:"table table-nowrap table-striped table-hover",onclick:_e(n,t.sortBy)},[m("thead",[m("tr",[m("th",qo("CREATION_DATE",t.sortBy),"Creation date"),m("th",qo("FOLDER_LOCATION",t.sortBy),"Folder location"),m("th",qo("RULE_FILE",t.sortBy),"Rule file"),m("th",qo("RESEARCHER_EMAIL",t.sortBy),"Researcher email"),m("th",qo("RESEARCHER_NAME",t.sortBy),"Researcher name"),m("th",qo("TARGET_NUMBER",t.sortBy),"Target number"),m("th",qo("APPROVED_BY_A_REVIEWER",t.sortBy),"Approved by a reviewer"),m("th",qo("EXPERIMENT_FILE",t.sortBy),"Experiment file"),m("th",qo("LAUNCH_CONFIRMATION",t.sortBy),"Launch confirmation"),m("th",qo("COMMENTS",t.sortBy),"Comments")])]),m("tbody",[t.list().map(function(e){return m("tr",[m("td",e.CREATION_DATE),m("td",m("a",{href:e.FOLDER_LOCATION},e.FOLDER_LOCATION)),m("td",e.RULE_FILE),m("td",m("a",{href:"mailto:"+e.RESEARCHER_EMAIL},e.RESEARCHER_EMAIL)),m("td",e.RESEARCHER_NAME),m("td",e.TARGET_NUMBER),m("td",e.APPROVED_BY_A_REVIEWER),m("td",e.EXPERIMENT_FILE),m("td",e.LAUNCH_CONFIRMATION),m("td",e.COMMENTS)])})])])}};var Wo=function(e,t){return{"data-sort-by":e,class:t()===e?"active":""}},Bo={controller:function(){var t={list:m.prop(""),sortBy:m.prop("CREATION_DATE")};return V("../change_request_list").then(function(e){t.list(e.requests)}).catch(function(e){throw e}).then(m.redraw),{ctrl:t}},view:function(e){var t=e.ctrl,n=t.list;return 0===t.list().length?m(".loader"):m("table",{class:"table table-nowrap table-striped table-hover",onclick:_e(n,t.sortBy)},[m("thead",[m("tr",[m("th",Wo("CREATION_DATE",t.sortBy),"Creation date"),m("th",Wo("RESEARCHER_EMAIL",t.sortBy),"Researcher email"),m("th",Wo("RESEARCHER_NAME",t.sortBy),"Researcher name"),m("th",Wo("FILE_NAMES",t.sortBy),"File names"),m("th",Wo("TARGET_SESSIONS",t.sortBy),"Target sessions"),m("th",Wo("STUDY_SHOWFILES_LINK",t.sortBy),"Study showfiles link"),m("th",Wo("STATUS",t.sortBy),"Status"),m("th",Wo("COMMENTS",t.sortBy),"Comments")])]),m("tbody",[t.list().map(function(e){return m("tr",[m("td",e.CREATION_DATE),m("td",m("a",{href:"mailto:"+e.RESEARCHER_EMAIL},e.RESEARCHER_EMAIL)),m("td",e.RESEARCHER_NAME),m("td",e.FILE_NAMES),m("td",e.TARGET_SESSIONS),m("td",m("a",{href:e.STUDY_SHOWFILES_LINK},e.STUDY_SHOWFILES_LINK)),m("td",e.STATUS),m("td",e.COMMENTS)])})])])}};var Vo=function(e,t){return{"data-sort-by":e,class:t()===e?"active":""}},Go={controller:function(){var t={list:m.prop(""),sortBy:m.prop("CREATION_DATE")};return V("../removal_list").then(function(e){t.list(e.requests)}).catch(function(e){throw e}).then(m.redraw),{ctrl:t}},view:function(e){var t=e.ctrl,n=t.list;return 0===t.list().length?m(".loader"):m("table",{class:"table table-nowrap table-striped table-hover",onclick:_e(n,t.sortBy)},[m("thead",[m("tr",[m("th",Vo("CREATION_DATE",t.sortBy),"Creation date"),m("th",Vo("RESEARCHER_EMAIL",t.sortBy),"Researcher email"),m("th",Vo("RESEARCHER_NAME",t.sortBy),"Researcher name"),m("th",Vo("STUDY_NAME",t.sortBy),"Study name"),m("th",Vo("COMPLETED_N",t.sortBy),"Completed n"),m("th",Vo("COMMENTS",t.sortBy),"Comments")])]),m("tbody",[t.list().map(function(e){return m("tr",[m("td",e.CREATION_DATE),m("td",m("a",{href:"mailto:"+e.RESEARCHER_EMAIL},e.RESEARCHER_EMAIL)),m("td",e.RESEARCHER_NAME),m("td",e.STUDY_NAME),m("td",e.COMPLETED_N),m("td",e.COMMENTS)])})])])}};function zo(e){return G+"/"+encodeURIComponent(e)+"/deploy"}var $o=function(e){return V(zo(e),{method:"get"})};var Zo={controller:function(e){var t=e.visual,n=e.value,r=e.comments,o=e.exist_rule_file;return{visual:t,value:n,edit:function(){window.open("../ruletable.html")},remove:function(){t("None"),n("parent")},addcomments:function(){Ne.prompt({prop:r,header:"Edit rule comments"})},exist_rule_file:o}},view:function(e){var t=e.visual,n=e.value,r=e.edit,o=e.remove,a=e.exist_rule_file;return m("div",[a()?m(".small.text-muted",['You already have a rule file by the name of "',a(),'", it will be overwritten if you create a new one.']):"",m(".btn-group",[m(".btn.btn-secondary.btn-sm",{onclick:r},[m("i.fa.fa-edit")," Rule editor"]),m(".btn.btn-secondary.btn-sm",{onclick:o},[m("i.fa.fa-remove")," Clear rules"])]),m("#ruleGenerator.card",{config:Jo(t,n)},[m(".card-block",t())])])}},Jo=function(n,r){return function(e,t){if(t)return!0;e.ruleGeneratorVisual=n,e.ruleGeneratorValue=r}},Ko=m("span.text-danger","*"),Qo={controller:function(){var n=m.route.param("studyId"),r=ce(),o={sent:!1,error:m.prop(""),folder_location:m.prop(""),researcher_email:m.prop(""),researcher_name:m.prop(""),target_number:m.prop(""),rulesValue:m.prop("parent"),rulesVisual:m.prop("None"),rulesComments:m.prop(""),rule_file:m.prop(""),exist_rule_file:m.prop(""),approved_by_a_reviewer:m.prop(""),zero_unnecessary_files:m.prop(""),completed_checklist:m.prop(""),approved_by_irb:m.prop(""),valid_study_name:m.prop(""),realstart:m.prop(""),experiment_file:m.prop(""),experiment_files:m.prop(""),launch_confirmation:m.prop(""),comments:m.prop("")};return $o(n).then(function(e){o.exist_rule_file(e.have_rule_file?e.study_name+".rules.xml":""),o.study_name=e.study_name,o.researcher_name(e.researcher_name),o.researcher_email(e.researcher_email),o.folder_location(e.folder),o.experiment_files(e.experiment_file.reduce(function(e,t){return e[t.file_name]=t.file_name,e},{}))}).catch(function(e){o.error(e.message)}).then(m.redraw),{ctrl:o,form:r,submit:function(){if(r.showValidation(!0),!r.isValid())return void o.error("Missing parameters");(e=n,t=o,V(zo(e),{method:"post",body:{target_number:t.target_number,approved_by_a_reviewer:t.approved_by_a_reviewer,experiment_file:t.experiment_file,launch_confirmation:t.launch_confirmation,comments:t.comments,rulesValue:t.rulesValue}})).then(function(e){o.rule_file(e.rule_file),o.sent=!0}).catch(function(e){o.error(e.message)}).then(m.redraw);var e,t},studyId:n}},view:function(e){var t,n=e.form,r=e.ctrl,o=e.submit;return r.sent?m(".deploy.centrify",[m("i.fa.fa-thumbs-up.fa-5x.m-b-1"),m("h5",["The Deploy form was sent successfully ",m("a",{href:"/deployList",config:m.route},"View Deploy Requests")]),""!=r.rule_file()?m("h5",["Rule File: ",m("a",{href:"/editor/"+m.route.param("studyId")+"/file/"+r.rule_file()+".xml",config:m.route},r.rule_file())]):""]):m(".deploy.container",[m("h3",["Request Deploy ",m("small",r.study_name)]),m(".row",[m(".col-sm-3",m("strong","Researcher Name: ")),m(".col-sm-9",r.researcher_name())]),m(".row",[m(".col-sm-3",m("strong","Researcher Email Address: ")),m(".col-sm-9",r.researcher_email())]),m(".row.m-b-1",[m(".col-sm-3",m("strong","Study Folder Location: ")),m(".col-sm-9",r.folder_location())]),he({label:m("span",["Name of Experiment File",Ko]),prop:r.experiment_file,values:r.experiment_files(),form:n,required:!0,isStack:!0}),de({help:"For private studies (not in the Project Implicit research pool), enter n/a",label:["Target Number of Completed Study Sessions",Ko],placeholder:"Target Number of Completed Study Sessions",prop:r.target_number,form:n,required:!0,isStack:!0}),m(".font-weight-bold","Participant Restrictions"),(t={value:r.rulesValue,visual:r.rulesVisual,comments:r.rulesComments,exist_rule_file:r.exist_rule_file},m.component(Zo,t)),m(".font-weight-bold","Study is ready for deploy: ",Ko),m(".m-b-1",[Xo({description:"The study's study-id starts with my user name",prop:r.valid_study_name,form:n,required:!0,isStack:!0}),Xo({description:"This study has been approved by the appropriate IRB ",prop:r.approved_by_irb,required:!0,form:n,isStack:!0}),Xo({description:["The study is compliant with ",m("a",{hxref:"https://docs.google.com/document/d/1pglAQELqNLWbV1yscE2IVd7G5xVgZ8b4lkT8PYeumu8/edit?usp=sharing",target:"_blank"},"PI Research Pool Guidelines and Required Elements & Study Conventions")," ."],prop:r.completed_checklist,form:n,isStack:!0,required:!0}),Xo({description:"My study folder includes ZERO files that aren't necessary for the study (e.g., word documents, older versions of files, items that were dropped from the final version)",prop:r.zero_unnecessary_files,required:!0,form:n,isStack:!0}),Xo({description:"I used a realstart and lastpage tasks",prop:r.realstart,form:n,required:!0,isStack:!0})]),he({label:["Study has been approved by a *User Experience* Reviewer (Calvin Lai): ",Ko],prop:r.approved_by_a_reviewer,values:{"No, this study is not for the Project Implicit pool.":"No, this study is not for the Project Implicit pool.",Yes:"Yes"},form:n,required:!0,isStack:!0}),he({label:["If you are building this study for another researcher (e.g. a contract study), has the researcher received the standard final launch confirmation email and confirmed that the study is ready to be launched? ",Ko],prop:r.launch_confirmation,values:{"No,this study is mine":"No,this study is mine",Yes:"Yes"},form:n,required:!0,isStack:!0}),de({isArea:!0,label:m("span","Additional comments"),placeholder:"Additional comments",prop:r.comments,form:n,isStack:!0}),r.error()?m(".alert.alert-warning",m("strong","Error: "),r.error()):"",m("button.btn.btn-primary",{onclick:o},"Request Deploy")])}},Xo=function(e){return m.component({controller:function(e){var t=e.prop,n=e.form,r=e.required,o=function(){return!r||t()};if(!n)throw new Error("Form not defined");return n.register(o),{validity:o,showValidation:n.showValidation}},view:function(e,t){var n=t.prop,r=t.description;void 0===r&&(r="");var o=t.help,a=t.required,i=t.form;return m(".checkmarked",{onclick:function(){return n(!n())}},[m("i.fa.fa-fw",{class:We({"fa-square-o":!n(),"fa-check-square-o":n(),"text-success":a&&i.showValidation()&&n(),"text-danger":a&&i.showValidation()&&!n()})}),m.trust("&nbsp;"),r,o?m("small.text-muted",o):""])}},e)},ea=m("span.text-danger","*"),ta={controller:function(){var n=m.route.param("studyId"),r=ce(),o={sent:!1,researcher_name:m.prop(""),researcher_email:m.prop(""),global_study_name:m.prop(""),study_name:m.prop(""),study_names:m.prop(""),completed_n:m.prop(""),comments:m.prop(""),error:m.prop("")};return $o(n).then(function(e){o.researcher_name(e.researcher_name),o.researcher_email(e.researcher_email),o.global_study_name(e.study_name),o.study_names(e.experiment_file.reduce(function(e,t){return e[t.file_id]=t.file_id,e},{}))}).catch(function(e){o.error(e.message)}).then(m.redraw),{ctrl:o,form:r,submit:function(){var e,t;r.showValidation(!0),r.isValid()?(e=n,t=o,V(zo(e),{method:"delete",body:{study_name:t.study_name,completed_n:t.completed_n,comments:t.comments}})).then(function(){o.sent=!0}).catch(function(e){o.error(e.message)}).then(m.redraw):o.error("Missing parameters")}}},view:function(e){var t=e.form,n=e.ctrl,r=e.submit;return n.sent?m(".deploy.centrify",[m("i.fa.fa-thumbs-up.fa-5x.m-b-1"),m("h5",["The removal form was sent successfully ",m("a",{href:"/removalList",config:m.route},"View removal requests")])]):m(".StudyRemoval.container",[m("h3",["Study Removal Request ",m("small",n.global_study_name())]),m(".row",[m(".col-sm-3",m("strong","Researcher Name: ")),m(".col-sm-9",n.researcher_name())]),m(".row.m-b-1",[m(".col-sm-3",m("strong","Researcher Email Address: ")),m(".col-sm-9",n.researcher_email())]),he({label:m("span",["Study name",ea]),prop:n.study_name,values:n.study_names(),help:"This is the name you submitted to the RDE (e.g., colinsmith.elmcogload) ",form:t,required:!0,isStack:!0}),de({label:m("span",["Please enter your completed n below ",m("span.text-danger"," *")]),help:m("span",["you can use the following link: ",m("a",{href:"https://app-prod-03.implicit.harvard.edu/implicit/research/pitracker/PITracking.html#3"},"https://app-prod-03.implicit.harvard.edu/implicit/research/pitracker/PITracking.html#3")]),placeholder:"completed n",prop:n.completed_n,form:t,required:!0,isStack:!0}),de({isArea:!0,label:m("span","Additional comments"),help:"(e.g., anything unusual about the data collection, consistent participant comments, etc.)",placeholder:"Additional comments",prop:n.comments,form:t,isStack:!0}),n.error()?m(".alert.alert-warning",m("strong","Error: "),n.error()):"",m("button.btn.btn-primary",{onclick:r},"Submit")])}},na=m("span.text-danger","*"),ra={controller:function(){var a=m.prop(""),i=m.prop(""),s=m.prop(""),u=m.prop(""),l=m.prop(!1),c={username:a,first_name:i,last_name:s,email:u,iscu:l,error:m.prop(""),added:!1,activation_code:m.prop(""),add:function(){(e=a,t=i,n=s,r=u,o=l,V("../users/add_user",{method:"post",body:{username:e,first_name:t,last_name:n,email:r,iscu:o}})).then(function(e){c.added=!0,c.activation_code(e.activation_code),m.redraw()}).catch(function(e){c.error(e.message),m.redraw()});var e,t,n,r,o}};return c},view:function(e){return m(".add.centrify",[e.added?e.activation_code()?[m("h5",[,"Added "+e.username()+" successfully"]),m(".card.card-inverse.col-md-10",[m("label","Send the following link to user to allow them to activate their account and to change their password."),Vn(e.activation_code())()])]:[m("i.fa.fa-thumbs-up.fa-5x.m-b-1"),m("h5",[e.username()," successfully added (email sent)!"])]:m(".card.card-inverse.col-md-10",[m(".card-block",[m("h4","Please fill the following details"),m("form",{onsubmit:e.add},[m("fieldset.form-group",m("label","User name:"),m("input.form-control",{type:"text",placeholder:"User name",value:e.username(),oninput:m.withAttr("value",e.username),onchange:m.withAttr("value",e.username),config:oa(e.username)})),m("fieldset.form-group",m("label","First name:"),m("input.form-control",{type:"text",placeholder:"First name",value:e.first_name(),oninput:m.withAttr("value",e.first_name),onchange:m.withAttr("value",e.first_name),config:oa(e.first_name)})),m("fieldset.form-group",m("label","Last name:"),m("input.form-control",{type:"text",placeholder:"Last name",value:e.last_name(),oninput:m.withAttr("value",e.last_name),onchange:m.withAttr("value",e.last_name),config:oa(e.last_name)})),m("fieldset.form-group",m("label","Email:"),m("input.form-control",{type:"text",placeholder:"Email",value:e.email(),oninput:m.withAttr("value",e.email),onchange:m.withAttr("value",e.email),config:oa(e.email)}))]),e.error()?m(".alert.alert-warning",m("strong","Error: "),e.error()):"",m("button.btn.btn-primary.btn-block",{onclick:e.add},"Add")])])])}};function oa(n){return function(e,t){t||setTimeout(function(){return n(e.value)},30)}}var aa="../change_email",ia="../present_templates",sa="../dropbox";function ua(e){return"../change_password/"+encodeURIComponent(e)}var la=function(e,t,n){return V(ua(e),{method:"post",body:{password:t,confirm:n}})},ca=function(){return V(ia,{method:"post"})},da=function(){return V(ia,{method:"delete"})};var ma=function(e){return m(".card.card-inverse.col-md-4",[m(".card-block",[m("form",[m("label","Password:"),m("input.form-control",{type:"password",placeholder:"Password",value:e.password(),oninput:m.withAttr("value",e.password),onchange:m.withAttr("value",e.password),config:fa(e.password)}),m("label.space","Confirm password:"),m("input.form-control",{type:"password",placeholder:"Confirm password",value:e.confirm(),oninput:m.withAttr("value",e.confirm),onchange:m.withAttr("value",e.confirm),config:fa(e.confirm)})]),e.password_error()?m(".alert.alert-warning",m("strong","Error: "),e.password_error()):"",e.external()?"":m("button.btn.btn-primary.btn-block",{onclick:e.do_set_password},"Update")])])};function fa(n){return function(e,t){t||setTimeout(function(){return n(e.value)},30)}}function pa(t){V(sa,{method:"delete"}).then(m.route("/settings")).catch(function(e){t.synchronization_error(e.message)})}var ha={password:[],emil:[],dropbox:[]},ya={password:ma,emil:function(e){return m(".card.card-inverse.col-md-4",[m(".card-block",[m("form",[m("label","Email Address:"),m("input.form-control",{type:"email",placeholder:"Email Address",value:e.email(),oninput:m.withAttr("value",e.email),onchange:m.withAttr("value",e.email),config:(n=e.email,function(e,t){t||setTimeout(function(){return n(e.value)},30)})})]),e.email_error()?m(".alert.alert-warning",m("strong","Error: "),e.email_error()):"",e.external()?"":m("button.btn.btn-primary.btn-block",{onclick:e.do_set_email},"Update")])]);var n},dropbox:function(n){return void 0===n.is_dbx_synchronized()||"CU"==n.role()?"":m(".card.card-inverse.col-md-4",[m(".card-block",[n.is_dbx_synchronized()?m("button.btn.btn-primary.btn-block",{onclick:function(){pa(n)}},[m("i.fa.fa-fw.fa-dropbox")," Stop Synchronize with your Dropbox account"]):m("button.btn.btn-primary.btn-block",{onclick:function(){var t,e;t=n,e=m.prop(""),Ne.confirm({okText:"Continue",cancelText:"Cancel",header:"Synchronization with Dropbox",content:m("p",[m("p","This feature creates a backup for all your studies by copying all your study files to your Dropbox account. Every time you change a file here, on the Dashboard, it will send that update to your Dropbox account. Using the Dropbox website, you will be able to see previous versions of all the files you changed."),m("ul",[m("li","Dropbox will create a folder under Apps/minno.js/username and will copy all your studies under that folder."),m("li","We will not have access to any of your files on other folders."),m("li",[m("span","This feature is only for backup. If you edit or delete your study files on your computer's file-system, these edits will not be synchronized with the study files on this website. "),m("strong","Updates work only in one direction: from this website to your Dropbox, not from your Dropbox to this website.")]),m("li","If you want to see an older version of any of your study files, you can go to Dropbox and request to see previous versions of the file. If you want to restore an older version of a file, you will need to copy and paste its text to the Dashboard's editor on this website, or to download the old file to your computer and upload it to this website.")]),e()?m("p.alert.alert-danger",e()):""])}).then(function(e){e&&(window.location=t.dbx_auth_link())})}},[m("i.fa.fa-fw.fa-dropbox")," Synchronize with your Dropbox account"])])])}};var ga=function(e){return V(X+"/"+encodeURIComponent(e),{method:"get"})};function va(n){return function(e,t){t||setTimeout(function(){return n(e.value)},30)}}function ba(e){return"../activation/"+encodeURIComponent(e)}var wa=function(e){return V(X+"/"+encodeURIComponent(e),{method:"get"})};var _a=function(e){return m.component(ka,e)},ka={view:function(e,t){var n=t.tag_color,r=t.tag_text,o=t.error;return m("div",[m(".form-group.row",[m(".col-sm-3",[m("label.form-control-label","Tag name")]),m(".col-sm-9",[m("input.form-control",{placeholder:"tag_text",value:r(),oninput:m.withAttr("value",r)})])]),m(".form-group.row",[m(".col-sm-3",[m("label.form-control-label","Preview")]),m(".col-sm-9.form-control-static",[r()?m("span.study-tag",{style:{"background-color":"#"+n()}},r()):m("small.text-muted","No tag name yet")])]),m(".form-group.row",[m(".col-sm-3",[m("label.form-control-label","Color")]),m(".col-sm-9",[m("div",[xa("E7E7E7",n),xa("B6CFF5",n),xa("98D7E4",n),xa("E3D7FF",n),xa("FBD3E0",n),xa("F2B2A8",n),xa("C2C2C2",n),xa("4986E7",n)]),m("div",[xa("2DA2BB",n),xa("B99AFF",n),xa("F691B2",n),xa("FB4C2F",n),xa("FFC8AF",n),xa("FFDEB5",n),xa("FBE9E7",n),xa("FDEDC1",n)]),m("div",[xa("B3EFD3",n),xa("A2DCC1",n),xa("FF7537",n),xa("FFAD46",n),xa("EBDBDE",n),xa("CCA6AC",n),xa("42D692",n),xa("16A765",n)])])]),m("p",{class:o()?"alert alert-danger":""},o())])}};function xa(e,t){return m("button",{style:{"background-color":"#"+e},onclick:t.bind(null,e)}," A ")}function Da(e,t){return Z+"/"+encodeURIComponent(e)+"/"+encodeURIComponent(t)}var Sa=function(e){return V(Z+"/"+encodeURIComponent(e),{method:"get"})};function Aa(t,e){var n=function(){t.style.height="";var e=t.scrollHeight+"px";requestAnimationFrame(function(){t.style.overflow="hidden",t.style.height=e})};e||(t.addEventListener("input",n),requestAnimationFrame(n))}var Ta={controller:function(){var o=m.route.param("templateId"),a=m.route.param("pageId"),i={pages:m.prop(),study_name:m.prop(),strings:m.prop(),loaded:!1,has_changed:m.prop(!1),error:m.prop(""),pageId:a,templateId:o,save:function(){i.has_changed(!1);var e=i.strings().filter(Ia());if(!e.length)return;(t=e,n=o,r=a,V(Da(n,r),{body:{strings:t},method:"put"})).then(function(){return s()});var t,n,r},onunload:function(e){i.has_changed()&&!window.confirm("You have unsaved data are you sure you want to leave?")?e.preventDefault():window.removeEventListener("beforeunload",t)}};function s(){var e,t;Sa(o).then(function(e){i.pages(e.pages),i.study_name(e.study_name),i.loaded=!0}).catch(function(e){i.error(e.message)}).then(m.redraw),a&&(e=o,t=a,V(Da(e,t),{method:"get"})).then(function(e){i.strings(e.strings.map(Ea).map(Ra)),i.loaded=!0}).catch(function(e){i.error(e.message)}).then(m.redraw)}function t(e){i.has_changed()&&(e.returnValue="You have unsaved data are you sure you want to leave?")}return s(),i},view:function(e){var t=e.loaded,n=e.pages,r=e.strings,o=e.save,a=e.templateId,i=e.pageId,s=e.study_name,u=e.has_changed;return m(".study",[t?xo({leftWidth:Ca,left:m("div.translate-page",[m("h5",m("a.no-decoration"," "+s())),m(".files",[m("ul",n().map(function(e){return m("li.file-node",{onclick:Pa(a,e)},[m("a.wholerow",{unselectable:"on",class:We({current:e.pageName===i})},m.trust("&nbsp;")),m("a",{class:We({"text-primary":/\.expt\.xml$/.test(e.pageName)})},[m("i.fa.fa-fw.fa-file-o.fa-files-o",{}),m("span"," "+e.pageName)])])}))])]),right:r()?[m(".study",m(".editor",m(".btn-toolbar.editor-menu",[m(".file-name",{class:u()?"text-danger":""},m("span",{class:u()?"":"invisible"},"*"),i),m(".btn-group.btn-group-sm.pull-xs-right",[m("a.btn.btn-secondary",{title:"Save",onclick:o,class:We({"btn-danger-outline":u(),disabled:!u()})},[m("strong.fa.fa-save")])])]))),m("div.translate-page",{config:Jt},[r().map(function(t){return m(".list-group-item",[m(".row",[m(".col-sm-5",[m("span",t.text),m("p.small.text-muted.m-y-0",t.comment)]),m(".col-sm-7",[m("textarea.form-control",{placeholder:"translation",oninput:m.withAttr("value",function(e){t.translation(e),u(!0),t.changed=!0}),onchange:m.withAttr("value",function(e){t.translation(e),u(!0),t.changed=!0}),config:Aa},t.translation())])])])})])]:m(".centrify",[m("i.fa.fa-smile-o.fa-5x"),m("h5","Please select a page to start working")])}):m(".loader")])}};function Ca(e){return arguments.length&&(localStorage.fileSidebarWidth=e),localStorage.fileSidebarWidth}function Ea(e){return(e=Object.assign({},e)).translation=m.prop(e.translation),e}function Ra(e){return e.changed=!1,e}var Ma,Oa,Ia=function(){return function(e){return 1==e.changed}},Pa=function(t,n){return function(e){e.stopPropagation(),e.preventDefault(),m.route("/translate/"+t+"/"+n.pageName)}},Ua=0,Ya=0,La="",ja=!0,Na=!1,Fa=(Ma={"/tags":{controller:function(){var r={tags:m.prop(),tag_text:m.prop(""),tag_color:m.prop(""),loaded:!1,error:m.prop(""),remove:function(n){return function(){return Ne.confirm({header:"Delete tag",content:"Are you sure?"}).then(function(e){var t;e&&(t=n,V(Br(t),{method:"delete"})).then(o).catch(function(e){r.error(e.message)}).then(m.redraw)})}},add:function t(){r.tag_text("");r.tag_color("E7E7E7");Ne.confirm({header:"Add a new tag",content:_a(r)}).then(function(e){e&&zr(r.tag_text,r.tag_color).then(function(){r.error(""),r.tag_text(""),r.tag_color(""),o()}).catch(function(e){r.error(e.message),t()}).then(m.redraw)})},edit:function(t,e,n){return function(){r.tag_text(e),r.tag_color(n),Ne.confirm({header:"Edit tag",content:_a(r)}).then(function(e){e&&$r(t,r.tag_text,r.tag_color).then(function(){r.error(""),r.tag_text(""),r.tag_color(""),o()}).catch(function(e){r.error(e.message),$r(t,r.tag_text,r.tag_color)}).then(m.redraw)})}}};function o(){Gr().then(function(e){r.tags(e.tags),r.loaded=!0}).catch(function(e){r.error(e.message)}).then(m.redraw)}return o(),r},view:function(e){var t=e.loaded,n=e.add,r=e.tags,o=e.edit,a=e.remove;return t?m(".container.tags-page",[m(".row",[m(".col-sm-7",[m("h3","Tags")]),m(".col-sm-5",[m("button.btn.btn-success.btn-sm.pull-right",{onclick:n},[m("i.fa.fa-plus"),"  Create new tag"])])]),r().length?m(".row",[m(".list-group.col-sm-6",[r().map(function(e){return m(".list-group-item",[m(".row",[m(".col-sm-6",[m("span.study-tag",{style:{"background-color":"#"+e.color}},e.text)]),m(".col-sm-6",[m("btn-group",[m("a.btn.btn-sm.btn-secondary",{onclick:o(e.id,e.text,e.color)},[m("i.fa.fa-edit")," Edit"]),m("a.btn.btn-sm.btn-secondary",{onclick:a(e.id)},[m("i.fa.fa-remove")," Remove"])])])])])})])]):m(".alert.alert-info","You have no tags yet")]):m(".loader")}},"/translate/:templateId":Ta,"/translate/:templateId/:pageId":Ta,"/template_studies":Po,"/recovery":{controller:function(){var t={sent:!1,username:m.prop(""),error:m.prop(""),recoveryAction:function(){(e=t.username,V("../recovery",{method:"post",body:{username:e}})).catch(function(e){t.error(e.message)}).then(function(){t.sent=!0,m.redraw()});var e}};return t},view:function(e){return m(".recovery.centrify",{config:Jt},[e.sent?[m("i.fa.fa-thumbs-up.fa-5x.m-b-1"),m("h5","Recovery request successfully sent!")]:m(".card.card-inverse.col-md-4",[m(".card-block",[m("h4","Password Reset Request"),m("p","Enter your username or your email address in the space below and we will mail you the password reset instructions"),m("form",{onsubmit:e.recoveryAction},[m("input.form-control",{type:"username",placeholder:"Username / Email",value:e.username(),oninput:m.withAttr("value",e.username),onchange:m.withAttr("value",e.username),config:(n=e.username,function(e,t){t||setTimeout(function(){return n(e.value)},30)})})]),e.error()?m(".alert.alert-warning",m("strong","Error: "),e.error()):"",m("button.btn.btn-primary.btn-block",{onclick:e.recoveryAction},"Request")])])]);var n}},"/activation/:code":{controller:function(){var e,r={password:m.prop(""),external:m.prop(!1),confirm:m.prop(""),password_error:m.prop(""),activated:!1,error:m.prop(""),do_set_password:function(){(e=m.route.param("code"),t=r.password,n=r.confirm,V(ba(e),{method:"post",body:{password:t,confirm:n}})).then(function(){r.activated=!0}).catch(function(e){r.password_error(e.message)}).then(m.redraw);var e,t,n}};return(e=m.route.param("code"),V(ba(e),{method:"get"})).catch(function(e){return r.error(e.message)}).then(m.redraw),r},view:function(e){return m(".activation.centrify",{config:Jt},[e.error()?m("p.text-center",m(".alert.alert-danger",m("strong","Error: "),e.error())):e.activated?[m("i.fa.fa-thumbs-up.fa-5x.m-b-1"),m("h5","Password successfully updated!"),m("p.text-center",m("small.text-muted",m("a",{href:"./"},"Take me to the login page!")))]:ma(e)])}},"/collaboration/:code":{controller:function(){wa(m.route.param("code")).then(function(){m.route("/")}).catch().then(m.redraw)},view:function(){return m(".activation.centrify",{config:Jt},[m("i.fa.fa-thumbs-down.fa-5x.m-b-1"),m("h5","There is a problem! please check your code...")])}},"/settings":{controller:function(){var n={role:m.prop(""),external:m.prop(!0),password:m.prop(""),confirm:m.prop(""),is_dbx_synchronized:m.prop(),is_gdrive_synchronized:m.prop(),present_templates:m.prop(),dbx_auth_link:m.prop(""),gdrive_auth_link:m.prop(""),synchronization_error:m.prop(""),present_templates_error:m.prop(""),email:m.prop(""),prev_email:m.prop(""),password_error:m.prop(""),password_changed:!1,email_error:m.prop(""),email_changed:!1,update_all_details:function(){n.password_changed=!1,n.email_changed=!1,n.password_error(""),n.email_error("");var e={};(n.password()||n.confirm())&&(e.password=n.password(),e.confirm=n.confirm());n.email()!==n.prev_email()&&(n.prev_email(n.email()),e.email=n.email());0<Object.keys(e).length&&(t=e,V("../settings",{method:"post",body:{params:t}})).then(function(e){n.password_error(e.password?e.password.error:""),n.email_error(e.email?e.email.error:""),n.password_changed=e.password&&!e.password.error,n.email_changed=e.email&&!e.email.error}).then(m.redraw);var t},do_set_password:function(){la("",n.password,n.confirm).then(function(){n.password_changed=!0}).catch(function(e){n.password_error(e.message)}).then(m.redraw)},do_set_email:function(){(e=n.email,V(aa,{method:"post",body:{email:e}})).then(function(){n.email_changed=!0}).catch(function(e){n.email_error(e.message)}).then(m.redraw);var e},do_set_templete:function(e){(t=e,t?ca():da()).then(function(){n.present_templates(e)}).catch(function(e){n.present_templates_error(e.message)}).then(m.redraw);var t}};return ot().then(function(e){n.role(e.role)}),V(aa,{method:"get"}).then(function(e){n.email(e.email),n.prev_email(e.email)}).catch(function(e){n.email_error(e.message)}).then(m.redraw),V(sa,{method:"get"}).then(function(e){n.is_dbx_synchronized(e.is_synchronized),n.dbx_auth_link(e.auth_link)}).catch(function(e){n.synchronization_error(e.message)}).then(m.redraw),V(ia,{method:"get"}).then(function(e){n.present_templates(e.present_templates)}).catch(function(e){n.present_templates_error(e.message)}).then(m.redraw),n},view:function(e){return m(".activation.centrify",{config:Jt},[(t=e,Object.keys(ha).map(function(e){return ya[e](t,n)})),m(".card-block",m("button.btn.btn-primary.btn-block",{onclick:e.update_all_details},"Update")),e.password_changed?m(".alert.alert-success",m("strong","Password successfully updated")):"",e.email_changed?m(".alert.alert-success",m("strong","Email successfully updated")):""]);var t,n}},"/messages":{controller:function(){var n={role:m.prop(""),pendings:m.prop(""),loaded:!1,error:m.prop(""),do_use_code:function(t){ga(t).then(function(){return n.pendings(n.pendings().filter(function(e){return e.accept!==t&&e.reject!==t}))}).then(m.redraw)}};return ot().then(function(e){n.role(e.role)}),V("../pending",{method:"get"}).then(function(e){n.pendings(e.studies),n.loaded=!0}).catch(function(e){n.error(e.message)}).then(m.redraw),n},view:function(t){return t.loaded?m(".container.studies",[m(".row.p-t-1",[m(".col-sm-4",[m("h3","Sharing Invitations")])]),m(".card.studies-card",[m(".card-block",[m(".row",{key:"@@notid@@"},[m(".col-sm-3",[m(".form-control-static",[m("strong","Owner ")])]),m(".col-sm-4",[m(".form-control-static",[m("strong","Study name ")])]),m(".col-sm-2",[m(".form-control-static",[m("strong","Permission ")])]),m(".col-sm-3",[m(".form-control-static",[m("strong","Action ")])])]),t.pendings().map(function(e){return m(".row.study-row",[m(".col-sm-3",[m(".study-text",e.owner_name)]),m(".col-sm-4",[m(".study-text",e.study_name)]),m(".col-sm-2",[m(".study-text",e.permission)]),m(".col-sm-3",[m(".study-text",m("button.btn.btn-primary",{onclick:function(){t.do_use_code(e.accept)}},"Accept")," | ",m("button.btn.btn-danger",{onclick:function(){t.do_use_code(e.reject)}},"Reject"))])])})])])]):m(".loader")}},"/reset_password/:code":{controller:function(){var e,t={password:m.prop(""),confirm:m.prop(""),password_error:m.prop(""),password_changed:!1,external:m.prop(!1),code:m.prop(""),do_set_password:function(){la(t.code(),t.password,t.confirm).then(function(){t.password_changed=!0}).catch(function(e){t.password_error(e.message)}).then(m.redraw)}};return t.code(void 0!==m.route.param("code")?m.route.param("code"):""),(e=t.code(),V(ua(e),{method:"get"})).catch(function(){m.route("/")}).then(function(){m.redraw()}),t},view:function(e){return m(".activation.centrify",{config:Jt},[e.password_changed?[m("i.fa.fa-thumbs-up.fa-5x.m-b-1"),m("h5","Password successfully updated!"),m("p.text-center",m("small.text-muted",m("a",{href:"./"},"Take me to my studies!")))]:ma(e)])}},"/deployList":Ho,"/removalList":Go,"/changeRequestList":Bo,"/addUser":ra,"/users":{controller:function(){var r={users:m.prop(),loaded:!1,col_error:m.prop(""),password:m.prop(""),remove:function(n){Ne.confirm({header:"Delete user",content:"Are you sure?"}).then(function(e){var t;e&&(t=n,V("../users",{body:{user_id:t},method:"delete"})).then(function(){return o()}).catch(function(e){r.col_error(e.message)}).then(m.redraw)})},update:function(e,t){(n=e,r=t,V("../users",{body:{user_id:n,role:r},method:"put"})).then(function(){o()}).then(m.redraw);var n,r},change_password:function(e,t){Ne.confirm({header:"Url for reset "+t+"'s password",content:Vn(e)()})},activate_user:function(e,t){Ne.confirm({header:"Url for "+t+"'s account activation",content:Vn(e)()})},add_user:function(){Ne.alert({okText:"Close",header:"Add a new user",content:ra}).then(function(){return o()}).then(m.redraw)}};function o(){V("../users",{method:"get"}).then(function(e){return r.users(e.users)}).then(function(){return r.loaded=!0}).catch(function(e){r.col_error(e.message)}).then(m.redraw)}return o(),r},view:function(t){return t.loaded?m(".container.sharing-page",[m(".row",[m(".col-sm-10",[m("h3","User Management")]),m(".col-sm-2",[m("button.btn.btn-success.btn-sm.m-r-1",{onclick:t.add_user},[m("i.fa.fa-user-plus"),"  Add a new user"])])]),m("table",{class:"table table-striped table-hover"},[m("thead",[m("tr",[m("th","User name"),m("th","First name"),m("th","Last name"),m("th","Email"),m("th","Role"),0<t.users().filter(function(e){return!!e.reset_code||!!e.activation_code}).length?m("th","Actions"):"",m("th","Remove")])]),m("tbody",[t.users().map(function(e){return m("tr",[m("td",e.user_name),m("td",e.first_name),m("td",e.last_name),m("td",e.email),m("td",m("select.form-control",{value:e.role,onchange:function(){t.update(e.id,this.value)}},[m("option",{value:"u",selected:"su"!==e.role},"Simple user"),m("option",{value:"su",selected:"su"===e.role},"Super user")])),0==t.users().filter(function(e){return!!e.reset_code||!!e.activation_code}).length?"":e.reset_code||e.activation_code?e.reset_code?m("td",m("button.btn.btn-secondery",{onclick:function(){return t.change_password(e.reset_code,e.user_name)}},"Reset password")):m("td",m("button.btn.btn-secondery",{onclick:function(){return t.activate_user(e.activation_code,e.user_name)}},"Activate user")):m("td",""),m("td",m("button.btn.btn-danger",{onclick:function(){return t.remove(e.id)}},"Remove"))])})])])]):m(".loader")}},"/config":{controller:function(){var n={loaded:m.prop(!1),dbx:{setted:m.prop(!1),enable:m.prop(!1),client_id:m.prop(""),client_secret:m.prop(""),error:m.prop("")},gmail:{setted:m.prop(!1),enable:m.prop(!1),email:m.prop(""),password:m.prop(""),error:m.prop("")},toggle_visibility:function(e,t){n[e].error(""),n[e].enable(t)},set_gmail:function(){n.gmail.error(""),(e=n.gmail.email,t=n.gmail.password,V("../config/gmail",{body:{email:e,password:t},method:"put"})).catch(function(e){n.gmail.error(e.message)}).then(n.gmail.setted(!0)).then(n.gmail.enable(!0)).then(m.redraw);var e,t},unset_gmail:function(){n.gmail.error(""),V("../config/gmail",{method:"delete"}).catch(function(e){n.gmail.error(e.message)}).then(n.gmail.setted(!1)).then(n.gmail.enable(!1)).then(n.gmail.email("")).then(n.gmail.password("")).then(m.redraw)},set_dbx:function(){n.dbx.error(""),(e=n.dbx.client_id,t=n.dbx.client_secret,V("../config/dbx",{body:{client_id:e,client_secret:t},method:"put"})).catch(function(e){n.dbx.error(e.message)}).then(n.dbx.setted(!0)).then(n.dbx.enable(!0)).then(m.redraw);var e,t},unset_dbx:function(){V("../config/dbx",{method:"delete"}).catch(function(e){n.dbx.error(e.message)}).then(n.dbx.setted(!1)).then(n.dbx.enable(!1)).then(n.dbx.client_id("")).then(n.dbx.client_secret("")).then(m.redraw)}};return V("../config",{method:"get"}).then(function(e){return(t=e).config.gmail&&n.gmail.setted(!0)&&n.gmail.enable(!0)&&n.gmail.email(t.config.gmail.email)&&n.gmail.password(t.config.gmail.password),void(t.config.dbx&&n.dbx.setted(!0)&&n.dbx.enable(!0)&&n.dbx.client_id(t.config.dbx.client_id)&&n.dbx.client_secret(t.config.dbx.client_secret));var t}).then(function(){return n.loaded(!0)}).catch(function(e){n.col_error(e.message)}).then(m.redraw),n},view:function(e){return e.loaded()?m(".container.sharing-page",[m(".row",[m(".col-sm-10",[m("h3","Edit configuration")])]),m(".row.centrify",[m(".card.card-inverse.col-md-5.centrify",[e.gmail.enable()?m(".card-block",[m("h4","Enter details for Gmail accont"),m("form",[m("input.form-control",{type:"input",placeholder:"Gmail accont",value:e.gmail.email(),oninput:m.withAttr("value",e.gmail.email),onchange:m.withAttr("value",e.gmail.email)}),m("input.form-control",{type:"input",placeholder:"password",value:e.gmail.password(),oninput:m.withAttr("value",e.gmail.password),onchange:m.withAttr("value",e.gmail.password)})]),e.gmail.setted()?"":m("button.btn.btn-secondery.btn-block",{onclick:function(){return e.toggle_visibility("gmail",!1)}},"Cancel"),m("button.btn.btn-primary.btn-block",{onclick:e.set_gmail},"Update"),e.gmail.setted()?m("button.btn.btn-danger.btn-block",{onclick:e.unset_gmail},"remove"):"",e.gmail.error()?m("p.alert.alert-danger",e.gmail.error()):""]):m("a",{onclick:function(){return e.toggle_visibility("gmail",!0)}},m("button.btn.btn-primary.btn-block",[m("i.fa.fa-fw.fa-envelope")," Enable support with email"]))])]),m(".row.centrify",m(".card.card-inverse.col-md-5.centrify",[e.dbx.enable()?m(".card-block",[m("h4","Enter details for Dropbox application"),m("form",[m("input.form-control",{type:"input",placeholder:"client id",value:e.dbx.client_id(),oninput:m.withAttr("value",e.dbx.client_id),onchange:m.withAttr("value",e.dbx.client_id)}),m("input.form-control",{type:"input",placeholder:"client secret",value:e.dbx.client_secret(),oninput:m.withAttr("value",e.dbx.client_secret),onchange:m.withAttr("value",e.dbx.client_secret)})]),e.dbx.setted()?"":m("button.btn.btn-secondery.btn-block",{onclick:function(){return e.toggle_visibility("dbx",!1)}},"Cancel"),m("button.btn.btn-primary.btn-block",{onclick:e.set_dbx},"Update"),e.dbx.setted()?m("button.btn.btn-danger.btn-block",{onclick:e.unset_dbx},"remove"):"",e.dbx.error()?m("p.alert.alert-danger",e.dbx.error()):""]):m("a",{onclick:function(){return e.toggle_visibility("dbx",!0)}},m("button.btn.btn-primary.btn-block",[m("i.fa.fa-fw.fa-envelope")," Enable support with dropbox"]))]))]):m(".loader")}},"/massMail":{controller:function(){var a=m.prop(""),i=m.prop(""),s=m.prop(!1),u=m.prop(!1),l=m.prop(!1),c={subject:a,body:i,ru:s,su:u,cu:l,error:m.prop(""),sent:!1,send:function(){(e=a,t=i,n=s,r=u,o=l,V("../mass_mail",{method:"post",body:{subject:e,body:t,ru:n,su:r,cu:o}})).then(function(){c.sent=!0,m.redraw()}).catch(function(e){c.error(e.message),m.redraw()});var e,t,n,r,o}};return c},view:function(e){return m(".add.centrify",{config:Jt},[e.sent?[m("i.fa.fa-thumbs-up.fa-5x.m-b-1"),m("h5","Mail successfully sent!")]:m(".card.card-inverse.col-md-4",[m(".card-block",[m("h4","Please fill the following details"),m("form",{onsubmit:e.send},[m("fieldset.form-group",m("input.form-control",{type:"Subject",placeholder:"Subject",value:e.subject(),oninput:m.withAttr("value",e.subject),onchange:m.withAttr("value",e.subject),config:va(e.subject)})),m("fieldset.form-group",m("textarea.form-control",{type:"Body",placeholder:"Body",value:e.body(),oninput:m.withAttr("value",e.body),onchange:m.withAttr("value",e.body),config:va(e.body)})),m("fieldset.form-group",m("label.c-input.c-checkbox",[m("input.form-control",{type:"checkbox",onclick:m.withAttr("checked",e.ru)}),m("span.c-indicator"),m.trust("&nbsp;"),m("span","Regular users")]),m("label.c-input.c-checkbox",[m("input.form-control",{type:"checkbox",onclick:m.withAttr("checked",e.su)}),m("span.c-indicator"),m.trust("&nbsp;"),m("span","Super users")]),m("label.c-input.c-checkbox",[m("input.form-control",{type:"checkbox",onclick:m.withAttr("checked",e.cu)}),m("span.c-indicator"),m.trust("&nbsp;"),m("span","Contract users")]))]),e.error()?m(".alert.alert-warning",m("strong","Error: "),e.error()):"",m("button.btn.btn-primary.btn-block",{onclick:e.send},"Send")])])])}},"/studyChangeRequest/:studyId":{controller:function(){var n=m.route.param("studyId"),r=ce(),o={sent:!1,user_name:m.prop(""),researcher_name:m.prop(""),researcher_email:m.prop(""),study_name:m.prop(""),target_sessions:m.prop(""),status:m.prop(""),file_names:m.prop(""),comments:m.prop(""),error:m.prop("")};return $o(n).then(function(e){o.researcher_name(e.researcher_name),o.researcher_email(e.researcher_email),o.user_name(e.user_name),o.study_name(e.study_name)}).catch(function(e){o.error(e.message)}).then(m.redraw),{ctrl:o,form:r,submit:function(){var e,t;r.showValidation(!0),r.isValid()?(e=n,t=o,V(zo(e),{method:"put",body:{file_names:t.file_names,target_sessions:t.target_sessions,status:t.status,comments:t.comments}})).then(function(){o.sent=!0}).catch(function(e){o.error(e.message)}).then(m.redraw):o.error("Missing parameters")},studyId:n}},view:function(e){var t=e.form,n=e.ctrl,r=e.submit,o=document.location.origin+"/implicit/showfiles.jsp?user="+n.user_name()+"&study="+n.study_name();return n.sent?m(".deploy.centrify",[m("i.fa.fa-thumbs-up.fa-5x.m-b-1"),m("h5",["The change request form was sent successfully ",m("a",{href:"/changeRequestList",config:m.route},"View change request  requests")])]):m(".StudyChangeRequest.container",[m("h3",["Study Change Request ",m("small",n.study_name())]),m(".row",[m(".col-sm-3",m("strong","Researcher Name: ")),m(".col-sm-9",n.researcher_name())]),m(".row",[m(".col-sm-3",m("strong","Researcher Email Address: ")),m(".col-sm-9",n.researcher_email())]),m(".row.m-b-1",[m(".col-sm-3",m("strong","Study showfiles link: ")),m(".col-sm-9",m("a",{href:o,target:"_blank"},o))]),de({label:m("span",["Target number of additional sessions (In addition to the sessions completed so far)",m("span.text-danger"," *")]),placeholder:"Target number of additional sessions",prop:n.target_sessions,form:t,required:!0,isStack:!0}),he({label:m("span",["What's the current status of your study?",na]),prop:n.status,values:{"Currently collecting data and does not need to be unpaused":"Currently collecting data and does not need to be unpaused","Manually paused and needs to be unpaused":"Manually paused and needs to be unpaused","Auto-paused due to low completion rates or meeting target N.":"Auto-paused due to low completion rates or meeting target N."},form:t,required:!0,isStack:!0}),de({isArea:!0,label:m("span",["Change Request",m("span.text-danger"," *")]),help:"List all file names involved in the change request. Specify for each file whether file is being updated or added to production.)",placeholder:"Change Request",prop:n.file_names,form:t,required:!0,isStack:!0}),de({isArea:!0,label:m("span","Additional comments"),placeholder:"Additional comments",prop:n.comments,form:t,isStack:!0}),n.error()?m(".alert.alert-warning",m("strong","Error: "),n.error()):"",m("button.btn.btn-primary",{onclick:r},"Submit")])}},"/studyRemoval/:studyId":ta,"/deploy/:studyId":Qo,"/login":Kt,"/studies":Po,"/studies/statistics_old":Ie,"/studies/statistics":Se,"/view/:code":Oo,"/view/:code/:resource/:fileId":Oo,"/editor/:studyId":To,"/editor/:studyId/:resource/:fileId":To,"/pool":it,"/pool/history":lt,"/downloads":Rt,"/downloadsAccess":$t,"/sharing/:studyId":{controller:function(){var i={users:m.prop(),is_public:m.prop(),link_data:m.prop(),link:m.prop(""),link_type:m.prop(""),link_list:m.prop([]),link_add_list:m.prop([]),link_remove_list:m.prop([]),study_name:m.prop(),user_name:m.prop(""),permission:m.prop("can edit"),data_permission:m.prop("visible"),loaded:!1,col_error:m.prop(""),pub_error:m.prop(""),share_error:m.prop(""),remove:function(r){Ne.confirm({header:"Delete collaboration",content:"Are you sure?"}).then(function(e){var t,n;e&&(t=m.route.param("studyId"),n=r,V(ro(t),{method:"delete",body:{user_id:n}})).then(function(){s()}).catch(function(e){i.col_error(e.message)}).then(m.redraw)})},do_add_collaboration:function a(){Ne.confirm({header:"Add a Collaborator",content:m.component({view:function(){return m("p",[m("p","Enter collaborator's user name:"),m("input.form-control",{placeholder:"User name",value:i.user_name(),onchange:m.withAttr("value",i.user_name)}),m("p.space","Select users's permissions:"),m("select.form-control",{value:i.permission(),onchange:m.withAttr("value",i.permission)},[m("option",{value:"can edit",selected:"can edit"===i.permission()},"Can edit"),m("option",{value:"read only",selected:"read only"===i.permission()},"Read only"),m("option",{value:"invisible",selected:"invisible"===i.permission()},"Invisible")]),m("p.space","Select data visibility:"),m("select.form-control",{value:(e=i,e.data_permission("invisible"===e.permission()?"visible":e.data_permission())),onchange:m.withAttr("value",i.data_permission)},[m("option",{value:"visible",selected:"visible"===i.data_permission()},"Visible"),m("option",{value:"invisible",disabled:"invisible"===i.permission(),selected:"invisible"===i.data_permission()},"Invisible")]),m("p",{class:i.col_error()?"alert alert-danger":""},i.col_error())]);var e}})}).then(function(e){if(e){if(!i.user_name())return i.col_error("ERROR: user name is missing"),a();(t=m.route.param("studyId"),n=i.user_name,r=i.permission,o=i.data_permission,V(ro(t),{method:"post",body:{user_name:n,permission:r,data_permission:o}})).then(function(){i.col_error(""),s()}).catch(function(e){i.col_error(e.message),a()}).then(m.redraw)}var t,n,r,o})},do_add_link:function(){(e=m.route.param("studyId"),V(oo(e),{method:"post"})).then(function(e){i.link(e.link)}).catch(function(e){i.col_error(e.message)}).then(m.redraw);var e},do_revoke_link:function(){(e=m.route.param("studyId"),V(oo(e),{method:"delete"})).then(function(){i.link("")}).catch(function(e){i.col_error(e.message)}).then(m.redraw);var e},do_make_public:function t(n){Ne.confirm({okText:["Yes, make ",n?"public":"private"],cancelText:["No, keep ",n?"private":"public"],header:"Are you sure?",content:m("p",[m("p",n?"Making the study public will allow everyone to view the files. It will NOT allow others to modify the study or its files.":"Making the study private will hide its files from everyone but you."),m("span",{class:i.pub_error()?"alert alert-danger":""},i.pub_error())])}).then(function(e){e&&ao(m.route.param("studyId"),n).then(function(){i.pub_error(""),s()}).catch(function(e){i.pub_error(e.message),t(n)}).then(m.redraw)})}};function s(){var e;(e=m.route.param("studyId"),V(ro(e),{method:"get"})).then(function(e){i.users(e.users),i.is_public(e.is_public),i.study_name(e.study_name),i.link(e.link_data.link),i.link_type(e.link_data.link_type),i.link_list(e.link_data.link_list),i.loaded=!0}).catch(function(e){i.col_error(e.message)}).then(m.redraw)}return s(),i},view:function(t){return t.loaded?m(".container.sharing-page",[m(".row",[m(".col-sm-7",[m("h3",[t.study_name()," (Sharing Settings)"])]),m(".col-sm-5",[m("button.btn.btn-secondary.btn-sm.m-r-1",{onclick:t.do_add_collaboration},[m("i.fa.fa-plus"),"  Add a new collaborator"]),m("button.btn.btn-secondary.btn-sm",{onclick:function(){t.do_make_public(!t.is_public())}},["Make ",t.is_public()?"Private":"Public"])])]),m("table",{class:"table table-striped table-hover"},[m("thead",[m("tr",[m("th","User name"),m("th","Permission"),m("th","Remove")])]),m("tbody",[t.users().map(function(e){return m("tr",[m("td",e.user_name),m("td",[e.permission,e.status?" ("+e.status+")":""]),m("td",m("button.btn.btn-secondary",{onclick:function(){t.remove(e.user_id)}},"Remove"))])})])])]):m(".loader")}}},Oa=function(t){return{controller:function(){var o={isloggedin:ja,role:m.prop(La),new_msgs:m.prop(Na),present_templates:m.prop(!1),doLogout:i,timer:m.prop(0)};function a(){ot().then(function(e){La=o.role(e.role),Na=o.new_msgs(e.new_msgs),ja=o.isloggedin=e.isloggedin,o.present_templates(e.present_templates);var t=m.route()=="/view/"+m.route.param("code")||m.route()=="/view/"+m.route.param("code")+"/"+m.route.param("resource")+"/"+encodeURIComponent(m.route.param("fileId"));if("ro"==o.role()&&!t)return i();var n="/users"==m.route()||"/config"==m.route();if("su"!=o.role()&&n&&m.route("./"),!t&&!o.isloggedin&&"/login"!==m.route()&&"/recovery"!==m.route()&&m.route()!=="/activation/"+m.route.param("code")&&m.route()!=="/change_password/"+m.route.param("code")&&m.route()!=="/reset_password/"+m.route.param("code")){var r=m.route();m.route("/login"),location.hash=encodeURIComponent(r)}"CU"==o.role()&&"/studies"==m.route()&&m.route("/downloads"),Ua=e.timeoutInSeconds,clearInterval(Ya),Ya=setInterval(function(){Ua<=0||(Ua<10&&(Ne.close(),i()),70==Ua&&Ne.confirm({header:"Timeout Warning",content:"The session is about to expire. Do you want to keep working?",okText:"Yes, stay signed-in",cancelText:"No, sign out"}).then(function(e){return e?a():i()}),Ua--)},1e3),m.redraw()})}return a(),o;function i(){clearInterval(Ya),B("../logout",{method:"post"}).then(ot).then(function(){var e=m.route();m.route("/login"),location.hash=encodeURIComponent(e)})}},view:function(e){var n={studies:[],tags:[],admin:["users","config"]},r={studies:{text:"Studies",href:"/studies",sub:[]},data:{text:"Data",href:!1,subs:{downloads:{text:"downloads",href:"/downloads"},downloadsAccess:{text:"Downloads Access",href:"/downloadsAccess"},statistics:{text:"Statistics",href:"/statistics"}}},pool:{text:"Pool",href:"/pool",sub:[]},tags:{text:"Tags",href:"/tags",sub:[]},admin:{text:"Admin",href:!1,su:!0,subs:{deployList:{text:"Deploy List",href:"/deployList"},removalList:{text:"Removal List",href:"/removalList"},changeRequestList:{text:"Change Request List",href:"/changeRequestList"},addUser:{text:"Add User",href:"/addUser"},config:{text:"Edit Configuration",href:"/config"},massMail:{text:"Send MassMail",href:"/massMail"},users:{text:"Users Management",href:"/users"}}}};return m(".dashboard-root",{class:window.top!=window.self?"is-iframe":""},[e.isloggedin&&"ro"!=e.role()?m("nav.navbar.navbar-dark",[m("a.navbar-brand",{href:"",config:m.route},"Dashboard"),m("ul.nav.navbar-nav",[Object.keys(n).map(function(t){return r[t].su&&"su"!==e.role()?"":0==n[t].length?m("li.nav-item",[m("a.nav-link",{href:r[t].href,config:m.route},r[t].text)]):m("li.nav-item",[m(".dropdown",[m("a.nav-link",r[t].text),m(".dropdown-menu",[n[t].map(function(e){return m("a.dropdown-item",{href:r[t].subs[e].href,config:m.route},r[t].subs[e].text)})])])])}),e.new_msgs()?m("li.nav-item.pull-xs-right",[m("a.nav-link",{href:"/messages",config:m.route},m("i.fa.fa-envelope.fa-lg",{style:{color:"white"}}))]):"",m("li.nav-item.pull-xs-right",[m("a.nav-link",{href:"/settings",config:m.route},m("i.fa.fa-cog.fa-lg"))]),e.isloggedin?m("li.nav-item.pull-xs-right",[m("button.btn.btn-info",{onclick:e.doLogout},[m("i.fa.fa-sign-out"),"  Logout"])]):""])]):"",m(".main-content.container-fluid",[t,m.component(Ar),m.component(Ne),m.component(qe)])])}}},Object.keys(Ma).reduce(function(e,t){return e[t]=Oa(Ma[t],t,Ma),e},{}));m.route(document.body,"/studies",Fa)}();
//# sourceMappingURL=main.js.map
